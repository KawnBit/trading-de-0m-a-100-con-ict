<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Capítulo 14: Metodología ICT - Versión Extendida con IA. Innovación Centrada en el Usuario, Mom Test, Modelo Kano, JTBD, Pretotipado y A/B Testing.">
    <title>KawnBit | Cap 14: Metodología ICT (AI Powered & Extended)</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;700;900&display=swap"
        rel="stylesheet">

    <!-- Librerías Externas Optimizadas con 'defer' para no bloquear el renderizado -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>

    <!-- Configuración Tailwind KawnBit -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kawn: {
                            light: '#ccfbf1', // Teal 100
                            base: '#14b8a6',  // Teal 500
                            dark: '#0f766e',  // Teal 700
                            deep: '#134e4a',  // Teal 900
                        },
                        slate: {
                            50: '#f8fafc',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(20, 184, 166, 0.1), 0 2px 4px -1px rgba(20, 184, 166, 0.06)',
                        'glow': '0 0 15px rgba(20, 184, 166, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos Base y Utilidades */
        body {
            background-color: #f8fafc;
            color: #334155;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Montserrat', sans-serif;
        }

        /* Scrollbar Personalizado */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #14b8a6;
        }

        /* Logo Recreation CSS */
        .kawn-logo-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .kawn-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #14b8a6 0%, #0f766e 100%);
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(20, 184, 166, 0.4);
        }

        .kawn-logo-icon::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            border-top: 3px solid white;
            border-right: 3px solid white;
            transform: rotate(-15deg);
            top: 10px;
            left: 10px;
        }

        .kawn-logo-icon::after {
            content: 'K';
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 22px;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* TOC Activo */
        .toc-link.active {
            color: #14b8a6;
            border-left: 3px solid #14b8a6;
            background-color: #ccfbf1;
            padding-left: 0.75rem;
            font-weight: 600;
        }

        .toc-link {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        /* Callouts y Tarjetas */
        .card-concept {
            background: white;
            border-radius: 0.75rem;
            border-left: 4px solid #14b8a6;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .blockquote-custom {
            border-left: 4px solid #0f766e;
            padding-left: 1.5rem;
            font-style: italic;
            color: #475569;
            margin: 2rem 0;
            font-size: 1.1rem;
            background-color: #f1f5f9;
            padding: 1.5rem;
            border-radius: 0 0.75rem 0.75rem 0;
        }

        /* Animaciones */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chat Styles */
        .chat-container {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message-bubble {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 12px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .user-msg {
            background-color: #14b8a6;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .ai-msg {
            background-color: #f1f5f9;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid #e2e8f0;
        }

        /* Interactive Components Specifics */
        .tab-btn.active {
            background-color: #14b8a6;
            color: white;
            border-color: #14b8a6;
        }

        .quiz-option {
            transition: all 0.2s;
        }

        .quiz-feedback {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Range Slider Customization */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #14b8a6;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(20, 184, 166, 0.5);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 4px;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #cbd5e1;
        }

        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Sparkle Animation for AI Buttons */
        @keyframes sparkle {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .ai-gradient-btn {
            background: linear-gradient(270deg, #14b8a6, #6366f1, #14b8a6);
            background-size: 200% 200%;
            animation: sparkle 3s ease infinite;
        }

        /* Flip Card Styles for JTBD */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 120px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .flip-card-front {
            background-color: #f8fafc;
            color: #334155;
            border: 2px solid #e2e8f0;
        }

        .flip-card-back {
            background-color: #14b8a6;
            color: white;
            transform: rotateY(180deg);
        }
    </style>
</head>

<body class="antialiased">

    <!-- Navbar Sticky -->
    <nav
        class="sticky top-0 z-50 w-full bg-white/90 backdrop-blur-md border-b border-slate-200 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="kawn-logo-wrapper select-none">
                    <div class="kawn-logo-icon"></div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-black text-slate-900 tracking-tight leading-none">KAWNBIT</span>
                        <span
                            class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.2em] leading-none mt-1">Quantitative
                            Trading Community</span>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden p-2 text-slate-600 hover:text-kawn-base"
                    aria-label="Abrir menú principal" aria-expanded="false">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>

                <!-- Desktop Nav -->
                <div class="hidden md:flex space-x-8 items-center">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Innovation Series</span>
                    <div class="h-6 w-px bg-slate-200"></div>
                    <a href="#" class="text-kawn-base font-bold border-b-2 border-kawn-base pb-1">Capítulo 14</a>
                    <a href="#ejercicios"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors">Ejercicios</a>
                    <a href="#glosario"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors">Glosario</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Layout Principal -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="flex flex-col md:flex-row gap-12">

            <!-- Sidebar TOC (Sticky) -->
            <aside id="sidebar-toc" class="hidden md:block w-64 flex-shrink-0 transition-transform duration-300 z-40">
                <div class="sticky top-28">
                    <h3
                        class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-200 pb-2">
                        Contenido del capítulo</h3>
                    <nav id="toc-container"
                        class="flex flex-col space-y-1 text-sm max-h-[80vh] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Generado por JS -->
                    </nav>
                </div>
            </aside>

            <!-- Contenido Principal -->
            <main class="flex-1 max-w-4xl min-w-0">

                <!-- Hero Section -->
                <section class="mb-16 fade-in-up">
                    <span
                        class="inline-block py-1 px-3 rounded-full bg-kawn-light text-kawn-deep text-xs font-bold uppercase tracking-wider mb-4 border border-kawn-base/20">Capítulo
                        14</span>
                    <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-6 leading-tight">
                        Metodología ICT: <span class="text-kawn-base">Identificar, Crear, Testear</span>
                    </h1>
                    <p class="text-xl text-slate-600 leading-relaxed border-l-4 border-slate-300 pl-6">
                        Innovación centrada en el usuario, creación ágil y testeo rápido. Un enfoque estructurado para
                        emprender con menos riesgo y mayor probabilidad de éxito en la economía actual.
                    </p>
                </section>

                <!-- Introducción -->
                <section id="intro" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="alert-circle" class="text-kawn-base mr-3"></i> El problema de la innovación sin
                        método
                    </h2>
                    <div class="prose max-w-none text-slate-600 leading-7">
                        <p class="mb-4">En la economía actual, innovar con éxito se ha vuelto imprescindible. Sin
                            embargo, la innovación sin método conlleva riesgos elevados: <strong>más del 90% de las
                                startups fracasan</strong> en sus primeros años. ¿La razón principal? Desarrollan
                            productos o servicios que el mercado realmente no necesita.</p>

                        <div class="blockquote-custom">
                            "El principal motivo de fracaso de las startups es claro: simplemente no ofrecen el producto
                            o servicio que el mercado demanda."
                        </div>

                        <p class="mb-4">Para evitar este destino, presentamos la <strong>Metodología ICT</strong>. Este
                            método integra lo mejor del Design Thinking, Lean Startup y desarrollo ágil en un marco
                            práctico: <strong>Identificar</strong> necesidades reales, <strong>Crear</strong> soluciones
                            ágiles y <strong>Testear</strong> rápidamente.</p>
                    </div>

                    <!-- COMPONENTE INTERACTIVO 1: VISUALIZADOR DE RIESGO -->
                    <div class="mt-8 bg-white rounded-xl shadow-card border border-slate-100 p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-slate-800 text-lg">Visualizador: Curva de Coste del Fallo</h3>
                            <span
                                class="bg-kawn-light text-kawn-deep text-xs px-2 py-1 rounded font-bold">Interactivo</span>
                        </div>
                        <p class="text-sm text-slate-500 mb-4">Compara cómo se acumula el riesgo y el coste en un modelo
                            tradicional vs. el modelo ICT.</p>
                        <div class="relative h-64 w-full">
                            <canvas id="riskChart" aria-label="Gráfico de riesgo vs coste" role="img"></canvas>
                        </div>
                        <div class="mt-4 text-xs text-slate-500 text-center italic">
                            El modelo ICT distribuye el riesgo en pequeños experimentos, evitando el "gran fracaso" al
                            final.
                        </div>
                    </div>
                </section>

                <!-- Fase 1: Identificar -->
                <section id="fase-1-identificar" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="search" class="text-kawn-base mr-3"></i> Fase 1: Identificar
                    </h2>
                    <div class="prose max-w-none text-slate-600 leading-7 mb-6">
                        <p class="mb-4">Toda innovación de éxito comienza con la identificación de un problema real.
                            Actuamos como detectives de oportunidades: observar, preguntar y analizar hasta detectar
                            "dónde duele".</p>

                        <div class="card-concept">
                            <h4 class="font-bold text-slate-800 mb-2">Herramientas Clave de Identificación</h4>
                            <ul class="list-disc pl-5 space-y-2 text-slate-700">
                                <li><strong>User Research:</strong> Entrevistas empáticas y observación de campo.</li>
                                <li><strong>Pain Points:</strong> Listar los dolores más agudos del cliente.</li>
                                <li><strong>Estrategia del Océano Azul:</strong> Buscar espacios de mercado no
                                    disputados.</li>
                                <li><strong>Business Model Canvas:</strong> Plasmar la propuesta de valor y segmento de
                                    clientes.</li>
                            </ul>
                        </div>

                        <p>El resultado deseado es una <strong>hipótesis clara</strong>. Ejemplo de Airbnb:
                            Identificaron que los asistentes a conferencias no encontraban hoteles asequibles (problema)
                            y definieron una solución basada en espacios libres en casas (hipótesis).</p>
                    </div>

                    <!-- NUEVO CONTENIDO: THE MOM TEST & AI SIMULATOR -->
                    <div class="mt-8 mb-8 border-l-4 border-indigo-500 pl-6 py-2">
                        <h3 class="text-xl font-bold text-slate-900 mb-3">La Regla de Oro: El "Mom Test"</h3>
                        <p class="text-slate-600 mb-4">
                            Uno de los errores más comunes al identificar problemas es preguntar: <em>"¿Qué te parece mi
                                idea?"</em>. Si le haces esa pregunta a tu madre, te dirá que es fantástica porque te
                            quiere y no quiere herir tus sentimientos. Esto genera un "falso positivo" mortal.
                        </p>
                        <p class="text-slate-600 mb-4">
                            Para obtener la verdad, debes preguntar sobre el comportamiento pasado, no sobre opiniones
                            futuras. No preguntes "¿Comprarías esto?", pregunta "¿Cuándo fue la última vez que
                            intentaste solucionar este problema y cuánto gastaste?".
                        </p>

                        <!-- AI Feature: Mom Test Roleplay -->
                        <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100">
                            <h4 class="font-bold text-indigo-900 mb-4 flex items-center gap-2">
                                <i data-lucide="message-circle" class="w-5 h-5"></i> Roleplay: Entrevista a "Mamá"
                                (Powered by Gemini)
                            </h4>
                            <p class="text-sm text-indigo-700 mb-4">Escribe una pregunta para validar tu idea. La IA
                                simulará ser tu "madre" (dándote un falso positivo) y luego te criticará
                                constructivamente.</p>

                            <div class="flex gap-2 mb-4">
                                <input type="text" id="mom-test-input"
                                    class="flex-1 border border-indigo-200 rounded px-3 py-2 text-sm"
                                    placeholder="Ej: Mamá, ¿te gusta mi nueva app de cocina?">
                                <button id="mom-test-btn"
                                    class="ai-gradient-btn text-white px-4 py-2 rounded text-xs font-bold flex items-center gap-2 hover:opacity-90 transition-opacity">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i> Simular
                                </button>
                            </div>

                            <div id="mom-test-result"
                                class="hidden p-4 bg-white rounded border border-indigo-100 text-sm space-y-2"
                                aria-live="polite">
                                <!-- AI Content here -->
                            </div>
                        </div>
                    </div>

                    <!-- NUEVA SECCIÓN: JOBS TO BE DONE (JTBD) -->
                    <div class="mt-12 mb-8">
                        <h3 class="text-xl font-bold text-slate-900 mb-3 flex items-center gap-2">
                            <i data-lucide="briefcase" class="text-kawn-base w-6 h-6"></i> Más allá del perfil: Jobs to
                            be Done
                        </h3>
                        <p class="text-slate-600 mb-4">
                            No te centres solo en *quién* es el usuario (demografía), sino en *para qué* contrata tu
                            producto. Como dijo Theodore Levitt: <strong>"La gente no quiere comprar un taladro de un
                                cuarto de pulgada, quiere un agujero de un cuarto de pulgada"</strong>.
                        </p>
                        <p class="text-slate-600 mb-6">
                            El framework JTBD nos ayuda a entender la motivación causal detrás de una compra. Un usuario
                            "contrata" un producto para hacer un trabajo específico en su vida.
                        </p>

                        <!-- Interactivo: Traductor de Necesidades -->
                        <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                            <h4 class="font-bold text-slate-800 mb-4 text-center">Traductor de Necesidades: Haz clic
                                para ver el "Job" real</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Card 1 -->
                                <div class="flip-card" onclick="this.classList.toggle('flipped')">
                                    <div class="flip-card-inner">
                                        <div class="flip-card-front">
                                            <div>
                                                <i data-lucide="coffee" class="w-8 h-8 mx-auto text-slate-400 mb-2"></i>
                                                <span class="font-bold text-sm">Café caro de Starbucks</span>
                                            </div>
                                        </div>
                                        <div class="flip-card-back">
                                            <span class="text-xs font-bold px-2">"Contratado para tener 15 minutos de
                                                paz o una oficina temporal."</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card 2 -->
                                <div class="flip-card" onclick="this.classList.toggle('flipped')">
                                    <div class="flip-card-inner">
                                        <div class="flip-card-front">
                                            <div>
                                                <i data-lucide="clapperboard"
                                                    class="w-8 h-8 mx-auto text-slate-400 mb-2"></i>
                                                <span class="font-bold text-sm">Suscripción a Netflix</span>
                                            </div>
                                        </div>
                                        <div class="flip-card-back">
                                            <span class="text-xs font-bold px-2">"Contratado para desconectar el cerebro
                                                y evitar el aburrimiento."</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card 3 -->
                                <div class="flip-card" onclick="this.classList.toggle('flipped')">
                                    <div class="flip-card-inner">
                                        <div class="flip-card-front">
                                            <div>
                                                <i data-lucide="drill" class="w-8 h-8 mx-auto text-slate-400 mb-2"></i>
                                                <span class="font-bold text-sm">Taladro de alta potencia</span>
                                            </div>
                                        </div>
                                        <div class="flip-card-back">
                                            <span class="text-xs font-bold px-2">"Contratado para colgar un cuadro y
                                                sentirme capaz/útil."</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-center text-slate-400 mt-4 italic">Haz clic en las tarjetas para
                                girarlas.</p>
                        </div>
                    </div>
                </section>

                <!-- Fase 2: Crear -->
                <section id="fase-2-crear" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="hammer" class="text-kawn-base mr-3"></i> Fase 2: Crear (MVP)
                    </h2>
                    <div class="prose max-w-none text-slate-600 leading-7">
                        <p class="mb-4">Una vez validado el problema, pasamos a crear la solución de forma ágil. No
                            buscamos un producto final, sino un <strong>Producto Mínimo Viable (MVP)</strong>.</p>

                        <div class="blockquote-custom">
                            "Fracasar rápido, fracasar barato. No construyas la catedral antes de saber si la gente
                            quiere rezar."
                        </div>

                        <h3 class="text-lg font-bold text-slate-800 mt-6 mb-3">Tipos de MVP</h3>
                        <ul class="space-y-3 mb-6">
                            <li class="flex items-start gap-3">
                                <i data-lucide="check-circle" class="text-kawn-base w-5 h-5 mt-1 flex-shrink-0"></i>
                                <div><strong class="text-slate-800">Baja Fidelidad:</strong> Landing pages o videos
                                    explicativos (Caso Dropbox).</div>
                            </li>
                            <li class="flex items-start gap-3">
                                <i data-lucide="check-circle" class="text-kawn-base w-5 h-5 mt-1 flex-shrink-0"></i>
                                <div><strong class="text-slate-800">Alta Fidelidad:</strong> Apps básicas o prototipos
                                    físicos.</div>
                            </li>
                            <li class="flex items-start gap-3">
                                <i data-lucide="check-circle" class="text-kawn-base w-5 h-5 mt-1 flex-shrink-0"></i>
                                <div><strong class="text-slate-800">Mago de Oz:</strong> Simular una experiencia
                                    automatizada de forma manual (Caso Zappos).</div>
                            </li>
                        </ul>
                    </div>

                    <!-- NUEVO CONTENIDO: MODELO KANO -->
                    <div class="mt-8 mb-10">
                        <h3 class="text-xl font-bold text-slate-900 mb-3">Priorización Inteligente: El Modelo Kano</h3>
                        <p class="text-slate-600 mb-4">
                            Al definir las características de tu MVP, no todas tienen el mismo peso. El Modelo Kano
                            ayuda a clasificar las funcionalidades en tres categorías críticas para la satisfacción del
                            cliente:
                        </p>
                        <ul class="list-disc pl-5 space-y-2 text-slate-700 mb-6">
                            <li><strong>Básicas (Must-be):</strong> Si faltan, el cliente se queja. Si están, no se
                                emociona (las da por hecho). Ej: Frenos en un coche.</li>
                            <li><strong>Prestacionales (Performance):</strong> Cuanto más, mejor. Relación lineal con la
                                satisfacción. Ej: Duración de la batería.</li>
                            <li><strong>Deleitadores (Delighters):</strong> Inesperadas. Si faltan, no pasa nada. Si
                                están, enamoran. Ej: Regalo sorpresa en el envío.</li>
                        </ul>

                        <!-- Interactivo: Gráfico Kano -->
                        <div class="bg-white rounded-xl shadow-card border border-slate-100 p-6">
                            <h4 class="font-bold text-slate-800 mb-4">Visualizador del Modelo Kano</h4>
                            <div class="relative h-64 w-full">
                                <canvas id="kanoChart" aria-label="Gráfico del Modelo Kano" role="img"></canvas>
                            </div>
                            <p class="text-xs text-center text-slate-500 mt-2">Observa cómo la satisfacción (Eje Y)
                                varía según la implementación (Eje X) para cada categoría.</p>
                        </div>
                    </div>

                    <!-- NUEVA SECCIÓN: PRETOTIPADO -->
                    <div class="mt-12 mb-8 bg-slate-50 p-6 rounded-xl border-l-4 border-kawn-base">
                        <h3 class="text-xl font-bold text-slate-900 mb-3 flex items-center gap-2">
                            <i data-lucide="test-tube-2" class="text-kawn-base w-6 h-6"></i> Pretotipado vs Prototipado
                        </h3>
                        <p class="text-slate-600 mb-4">
                            Un concepto clave introducido por Alberto Savoia. Mientras que el <strong>Prototipo</strong>
                            responde a "¿Podemos construirlo?", el <strong>Pretotipo</strong> responde a "¿Deberíamos
                            construirlo?". El objetivo es validar la demanda *antes* de invertir una sola hora en
                            ingeniería.
                        </p>

                        <!-- Interactivo: Selector de Pretotipo -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 mt-4">
                            <h4 class="font-bold text-slate-800 mb-3">Selector Rápido de Técnica de Pretotipado</h4>
                            <div class="grid grid-cols-1 gap-3 text-sm">
                                <button
                                    onclick="alert('Recomendación: Fake Door.\nCrea una landing page o un botón que diga \'Comprar\' pero que lleve a un mensaje de \'Próximamente\'. Mide cuántos hacen clic.')"
                                    class="w-full text-left p-3 hover:bg-slate-50 border border-slate-200 rounded flex justify-between items-center group">
                                    <span>Tengo una idea digital pero no sé programar</span>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-slate-300 group-hover:text-kawn-base"></i>
                                </button>
                                <button
                                    onclick="alert('Recomendación: Mechanical Turk.\nOfrece el servicio manualmente detrás de escena. Si es una IA de recetas, escribe tú las recetas al recibir el pedido.')"
                                    class="w-full text-left p-3 hover:bg-slate-50 border border-slate-200 rounded flex justify-between items-center group">
                                    <span>Quiero validar un servicio automatizado complejo</span>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-slate-300 group-hover:text-kawn-base"></i>
                                </button>
                                <button
                                    onclick="alert('Recomendación: Pinocchio.\nConstruye una versión inerte del producto (madera, cartón) y úsala como si fuera real para ver si la experiencia tiene sentido.')"
                                    class="w-full text-left p-3 hover:bg-slate-50 border border-slate-200 rounded flex justify-between items-center group">
                                    <span>Es un producto físico innovador</span>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-slate-300 group-hover:text-kawn-base"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- COMPONENTE INTERACTIVO 2: SIMULADOR MVP -->
                    <div class="bg-slate-900 rounded-xl p-6 shadow-2xl mb-8 border border-slate-700">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-bold text-lg">Simulador: Construyendo tu MVP</h3>
                            <button id="reset-mvp"
                                class="text-xs text-kawn-base hover:text-white transition-colors underline">Reiniciar</button>
                        </div>
                        <p class="text-slate-400 text-sm mb-6">Tienes un presupuesto limitado de tiempo (semanas).
                            Selecciona características para lanzar tu producto. ¿Lograrás validar antes de quedarte sin
                            dinero?</p>

                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h4 class="text-slate-300 text-xs uppercase font-bold tracking-widest">Características
                                    (Coste en Semanas)</h4>

                                <label
                                    class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700 cursor-pointer hover:border-kawn-base transition-colors">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox"
                                            class="mvp-feature w-4 h-4 text-kawn-base bg-slate-900 border-slate-600 rounded focus:ring-kawn-base"
                                            data-cost="2" data-value="80">
                                        <span class="text-slate-200 text-sm">Funcionalidad Principal (Core)</span>
                                    </div>
                                    <span class="text-xs font-bold text-kawn-light">2 sem</span>
                                </label>

                                <label
                                    class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700 cursor-pointer hover:border-kawn-base transition-colors">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox"
                                            class="mvp-feature w-4 h-4 text-kawn-base bg-slate-900 border-slate-600 rounded focus:ring-kawn-base"
                                            data-cost="4" data-value="10">
                                        <span class="text-slate-200 text-sm">Diseño UI Perfecto & Logo</span>
                                    </div>
                                    <span class="text-xs font-bold text-red-300">4 sem</span>
                                </label>

                                <label
                                    class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700 cursor-pointer hover:border-kawn-base transition-colors">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox"
                                            class="mvp-feature w-4 h-4 text-kawn-base bg-slate-900 border-slate-600 rounded focus:ring-kawn-base"
                                            data-cost="3" data-value="20">
                                        <span class="text-slate-200 text-sm">Login con Redes Sociales</span>
                                    </div>
                                    <span class="text-xs font-bold text-yellow-300">3 sem</span>
                                </label>

                                <label
                                    class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700 cursor-pointer hover:border-kawn-base transition-colors">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox"
                                            class="mvp-feature w-4 h-4 text-kawn-base bg-slate-900 border-slate-600 rounded focus:ring-kawn-base"
                                            data-cost="1" data-value="50">
                                        <span class="text-slate-200 text-sm">Formulario de Feedback</span>
                                    </div>
                                    <span class="text-xs font-bold text-kawn-light">1 sem</span>
                                </label>
                            </div>

                            <div class="bg-slate-800 rounded-lg p-4 flex flex-col justify-between">
                                <div>
                                    <h4 class="text-slate-300 text-xs uppercase font-bold tracking-widest mb-4">
                                        Resultados de Lanzamiento</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                                <span>Tiempo Invertido (Máx 6 sem)</span>
                                                <span id="time-spent" class="text-white font-bold">0 sem</span>
                                            </div>
                                            <div class="w-full bg-slate-700 rounded-full h-2">
                                                <div id="bar-time"
                                                    class="bg-blue-500 h-2 rounded-full transition-all duration-500"
                                                    style="width: 0%"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="flex justify-between text-xs text-slate-400 mb-1">
                                                <span>Validación de Mercado</span>
                                                <span id="market-val" class="text-white font-bold">0%</span>
                                            </div>
                                            <div class="w-full bg-slate-700 rounded-full h-2">
                                                <div id="bar-val"
                                                    class="bg-kawn-base h-2 rounded-full transition-all duration-500"
                                                    style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="mvp-feedback"
                                    class="mt-4 p-3 bg-slate-900 border border-slate-700 rounded text-xs text-slate-300 italic min-h-[60px] flex items-center justify-center text-center">
                                    Selecciona características para empezar...
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Fase 3: Testear -->
                <section id="fase-3-testear" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="flask-conical" class="text-kawn-base mr-3"></i> Fase 3: Testear
                    </h2>
                    <div class="prose max-w-none text-slate-600 leading-7">
                        <p class="mb-4">Aquí es donde la idea se encuentra con la realidad. Convertimos el
                            emprendimiento en un experimento científico: construimos, medimos y aprendemos.</p>

                        <div class="grid md:grid-cols-2 gap-6 my-6">
                            <div class="bg-white p-5 rounded-xl border-t-4 border-kawn-base shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-2">Métricas Vanidosas</h4>
                                <p class="text-sm text-slate-500">Likes, descargas totales, visitas. Te hacen sentir
                                    bien pero no indican salud real.</p>
                            </div>
                            <div class="bg-white p-5 rounded-xl border-t-4 border-kawn-deep shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-2">Métricas Accionables</h4>
                                <p class="text-sm text-slate-500">Tasa de retención, conversión, coste de adquisición.
                                    Te ayudan a tomar decisiones.</p>
                            </div>
                        </div>

                        <p class="mb-6">Si los datos no respaldan tu hipótesis, tienes dos opciones: Pivotar o
                            Perseverar.</p>
                    </div>

                    <!-- AI Feature: Pivot Analyzer -->
                    <div class="mb-8 p-6 bg-kawn-deep rounded-xl shadow-lg border border-slate-700 text-white">
                        <h4 class="font-bold mb-4 flex items-center gap-2 text-kawn-light">
                            <i data-lucide="compass" class="w-5 h-5"></i> Analizador de Pivote vs. Perseverancia
                            (Powered by Gemini)
                        </h4>
                        <p class="text-sm text-slate-300 mb-4">Describe la situación actual de tu startup (métricas,
                            feedback, tiempo). La IA te dará un consejo estratégico basado en la metodología ICT.</p>
                        <div class="flex gap-2 mb-4">
                            <textarea id="pivot-input" rows="2"
                                class="flex-1 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-kawn-base"
                                placeholder="Ej: Llevamos 3 meses, 1000 visitas pero 0 ventas. Los usuarios dicen que es caro."></textarea>
                        </div>
                        <button id="pivot-btn"
                            class="w-full ai-gradient-btn text-white px-4 py-2 rounded text-xs font-bold flex justify-center items-center gap-2 hover:opacity-90 transition-opacity">
                            <i data-lucide="sparkles" class="w-4 h-4"></i> Analizar Estrategia
                        </button>
                        <div id="pivot-result"
                            class="hidden mt-4 p-4 bg-slate-800 rounded border border-slate-600 text-sm italic"
                            aria-live="polite"></div>
                    </div>

                    <!-- NUEVO CONTENIDO: A/B TESTING -->
                    <div class="mt-8 mb-8 bg-slate-50 p-6 rounded-xl border border-slate-200">
                        <h3 class="text-xl font-bold text-slate-900 mb-3">La Ciencia del A/B Testing</h3>
                        <p class="text-slate-600 mb-4">
                            Para optimizar decisiones, el A/B Testing permite comparar dos versiones (A y B) mostradas
                            aleatoriamente a usuarios similares. Es la forma definitiva de eliminar el "yo creo que..."
                            y sustituirlo por "los datos dicen que...".
                        </p>

                        <!-- Interactivo: Simulador A/B Testing -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="font-bold text-slate-800 mb-4 flex justify-between">
                                <span>Simulador A/B Testing en Tiempo Real</span>
                                <span
                                    class="text-xs font-normal bg-green-100 text-green-800 px-2 py-1 rounded-full">Live
                                    Demo</span>
                            </h4>
                            <div class="flex gap-4 mb-4">
                                <div class="flex-1 text-center p-3 border-2 border-slate-200 rounded-lg"
                                    id="variant-a-box">
                                    <div class="font-bold text-slate-500">Variante A (Original)</div>
                                    <div class="text-3xl font-black text-slate-800 mt-2" id="conv-a">0%</div>
                                    <div class="text-xs text-slate-400">Conversión</div>
                                </div>
                                <div class="flex-1 text-center p-3 border-2 border-kawn-base rounded-lg bg-kawn-light/10"
                                    id="variant-b-box">
                                    <div class="font-bold text-kawn-dark">Variante B (Nueva)</div>
                                    <div class="text-3xl font-black text-kawn-base mt-2" id="conv-b">0%</div>
                                    <div class="text-xs text-kawn-dark/60">Conversión</div>
                                </div>
                            </div>
                            <button id="run-ab-test"
                                class="w-full bg-slate-800 text-white font-bold py-2 rounded hover:bg-slate-700 transition-colors">
                                Lanzar Tráfico (1000 Usuarios)
                            </button>
                            <p id="ab-result" class="text-center text-sm font-bold mt-3 text-slate-600 h-5"></p>
                        </div>
                    </div>

                    <!-- NUEVA SECCIÓN: ANÁLISIS DE COHORTES -->
                    <div class="mt-8 mb-8 border-t border-slate-200 pt-8">
                        <h3 class="text-xl font-bold text-slate-900 mb-3 flex items-center gap-2">
                            <i data-lucide="users" class="text-kawn-base w-6 h-6"></i> La Verdad Oculta: Análisis de
                            Cohortes
                        </h3>
                        <p class="text-slate-600 mb-4">
                            Las métricas totales (ej. "10,000 usuarios registrados") mienten porque mezclan usuarios
                            viejos y nuevos. Las cohortes agrupan usuarios por fecha de inicio y rastrean su retención a
                            lo largo del tiempo. Es la única forma de saber si tu producto tiene un "cubo agujereado".
                        </p>

                        <!-- Interactivo: Simulador de Heatmap -->
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                            <h4 class="font-bold text-slate-800 mb-2">Simulador de Salud de Cohortes</h4>
                            <div class="mb-4">
                                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider block mb-2">Tasa
                                    de Retención Mensual (Ajusta para ver el destino de tu startup)</label>
                                <input type="range" id="retention-slider" min="10" max="95" value="60"
                                    class="w-full cursor-pointer">
                                <div class="flex justify-between text-xs text-slate-400 mt-1">
                                    <span>Pésima (10%)</span>
                                    <span id="retention-val" class="font-bold text-kawn-base text-lg">60%</span>
                                    <span>Excelente (95%)</span>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full text-xs text-center border-collapse">
                                    <thead>
                                        <tr class="text-slate-400 border-b border-slate-100">
                                            <th class="p-2 text-left">Cohorte</th>
                                            <th class="p-2">Mes 1</th>
                                            <th class="p-2">Mes 2</th>
                                            <th class="p-2">Mes 3</th>
                                            <th class="p-2">Mes 4</th>
                                            <th class="p-2">Mes 5</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cohort-body" class="font-mono text-slate-600">
                                        <!-- JS generará las filas -->
                                    </tbody>
                                </table>
                            </div>
                            <p id="cohort-diagnosis" class="text-center text-sm font-bold mt-4 text-slate-600 italic">
                                Diagnóstico...</p>
                        </div>
                    </div>

                    <!-- COMPONENTE INTERACTIVO 3: COMPARADOR PIVOT/PERSEVERE -->
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden mb-8">
                        <div class="flex border-b border-slate-200 bg-slate-50">
                            <button onclick="switchTab('pivot')"
                                class="tab-btn active flex-1 py-4 text-sm font-bold text-slate-600 hover:text-kawn-base border-b-2 border-transparent transition-colors">Pivotar</button>
                            <button onclick="switchTab('persevere')"
                                class="tab-btn flex-1 py-4 text-sm font-bold text-slate-600 hover:text-kawn-base border-b-2 border-transparent transition-colors">Perseverar</button>
                        </div>

                        <div class="p-8 min-h-[200px]">
                            <!-- Contenido Pivot -->
                            <div id="content-pivot" class="tab-content animate-fade-in">
                                <h3 class="text-xl font-bold text-kawn-deep mb-2">Pivotar</h3>
                                <p class="text-slate-600 mb-4">Cambio fundamental en la estrategia sin cambiar la
                                    visión.</p>
                                <ul class="space-y-2 text-sm text-slate-700">
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-kawn-base"></i> <strong>Cuándo:</strong> El
                                        feedback indica que el problema no es importante o la solución no encaja.</li>
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-kawn-base"></i> <strong>Ejemplo:</strong> Twitter
                                        (nació de Odeo, una plataforma de podcasts fallida).</li>
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-kawn-base"></i> <strong>Acción:</strong> Cambiar
                                        segmento de cliente, canal de distribución o tecnología.</li>
                                </ul>
                            </div>

                            <!-- Contenido Persevere -->
                            <div id="content-persevere" class="tab-content hidden animate-fade-in">
                                <h3 class="text-xl font-bold text-slate-700 mb-2">Perseverar</h3>
                                <p class="text-slate-600 mb-4">Mantener el rumbo mejorando la ejecución.</p>
                                <ul class="space-y-2 text-sm text-slate-700">
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-slate-400"></i> <strong>Cuándo:</strong> Las
                                        métricas muestran tracción y retención, aunque el crecimiento sea lento.</li>
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-slate-400"></i> <strong>Ejemplo:</strong> Airbnb
                                        (tuvieron años de crecimiento lento pero usuarios muy fieles).</li>
                                    <li class="flex items-center"><i data-lucide="arrow-right"
                                            class="w-4 h-4 mr-2 text-slate-400"></i> <strong>Acción:</strong> Optimizar
                                        el producto, mejorar marketing, escalar.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Conclusión e Iteración -->
                <section id="conclusion" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Iteración Continua y Escalado</h2>
                    <p class="text-slate-600 mb-4">La metodología ICT es cíclica. Una vez encontrado el
                        <strong>Product-Market Fit</strong>, el foco pasa de aprender a escalar. Sin embargo, las
                        empresas más innovadoras mantienen pequeños "laboratorios" internos para seguir aplicando ICT en
                        nuevas funcionalidades.
                    </p>
                    <p class="text-slate-600 font-medium">Recuerda: "Enamórate del problema, no de tu solución".</p>
                </section>

                <!-- Glosario -->
                <section id="glosario" class="mb-16 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Glosario ICT</h2>
                    <div class="space-y-3" id="glossary-container">
                        <!-- JS inyectará contenido -->
                    </div>
                </section>

                <!-- Ejercicios y Validación -->
                <section id="ejercicios" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="edit-3" class="text-kawn-base mr-3"></i> Práctica y validación
                    </h2>

                    <!-- Módulo de Reflexión -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-slate-800">Reflexión de emprendimiento</h3>
                            <button id="ai-idea-btn"
                                class="ai-gradient-btn text-white text-xs font-bold py-1.5 px-3 rounded-lg transition-colors flex items-center gap-2 hover:opacity-90">
                                <i data-lucide="lightbulb" class="w-4 h-4"></i> Generar Idea con IA
                            </button>
                        </div>

                        <div id="ai-idea-display"
                            class="hidden mb-4 p-4 bg-slate-50 border-l-4 border-indigo-500 text-slate-700 text-sm rounded-r-lg italic">
                        </div>

                        <p class="text-sm text-slate-600 mb-4">Define una hipótesis para un problema que veas en tu
                            entorno diario:</p>
                        <textarea
                            class="w-full p-3 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-kawn-base focus:border-transparent outline-none transition-all"
                            rows="3"
                            placeholder="Ej: Los dueños de mascotas en apartamentos no tienen tiempo para pasear a sus perros al mediodía..."></textarea>
                    </div>

                    <!-- QUIZ -->
                    <div class="bg-kawn-deep p-8 rounded-xl shadow-2xl text-white">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold">Validación del Conocimiento</h3>
                            <span id="quiz-score" class="bg-white/20 px-3 py-1 rounded-full text-sm font-mono">Score:
                                0/0</span>
                        </div>

                        <div id="quiz-container" class="space-y-6">
                            <!-- JS inyectará preguntas -->
                        </div>

                        <div id="quiz-complete" class="hidden text-center mt-6">
                            <p class="text-2xl font-bold mb-2">¡Completado!</p>
                            <p class="text-sm opacity-80 mb-4" id="final-msg">Has repasado la metodología ICT.</p>
                            <button onclick="window.resetQuiz()"
                                class="bg-white text-kawn-deep px-6 py-2 rounded-lg font-bold text-sm hover:bg-gray-100 transition-colors">Reiniciar
                                Test</button>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- AI Mentor Float -->
    <button id="ai-toggle"
        class="fixed bottom-6 right-6 z-40 bg-slate-900 text-white p-4 rounded-full shadow-glow hover:scale-105 transition-transform flex items-center gap-2"
        aria-label="Abrir mentor virtual" aria-controls="ai-modal">
        <i data-lucide="bot" class="w-6 h-6 text-kawn-base"></i>
        <span class="font-bold hidden md:inline">Mentor ICT IA</span>
    </button>

    <!-- AI Modal -->
    <div id="ai-modal"
        class="hidden fixed bottom-24 right-6 w-96 max-w-[90vw] bg-white rounded-xl shadow-2xl border border-slate-200 z-50 flex flex-col h-[500px]"
        role="dialog" aria-modal="true" aria-labelledby="ai-modal-title">
        <div class="p-4 bg-slate-900 text-white rounded-t-xl flex justify-between items-center">
            <h3 id="ai-modal-title" class="font-bold flex items-center gap-2"><i data-lucide="bot"
                    class="text-kawn-base w-4 h-4"></i> Mentor KawnBit</h3>
            <button id="close-ai" class="hover:text-kawn-light" aria-label="Cerrar chat"><i data-lucide="x"
                    class="w-5 h-5"></i></button>
        </div>
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 bg-slate-50 flex flex-col chat-container">
            <div class="ai-msg message-bubble shadow-sm">
                Hola. Soy tu especialista en Metodología ICT. ¿Necesitas ayuda para definir tu MVP o una hipótesis de
                validación?
            </div>
        </div>
        <div class="p-4 border-t border-slate-200 bg-white rounded-b-xl relative">
            <div class="flex gap-2">
                <input type="text" id="user-input"
                    class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-kawn-base focus:ring-1 focus:ring-kawn-base transition-all"
                    placeholder="Pregunta sobre innovación...">
                <button id="send-ai"
                    class="bg-kawn-base text-white p-2 rounded-lg hover:bg-kawn-dark transition-colors disabled:opacity-50"
                    aria-label="Enviar mensaje">
                    <i data-lucide="send" class="w-4 h-4"></i>
                </button>
            </div>
            <div id="ai-loading"
                class="hidden absolute top-[-30px] left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs px-3 py-1 rounded-full shadow-lg">
                Procesando...
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-12 mt-20 border-t border-slate-800">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="kawn-logo-wrapper">
                <div class="kawn-logo-icon"></div>
                <div class="flex flex-col">
                    <span class="text-2xl font-black text-white tracking-tight leading-none">KAWNBIT</span>
                    <span
                        class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.2em] leading-none mt-1">Quantitative
                        Trading Community</span>
                </div>
            </div>
            <div class="text-center md:text-right">
                <p class="text-sm">© <span id="current-year"></span> KawnBit Community.</p>
                <p class="text-xs opacity-50 mt-1">Material educativo sobre Innovación y Emprendimiento.<br>Diseñado
                    para el éxito.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Inicialización de Iconos con un chequeo
            if (typeof lucide !== 'undefined') lucide.createIcons();

            document.getElementById('current-year').textContent = new Date().getFullYear();

            // -------------------------------------------------------------------------
            // 0. SECURITY & CONFIG: NETLIFY PROXY
            // -------------------------------------------------------------------------
            // SECURITY NOTE: This points to a Netlify function to hide API keys.
            // DO NOT replace with a direct API key in production.
            const proxyUrl = "/.netlify/functions/gemini-proxy";

            async function callGeminiAPI(prompt, systemInstruction = "Eres un experto en Metodología ICT.") {
                try {
                    const response = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    });

                    if (!response.ok) {
                        if (response.status === 404) throw new Error("Proxy no encontrado. Verifica que la función de Netlify esté desplegada.");
                        if (response.status === 500) throw new Error("Error interno del servidor de IA.");
                        throw new Error(`Error HTTP: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || data.result || "Lo siento, la IA no devolvió una respuesta válida.";

                } catch (error) {
                    console.error("AI Error:", error);
                    return `<span class="text-red-500 font-bold">Error:</span> No se pudo conectar con el mentor virtual. (${error.message})`;
                }
            }

            // -------------------------------------------------------------------------
            // 1. TOC DINÁMICO & MENU MÓVIL (UX)
            // -------------------------------------------------------------------------
            const tocContainer = document.getElementById('toc-container');
            const sections = document.querySelectorAll('main section[id]');

            // Generación TOC
            if (tocContainer) {
                sections.forEach(section => {
                    const h2 = section.querySelector('h2');
                    if (h2) {
                        const link = document.createElement('a');
                        link.href = `#${section.id}`;
                        link.textContent = h2.innerText.replace(/Fase \d: /, ""); // Cleaner text
                        link.className = `toc-link block py-2 pl-3 border-l-2 border-transparent text-slate-500 hover:text-slate-900 hover:bg-slate-50 rounded-r-md transition-all truncate cursor-pointer`;

                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            document.getElementById(section.id).scrollIntoView({ behavior: 'smooth' });
                            // Mobile UX: Close menu on click
                            closeMobileMenu();
                        });
                        tocContainer.appendChild(link);
                    }
                });

                // Intersection Observer para Active State
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            document.querySelectorAll('.toc-link').forEach(link => link.classList.remove('active'));
                            const activeLink = document.querySelector(`.toc-link[href="#${entry.target.id}"]`);
                            if (activeLink) activeLink.classList.add('active');
                        }
                    });
                }, { rootMargin: '-20% 0px -60% 0px' });
                sections.forEach(section => observer.observe(section));
            }

            // Mobile Menu Logic
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar-toc');

            function toggleMobileMenu() {
                const isHidden = sidebar.classList.contains('hidden');
                if (isHidden) {
                    sidebar.classList.remove('hidden');
                    sidebar.classList.add('fixed', 'inset-0', 'z-40', 'bg-white', 'p-6');
                    mobileMenuBtn.setAttribute('aria-expanded', 'true');
                    // Add close button if not exists
                    if (!document.getElementById('close-menu-btn')) {
                        const closeBtn = document.createElement('button');
                        closeBtn.id = 'close-menu-btn';
                        closeBtn.className = 'absolute top-4 right-4 p-2 text-slate-500';
                        closeBtn.innerHTML = '<i data-lucide="x" class="w-6 h-6"></i>';
                        closeBtn.onclick = closeMobileMenu;
                        sidebar.appendChild(closeBtn);
                        if (typeof lucide !== 'undefined') lucide.createIcons();
                    }
                } else {
                    closeMobileMenu();
                }
            }

            function closeMobileMenu() {
                // Only act if we are in mobile mode (sidebar has 'fixed' class)
                if (sidebar.classList.contains('fixed')) {
                    sidebar.classList.add('hidden');
                    sidebar.classList.remove('fixed', 'inset-0', 'z-40', 'bg-white', 'p-6');
                    mobileMenuBtn.setAttribute('aria-expanded', 'false');
                }
            }

            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            }

            // -------------------------------------------------------------------------
            // 2. CHART.JS: VISUALIZADORES (Gestión Memoria)
            // -------------------------------------------------------------------------
            let charts = {}; // Store instances to destroy if needed

            // A. Risk Chart
            const riskCanvas = document.getElementById('riskChart');
            if (typeof Chart !== 'undefined' && riskCanvas) {
                if (charts.risk) charts.risk.destroy();
                charts.risk = new Chart(riskCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Idea', 'Prototipo', 'MVP', 'Beta', 'Lanzamiento'],
                        datasets: [{
                            label: 'Riesgo Modelo Tradicional',
                            data: [10, 20, 40, 70, 100],
                            borderColor: '#ef4444',
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'Riesgo Modelo ICT',
                            data: [10, 15, 20, 25, 30],
                            borderColor: '#14b8a6',
                            backgroundColor: 'rgba(20, 184, 166, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    afterBody: (ctx) => ctx[0].datasetIndex === 0 ? "El coste del fracaso se dispara al final." : "El riesgo se mitiga en cada etapa."
                                }
                            }
                        },
                        scales: { y: { title: { display: true, text: 'Coste del Fallo' } } }
                    }
                });
            }

            // B. Kano Model Chart
            const kanoCanvas = document.getElementById('kanoChart');
            if (typeof Chart !== 'undefined' && kanoCanvas) {
                if (charts.kano) charts.kano.destroy();
                charts.kano = new Chart(kanoCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Poco Implementado', 'Neutro', 'Muy Implementado'],
                        datasets: [
                            {
                                label: 'Básicas (Must-be)',
                                data: [-10, 0, 2],
                                borderColor: '#ef4444',
                                tension: 0.4,
                                pointRadius: 0
                            },
                            {
                                label: 'Prestacionales (Performance)',
                                data: [-5, 0, 5],
                                borderColor: '#3b82f6',
                                tension: 0,
                                pointRadius: 0
                            },
                            {
                                label: 'Deleitadores (Delighters)',
                                data: [0, 2, 10],
                                borderColor: '#22c55e',
                                tension: 0.4,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: { enabled: false }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Satisfacción Cliente' },
                                ticks: { callback: (v) => v > 0 ? '😃' : (v < 0 ? '😡' : '😐') }
                            },
                            x: {
                                title: { display: true, text: 'Nivel de Ejecución' },
                                ticks: { display: false }
                            }
                        }
                    }
                });
            }

            // -------------------------------------------------------------------------
            // 3. COMPARADOR INTERACTIVO (Tabs)
            // -------------------------------------------------------------------------
            window.switchTab = function (tabName) {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active', 'border-kawn-base', 'text-kawn-base');
                    if (btn.onclick.toString().includes(tabName)) btn.classList.add('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                const target = document.getElementById(`content-${tabName}`);
                if (target) target.classList.remove('hidden');
            }

            // -------------------------------------------------------------------------
            // 4. SIMULADOR MVP (Robustez)
            // -------------------------------------------------------------------------
            const checkboxes = document.querySelectorAll('.mvp-feature');
            const timeDisplay = document.getElementById('time-spent');
            const valDisplay = document.getElementById('market-val');
            const barTime = document.getElementById('bar-time');
            const barVal = document.getElementById('bar-val');
            const feedback = document.getElementById('mvp-feedback');

            function updateSimulator() {
                let time = 0;
                let value = 0;
                let hasCore = false;

                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        time += parseInt(cb.dataset.cost);
                        value += parseInt(cb.dataset.value);
                        if (cb.dataset.value == "80") hasCore = true;
                    }
                });

                // Logic
                let feedbackText = "";
                let timeColor = "bg-blue-500";

                if (time > 6) {
                    feedbackText = "⛔ ¡Te has pasado del tiempo! El mercado ha cambiado o te has quedado sin fondos.";
                    timeColor = "bg-red-500";
                    value = 0;
                } else if (time === 0) {
                    feedbackText = "Selecciona características para empezar.";
                } else if (!hasCore) {
                    feedbackText = "⚠️ Estás construyendo cosas bonitas, pero te falta la funcionalidad principal.";
                    value = Math.min(value, 10);
                } else {
                    if (value > 90) feedbackText = "🚀 ¡Excelente MVP! Has validado el problema con el esfuerzo justo.";
                    else feedbackText = "✅ Buen camino. Tienes un producto funcional dentro del plazo.";
                }

                if (timeDisplay) timeDisplay.innerText = `${time} sem`;
                if (valDisplay) valDisplay.innerText = `${value}%`;

                if (barTime) {
                    barTime.style.width = `${Math.min((time / 6) * 100, 100)}%`;
                    barTime.className = `${timeColor} h-2 rounded-full transition-all duration-500`;
                }
                if (barVal) barVal.style.width = `${value}%`;
                if (feedback) feedback.innerText = feedbackText;
            }

            checkboxes.forEach(cb => cb.addEventListener('change', updateSimulator));
            const resetMvpBtn = document.getElementById('reset-mvp');
            if (resetMvpBtn) resetMvpBtn.addEventListener('click', () => {
                checkboxes.forEach(cb => cb.checked = false);
                updateSimulator();
            });

            // -------------------------------------------------------------------------
            // 5. THE MOM TEST (AI)
            // -------------------------------------------------------------------------
            const momTestBtn = document.getElementById('mom-test-btn');
            const momTestInput = document.getElementById('mom-test-input');
            const momTestResult = document.getElementById('mom-test-result');

            if (momTestBtn) {
                momTestBtn.addEventListener('click', async () => {
                    const text = momTestInput.value.trim();
                    if (!text) return;

                    momTestBtn.disabled = true;
                    momTestBtn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Simulando...`;
                    if (typeof lucide !== 'undefined') lucide.createIcons();

                    momTestResult.classList.remove('hidden');
                    momTestResult.innerHTML = "La 'mamá' está pensando...";

                    const prompt = `Roleplay Madre Mom Test: Usuario pregunta "${text}". Responde 1. Como mamá cariñosa (falso positivo). 2. Crítica experta sobre por qué la pregunta falla el Mom Test.`;

                    const response = await callGeminiAPI(prompt);
                    momTestResult.innerHTML = response.replace(/\n/g, '<br>');

                    momTestBtn.disabled = false;
                    momTestBtn.innerHTML = `<i data-lucide="sparkles" class="w-4 h-4"></i> Simular`;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                });
            }

            // -------------------------------------------------------------------------
            // 6. A/B TESTING (Cleanup)
            // -------------------------------------------------------------------------
            const runABBtn = document.getElementById('run-ab-test');
            let abInterval = null;

            if (runABBtn) {
                runABBtn.addEventListener('click', () => {
                    if (abInterval) clearInterval(abInterval); // Safety check

                    runABBtn.disabled = true;
                    runABBtn.innerText = "Recopilando datos...";

                    const convAEl = document.getElementById('conv-a');
                    const convBEl = document.getElementById('conv-b');
                    const resEl = document.getElementById('ab-result');

                    let users = 0;
                    let cA = 0;
                    let cB = 0;
                    const rateA = 0.05;
                    const rateB = 0.08;

                    abInterval = setInterval(() => {
                        users += 50;
                        if (Math.random() > 1 - rateA) cA++;
                        if (Math.random() > 1 - rateB) cB++;

                        convAEl.innerText = ((cA / (users / 2)) * 100).toFixed(1) + "%";
                        convBEl.innerText = ((cB / (users / 2)) * 100).toFixed(1) + "%";

                        if (users >= 1000) {
                            clearInterval(abInterval);
                            runABBtn.disabled = false;
                            runABBtn.innerText = "Lanzar Tráfico (1000 Usuarios)";
                            resEl.innerText = `🏆 La Variante B mejoró la conversión un ${(((rateB - rateA) / rateA) * 100).toFixed(0)}%. ¡Implementar B!`;
                            resEl.className = "text-center text-sm font-bold mt-3 text-kawn-base";
                        }
                    }, 50);
                });
            }

            // -------------------------------------------------------------------------
            // 7. PIVOT ANALYZER (AI)
            // -------------------------------------------------------------------------
            const pivotBtn = document.getElementById('pivot-btn');
            const pivotInput = document.getElementById('pivot-input');
            const pivotResult = document.getElementById('pivot-result');

            if (pivotBtn) {
                pivotBtn.addEventListener('click', async () => {
                    const text = pivotInput.value.trim();
                    if (!text) return;

                    pivotBtn.disabled = true;
                    pivotBtn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Analizando...`;
                    if (typeof lucide !== 'undefined') lucide.createIcons();

                    pivotResult.classList.remove('hidden');
                    pivotResult.innerHTML = "Analizando métricas...";

                    const prompt = `Analiza Startup: "${text}". Aconseja PIVOTAR, PERSEVERAR o CERRAR basándote en Lean Startup y Metodología ICT. Breve.`;

                    const response = await callGeminiAPI(prompt);
                    pivotResult.innerHTML = `<strong class="text-kawn-light">Consejo Estratégico:</strong><br>${response.replace(/\n/g, '<br>')}`;

                    pivotBtn.disabled = false;
                    pivotBtn.innerHTML = `<i data-lucide="sparkles" class="w-4 h-4"></i> Analizar Estrategia`;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                });
            }

            // -------------------------------------------------------------------------
            // 8. COHORT HEATMAP SIMULATOR (New)
            // -------------------------------------------------------------------------
            const retentionSlider = document.getElementById('retention-slider');
            const retentionVal = document.getElementById('retention-val');
            const cohortBody = document.getElementById('cohort-body');
            const cohortDiagnosis = document.getElementById('cohort-diagnosis');

            function updateCohorts() {
                if (!retentionSlider) return;

                const rate = parseInt(retentionSlider.value);
                retentionVal.innerText = `${rate}%`;
                cohortBody.innerHTML = ''; // Clear

                // Generate 5 cohorts
                for (let i = 0; i < 5; i++) {
                    const tr = document.createElement('tr');
                    tr.className = "border-b border-slate-50 hover:bg-slate-50/50";

                    // Cohort Name
                    const tdName = document.createElement('td');
                    tdName.className = "p-2 font-bold text-slate-700 text-left";
                    tdName.innerText = `Cohorte ${i + 1}`;
                    tr.appendChild(tdName);

                    // Months columns
                    let currentVal = 100; // Always starts at 100%
                    for (let j = 0; j < 5; j++) {
                        const td = document.createElement('td');
                        td.className = "p-2 transition-colors duration-500 rounded";

                        if (j < i) {
                            td.innerText = ""; // Future month for this cohort
                        } else {
                            if (j > i) {
                                // Decay formula
                                currentVal = currentVal * (rate / 100);
                            }
                            // Color logic based on value (Heatmap)
                            const val = Math.round(currentVal);
                            td.innerText = `${val}%`;

                            if (val > 80) td.style.backgroundColor = '#ccfbf1'; // Teal 100
                            else if (val > 50) td.style.backgroundColor = '#fef9c3'; // Yellow 100
                            else if (val > 20) td.style.backgroundColor = '#fee2e2'; // Red 100
                            else td.style.backgroundColor = '#f1f5f9'; // Slate 100 (Dead)
                        }
                        tr.appendChild(td);
                    }
                    cohortBody.appendChild(tr);
                }

                // Diagnosis Logic
                if (rate < 40) {
                    cohortDiagnosis.innerText = "🚨 Alerta Roja: El cubo está agujereado. No inviertas en marketing, arregla el producto.";
                    cohortDiagnosis.className = "text-center text-sm font-bold mt-4 text-red-500";
                } else if (rate < 70) {
                    cohortDiagnosis.innerText = "⚠️ Regular: Retención mediocre. Necesitas mejorar la activación de usuarios.";
                    cohortDiagnosis.className = "text-center text-sm font-bold mt-4 text-yellow-600";
                } else {
                    cohortDiagnosis.innerText = "🚀 Saludable: ¡Tienes Product-Market Fit! Es hora de escalar.";
                    cohortDiagnosis.className = "text-center text-sm font-bold mt-4 text-green-600";
                }
            }

            if (retentionSlider) {
                retentionSlider.addEventListener('input', updateCohorts);
                // Initial draw
                updateCohorts();
            }

            // -------------------------------------------------------------------------
            // 9. GLOSARIO (Fixed Selector Robustness)
            // -------------------------------------------------------------------------
            window.toggleGlos = function (idx, btnElement) {
                const desc = document.getElementById(`desc-${idx}`);
                // Use relative selection if passed, or fallback to ID
                const icon = document.getElementById(`icon-${idx}`);

                if (desc) {
                    const isHidden = desc.classList.contains('hidden');
                    if (isHidden) {
                        desc.classList.remove('hidden');
                        if (icon) icon.classList.add('rotate-180');
                        if (btnElement) btnElement.setAttribute('aria-expanded', 'true');
                    } else {
                        desc.classList.add('hidden');
                        if (icon) icon.classList.remove('rotate-180');
                        if (btnElement) btnElement.setAttribute('aria-expanded', 'false');
                    }
                }
            }

            const glossaryData = [
                { t: "MVP (Producto Mínimo Viable)", d: "Versión de un producto con las características justas para ser usado por los primeros clientes y obtener feedback." },
                { t: "JTBD (Jobs to be Done)", d: "Teoría que establece que los clientes 'contratan' productos para realizar un trabajo específico en sus vidas." },
                { t: "Pretotipo", d: "Experimento rápido para validar si una idea 'debería' construirse antes de crear el prototipo real." },
                { t: "Design Thinking", d: "Metodología centrada en el usuario para resolver problemas complejos a través de la empatía y prototipado." },
                { t: "Product-Market Fit", d: "Grado en que un producto satisface una fuerte demanda de mercado. El 'santo grial' de las startups." },
                { t: "Mom Test", d: "Regla para entrevistas: preguntar sobre hechos pasados y no opiniones futuras para evitar mentiras piadosas." },
                { t: "A/B Testing", d: "Experimento aleatorio con dos variantes (A y B) para ver cuál produce mejor rendimiento." },
                { t: "Análisis de Cohortes", d: "Estudio del comportamiento de grupos de usuarios a lo largo del tiempo para medir la retención real." },
                { t: "Pivotar", d: "Cambiar fundamentalmente la estrategia del negocio (producto, cliente, modelo) manteniendo la visión, basado en aprendizaje." },
                { t: "Lean Startup", d: "Método para desarrollar negocios y productos basado en la experimentación validada y ciclos cortos de desarrollo." }
            ];

            const glosContainer = document.getElementById('glossary-container');
            if (glosContainer) {
                glossaryData.forEach((item, idx) => {
                    glosContainer.innerHTML += `
                        <div class="border border-slate-200 rounded-lg bg-white overflow-hidden">
                            <button class="w-full px-4 py-3 text-left font-bold text-slate-700 hover:bg-slate-50 flex justify-between items-center transition-colors" onclick="toggleGlos(${idx}, this)" aria-expanded="false">
                                ${item.t}
                                <i data-lucide="chevron-down" class="w-4 h-4 text-kawn-base transition-transform" id="icon-${idx}"></i>
                            </button>
                            <div id="desc-${idx}" class="hidden px-4 py-3 bg-slate-50 text-sm text-slate-600 border-t border-slate-100">${item.d}</div>
                        </div>
                    `;
                });
            }

            // -------------------------------------------------------------------------
            // 10. QUIZ
            // -------------------------------------------------------------------------
            const quizData = [
                { q: "¿Cuál es la causa principal de fracaso del 42% de startups?", opts: ["Falta de dinero", "No resolver una necesidad de mercado", "Mala tecnología"], c: 1, expl: "Construir algo que nadie quiere es el error fatal número 1." },
                { q: "¿Qué fase de ICT se enfoca en 'salir del edificio' y empatizar?", opts: ["Identificar", "Crear", "Testear"], c: 0, expl: "Identificar requiere investigación de usuarios real antes de construir." },
                { q: "¿Qué busca descubrir la teoría de 'Jobs to be Done'?", opts: ["La edad del usuario", "Para qué 'contrata' el usuario el producto", "Cuánto gana el usuario"], c: 1, expl: "Busca la motivación causal, no el perfil demográfico." },
                { q: "¿Cuál es la diferencia entre Pretotipo y Prototipo?", opts: ["Son lo mismo", "El Pretotipo valida el interés (¿Deberíamos?), el Prototipo la factibilidad (¿Podemos?)", "El Pretotipo es más caro"], c: 1, expl: "Pretotipar es validar la demanda antes de invertir en ingeniería." },
                { q: "¿Según el Mom Test, qué debes preguntar?", opts: ["Opiniones sobre el futuro", "Si les gusta tu idea", "Comportamientos pasados reales"], c: 2, expl: "El comportamiento pasado predice el futuro mejor que las promesas." },
                { q: "¿Por qué usar cohortes en lugar de métricas totales?", opts: ["Es más fácil", "Para ver la retención real sin el ruido de nuevos usuarios", "Para impresionar inversores"], c: 1, expl: "Las métricas totales pueden subir mientras pierdes a todos tus usuarios antiguos." },
                { q: "¿Qué caracteriza a un buen MVP?", opts: ["Tener todas las funciones", "Estar libre de errores", "Validar hipótesis con el mínimo esfuerzo"], c: 2, expl: "El MVP es para aprender, no para lucir perfecto." }
            ];

            let score = 0;
            const quizContainer = document.getElementById('quiz-container');

            window.renderQuiz = function () {
                if (!quizContainer) return;
                quizContainer.innerHTML = '';
                quizData.forEach((q, idx) => {
                    const hidden = idx === 0 ? '' : 'hidden';
                    quizContainer.innerHTML += `
                        <div id="q-${idx}" class="quiz-item ${hidden} fade-in-up">
                            <p class="font-bold text-lg mb-4 text-kawn-light">${q.q}</p>
                            <div class="space-y-3">
                                ${q.opts.map((opt, i) => `
                                    <button onclick="handleAnswer(${idx}, ${i === q.c}, this)" class="w-full text-left p-4 rounded-lg bg-slate-800 hover:bg-slate-700 transition-all border border-transparent hover:border-kawn-base/50 text-sm quiz-option">
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            <div id="feedback-${idx}" class="hidden mt-4 p-4 rounded bg-slate-900 border-l-4 border-kawn-base quiz-feedback">
                                <p class="text-sm text-slate-300"><strong>Explicación:</strong> ${q.expl}</p>
                                <button onclick="nextQ(${idx})" class="mt-3 bg-kawn-base text-white px-4 py-2 rounded text-xs font-bold">Siguiente</button>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('quiz-score').innerText = `Score: 0/${quizData.length}`;
            }

            window.handleAnswer = function (idx, correct, btn) {
                const parent = document.getElementById(`q-${idx}`);
                parent.querySelectorAll('button').forEach(b => b.disabled = true);
                if (correct) {
                    btn.classList.add('bg-green-600');
                    btn.innerText += " ✅";
                    score++;
                } else {
                    btn.classList.add('bg-red-600');
                    btn.innerText += " ❌";
                }
                document.getElementById(`feedback-${idx}`).classList.remove('hidden');
                document.getElementById('quiz-score').innerText = `Score: ${score}/${quizData.length}`;
            }

            window.nextQ = function (idx) {
                document.getElementById(`q-${idx}`).classList.add('hidden');
                if (idx + 1 < quizData.length) {
                    document.getElementById(`q-${idx + 1}`).classList.remove('hidden');
                } else {
                    document.getElementById('quiz-complete').classList.remove('hidden');
                }
            }

            window.resetQuiz = function () {
                score = 0;
                document.getElementById('quiz-complete').classList.add('hidden');
                renderQuiz();
            }
            renderQuiz();

            // -------------------------------------------------------------------------
            // 11. AI MENTOR & IDEA GENERATOR
            // -------------------------------------------------------------------------
            const aiModal = document.getElementById('ai-modal');
            const chatHistory = document.getElementById('chat-history');

            document.getElementById('ai-toggle').addEventListener('click', () => aiModal.classList.remove('hidden'));
            document.getElementById('close-ai').addEventListener('click', () => aiModal.classList.add('hidden'));

            // Chat General
            const sendBtn = document.getElementById('send-ai');
            const userInp = document.getElementById('user-input');
            const loading = document.getElementById('ai-loading');

            async function handleChat() {
                const txt = userInp.value.trim();
                if (!txt) return;

                chatHistory.innerHTML += `<div class="user-msg message-bubble fade-in-up self-end">${txt}</div>`;
                userInp.value = '';
                loading.classList.remove('hidden');
                sendBtn.disabled = true;

                const response = await callGeminiAPI(`Actúa como experto en Metodología ICT. Brevemente: ${txt}`);

                chatHistory.innerHTML += `<div class="ai-msg message-bubble fade-in-up self-start">${response}</div>`;
                loading.classList.add('hidden');
                sendBtn.disabled = false;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }

            if (sendBtn) sendBtn.addEventListener('click', handleChat);
            if (userInp) userInp.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleChat();
            });

            // Idea Generator
            const ideaBtn = document.getElementById('ai-idea-btn');
            const ideaDisplay = document.getElementById('ai-idea-display');
            if (ideaBtn) {
                ideaBtn.addEventListener('click', async () => {
                    ideaDisplay.classList.remove('hidden');
                    ideaDisplay.innerHTML = "Generando idea innovadora...";
                    ideaBtn.disabled = true;

                    const response = await callGeminiAPI("Genera idea startup aleatoria + problema para fase Identificar ICT.");
                    ideaDisplay.innerHTML = `<strong>Idea IA:</strong> ${response}`;
                    ideaBtn.disabled = false;
                });
            }

        });
    </script>
</body>

</html>