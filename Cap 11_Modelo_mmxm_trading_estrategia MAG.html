<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KawnBit Magazine | Modelo MMxM de Trading (AI Powered)</title>
    <meta name="description"
        content="Gu√≠a avanzada, interactiva y ampliada sobre el Modelo MMxM de Trading, Smart Money Concepts, Kill Zones y SMT.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@400;600;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Marked for Markdown parsing in AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kawn: {
                            light: '#ccfbf1', // Teal 100
                            base: '#14b8a6',  // Teal 500
                            dark: '#0f766e',  // Teal 700
                            deep: '#134e4a',  // Teal 900
                            accent: '#0d9488' // Teal 600
                        },
                        slate: {
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'dash': 'dash 2s linear forwards',
                    },
                    keyframes: {
                        dash: {
                            '0%': { strokeDasharray: '1000', strokeDashoffset: '1000' },
                            '100%': { strokeDasharray: '1000', strokeDashoffset: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles for Magazine Feel */
        body {
            background-color: #f8fafc;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        th {
            font-family: 'Montserrat', sans-serif;
        }

        p,
        li,
        td {
            font-family: 'Inter', sans-serif;
            line-height: 1.75;
        }

        /* Hero Section Gradient */
        .hero-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #134e4a 100%);
        }

        /* Chart/Visual Container Styles */
        .visual-container {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            margin: 2rem 0;
            overflow: hidden;
            position: relative;
        }

        .visual-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #0f766e;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        /* Custom Table Styles */
        .magazine-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .magazine-table th {
            background-color: #134e4a;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 700;
        }

        .magazine-table td {
            background-color: white;
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            color: #334155;
        }

        .magazine-table tr:last-child td {
            border-bottom: none;
        }

        /* Lists */
        .custom-list li {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: start;
        }

        .custom-list li i {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
            color: #14b8a6;
        }

        /* Blockquotes */
        .highlight-quote {
            border-left: 4px solid #14b8a6;
            background-color: #f0fdfa;
            padding: 1.5rem;
            font-style: italic;
            color: #134e4a;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 2rem 0;
        }

        /* Interactive Graph Styles */
        .graph-btn {
            background-color: #0f766e;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .graph-btn:hover {
            background-color: #134e4a;
            transform: translateY(-1px);
        }

        .graph-btn:active {
            transform: translateY(0);
        }

        .graph-btn:disabled {
            background-color: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .graph-btn.secondary {
            background-color: white;
            color: #0f766e;
            border: 1px solid #0f766e;
        }

        .graph-btn.secondary:hover {
            background-color: #f0fdfa;
        }

        .chart-point {
            transition: r 0.3s ease, fill 0.3s ease;
            cursor: pointer;
        }

        .chart-point:hover {
            r: 8;
        }

        /* Tooltip */
        .chart-tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.9);
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 50;
            max-width: 200px;
        }

        .path-animate {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 3s linear forwards;
        }

        /* Range Slider Styling for PD Array */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }

        input[type=range]:focus {
            outline: none;
        }

        /* AI Chat Styles */
        .ai-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
        }

        .ai-message.user {
            background-color: #f1f5f9;
            color: #334155;
            border-bottom-right-radius: 0;
            margin-left: 2rem;
        }

        .ai-message.bot {
            background-color: #ccfbf1;
            color: #0f766e;
            border-bottom-left-radius: 0;
            margin-right: 2rem;
            border: 1px solid #99f6e4;
        }

        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #0f766e;
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 2px;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Quiz Styles */
        .quiz-option {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background-color: #f8fafc;
            border-color: #14b8a6;
        }

        .quiz-option.selected {
            background-color: #f0fdfa;
            border-color: #14b8a6;
            font-weight: 500;
        }

        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
        }

        .quiz-option.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #b91c1c;
        }
    </style>
</head>

<body class="text-slate-600 antialiased">

    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-slate-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center flex-shrink-0 mr-6">
                    <!-- Placeholder Logo -->
                    <div
                        class="h-12 w-12 bg-gradient-to-br from-kawn-dark to-kawn-base rounded-lg shadow-sm flex items-center justify-center text-white font-bold text-xl">
                        K</div>
                    <span class="ml-3 font-display font-bold text-slate-800 text-xl hidden md:block">KAWNBIT</span>
                </div>

                <div class="hidden md:flex space-x-8">
                    <a href="#intro"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-sm uppercase tracking-wider">Intro</a>
                    <a href="#mmxm-model"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-sm uppercase tracking-wider">Modelo</a>
                    <a href="#pd-arrays"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-sm uppercase tracking-wider text-kawn-deep font-bold">Premium/Discount</a>
                    <a href="#killzones"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-sm uppercase tracking-wider text-kawn-deep font-bold">Kill
                        Zones</a>
                    <a href="#ai-lab"
                        class="text-kawn-base hover:text-kawn-dark font-bold transition-colors text-sm uppercase tracking-wider flex items-center"><i
                            data-lucide="sparkles" class="w-4 h-4 mr-1"></i> AI Lab</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero-gradient relative text-white py-24 overflow-hidden">
        <div
            class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center opacity-10 mix-blend-overlay">
        </div>
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
            <span
                class="inline-block py-1 px-3 rounded-full bg-kawn-light/20 text-kawn-light text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur-sm">Edici√≥n
                Especial: Estrategia Institucional Ampliada</span>
            <h1 class="text-4xl md:text-6xl font-black tracking-tight leading-tight mb-6">
                Cap√≠tulo 11: Modelo <span class="text-kawn-light">MMxM</span> de Trading
            </h1>
            <p class="text-xl text-slate-200 font-light max-w-2xl mx-auto leading-relaxed">
                (Estrategia Avanzada). Descubre c√≥mo operan las manos fuertes, entiende la manipulaci√≥n del mercado y
                aprende a alinear tu operativa con el "Smart Money".
            </p>
        </div>
    </section>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

        <section id="intro" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="brain-circuit" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Introducci√≥n: Smart Money y Manipulaci√≥n del Mercado</h2>
            </div>

            <p class="mb-4 text-lg leading-relaxed font-medium text-slate-700">
                En el trading moderno es crucial comprender c√≥mo operan los grandes participantes del mercado,
                com√∫nmente llamados <strong class="text-kawn-dark">Smart Money</strong> o "Dinero Inteligente".
            </p>
            <p class="mb-4">
                Este t√©rmino se refiere a instituciones financieras, bancos, fondos de cobertura y market makers que
                manejan enormes vol√∫menes de capital. A diferencia del trader minorista, el Smart Money no sigue
                indicadores t√©cnicos simples ni entra en el mercado por un patr√≥n de velas aislado.
            </p>
            <p class="mb-4">
                Su l√≥gica es distinta: buscan liquidez, inducen movimientos falsos, manipulan zonas clave y luego
                despliegan su verdadero movimiento intencional. En otras palabras, saben d√≥nde est√°n colocadas la
                mayor√≠a de √≥rdenes del p√∫blico minorista (stops de p√©rdidas, √≥rdenes pendientes) y se aprovechan de
                ellas para facilitar la ejecuci√≥n de sus propias posiciones.
            </p>

            <!-- INTERACTIVE GRAPHIC 1: LIQUIDITY SIMULATOR -->
            <div class="visual-container bg-slate-50" id="liquidity-sim-container">
                <div class="visual-title flex justify-between items-center">
                    <div class="flex items-center">
                        <i data-lucide="droplets" class="w-5 h-5 mr-2"></i> Simulaci√≥n: El concepto de Liquidez
                    </div>
                    <button id="btn-hunt-liquidity" class="graph-btn text-xs" onclick="runLiquiditySim()">
                        <i data-lucide="play" class="w-3 h-3"></i> Ejecutar Stop Hunt
                    </button>
                </div>

                <div class="relative h-64 w-full bg-white rounded-lg border border-slate-200 overflow-hidden">
                    <svg id="svg-liquidity" viewBox="0 0 600 250" class="w-full h-full">
                        <!-- Zones -->
                        <rect x="50" y="50" width="500" height="2" fill="#ef4444" opacity="0.3"
                            stroke-dasharray="5,5" />
                        <text x="60" y="40" class="text-xs fill-red-500 font-bold">Resistencia (Stops de Venta)</text>

                        <rect x="50" y="200" width="500" height="2" fill="#10b981" opacity="0.3"
                            stroke-dasharray="5,5" />
                        <text x="60" y="220" class="text-xs fill-green-600 font-bold">Soporte (Stops de Compra)</text>

                        <!-- Price Path (Dynamic) -->
                        <path id="liquidity-price-path" d="M50,125 Q100,150 150,100 T250,130" fill="none"
                            stroke="#64748b" stroke-width="2" />

                        <!-- Liquidity Pools (Hidden initially) -->
                        <circle id="pool-buy" cx="280" cy="40" r="0" fill="#ef4444" opacity="0.2" />
                        <circle id="pool-sell" cx="280" cy="210" r="0" fill="#10b981" opacity="0.2" />

                        <!-- Price Ball -->
                        <circle id="price-ball" cx="250" cy="130" r="5" fill="#0f766e" />

                        <!-- Status Text -->
                        <text id="sim-status" x="300" y="125" text-anchor="middle"
                            class="text-sm font-bold fill-slate-400 opacity-0">Esperando √≥rdenes...</text>
                    </svg>
                </div>
                <div class="mt-3 text-xs text-slate-500 flex justify-between">
                    <span>Haz clic en "Ejecutar Stop Hunt" para ver c√≥mo el algoritmo busca la liquidez.</span>
                </div>
            </div>

            <p class="mb-4">
                Un concepto fundamental aqu√≠ es el de la <strong>liquidez</strong> del mercado. El precio no se mueve al
                azar; tiende a dirigirse hacia donde haya acumulaci√≥n de √≥rdenes, ya que el dinero institucional
                necesita contrapartida para sus operaciones de gran tama√±o.
            </p>
            <p class="mb-4">
                Por eso, con frecuencia el Smart Money espera a que el precio alcance niveles donde muchos traders
                minoristas han puesto sus stop-loss (por ejemplo, justo por debajo de un soporte importante o encima de
                un m√°ximo reciente). Al cazar esos stops, generan la liquidez necesaria ‚Äì un flujo de √≥rdenes en sentido
                contrario ‚Äì para entrar con sus propias posiciones de gran volumen.
            </p>

            <div class="highlight-quote">
                <p class="mb-2">
                    "El stop hunting es una estrategia que busca influir en el precio activando √≥rdenes stop-loss
                    agrupadas, incrementando la volatilidad y generando oportunidades de beneficio".
                </p>
                <footer class="text-sm font-bold text-kawn-deep">‚Äî Investopedia</footer>
            </div>

            <p class="mb-4">
                Esta t√°ctica deliberada de empujar el precio hasta activar clusters de stop-loss se conoce como
                <strong>caza de liquidez</strong> o <strong>stop hunting</strong>. En s√≠ntesis, las manos fuertes
                provocan movimientos bruscos contra la multitud (falsos rompimientos, barridos de nivel) para "sacar" a
                los traders desprevenidos del mercado y posteriormente llevar el precio en la direcci√≥n opuesta con
                menos obst√°culos.
            </p>
            <p class="mb-6">
                Este comportamiento sigue un patr√≥n c√≠clico cl√°sico: <strong class="text-kawn-dark">Acumulaci√≥n ‚Üí
                    Manipulaci√≥n ‚Üí Distribuci√≥n</strong>.
            </p>
            <ul class="custom-list pl-4 mb-6">
                <li><i data-lucide="check-circle-2"></i> Primero se acumulan √≥rdenes (posiciones) discretamente.</li>
                <li><i data-lucide="check-circle-2"></i> Luego se manipula el precio para tomar liquidez (ej. barrer
                    stops).</li>
                <li><i data-lucide="check-circle-2"></i> Finalmente se distribuyen las posiciones provocando el
                    movimiento real de tendencia.</li>
            </ul>
            <p class="mb-4">
                Entender esta din√°mica de manipulaci√≥n del precio por parte del Smart Money es fundamental. Si un trader
                minorista aprende a "leer las huellas" que dejan las instituciones en el gr√°fico ‚Äì como zonas de
                consolidaci√≥n, barridos de m√°ximos/m√≠nimos, y rupturas de estructura ‚Äì podr√° alinear sus operaciones con
                la l√≥gica institucional en vez de caer v√≠ctima de ella.
            </p>
            <p>
                El modelo <strong>MMxM</strong>, que abordaremos en este cap√≠tulo, provee un marco estructurado
                precisamente para reconocer esas huellas y operar en armon√≠a con el Smart Money.
            </p>
        </section>

        <section id="mmxm-model" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="layout-template" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">¬øQu√© es el Modelo MMxM? Definici√≥n y Prop√≥sito</h2>
            </div>

            <p class="mb-6">
                El <strong>Modelo MMxM</strong> (Market Maker Buy/Sell Model) es una estrategia operativa avanzada
                derivada de la metodolog√≠a ICT (Inner Circle Trader). Su objetivo principal es identificar c√≥mo el Smart
                Money manipula el precio para generar liquidez y posicionarse en tendencias ya activas del mercado.
            </p>
            <p class="mb-8">
                A grandes rasgos, este modelo describe un patr√≥n de comportamiento donde los grandes participantes
                llevan al precio a extremos para luego revertirlo, proporcionando a traders informados oportunidades de
                entrar con poco riesgo justo cuando inicia el movimiento de mayor impulso.
            </p>

            <div class="bg-kawn-light/30 p-8 rounded-xl border border-kawn-base/20 mb-10">
                <h3 class="text-xl font-bold text-kawn-deep mb-4">Prop√≥sitos Clave del Modelo MMxM:</h3>
                <ul class="custom-list space-y-3">
                    <li><i data-lucide="target" class="text-kawn-base"></i> <strong>Entender la manipulaci√≥n
                            institucional:</strong> Conocer c√≥mo y por qu√© el Smart Money provoca ciertos movimientos
                        para recoger liquidez antes de despliega una tendencia direccional.</li>
                    <li><i data-lucide="compass" class="text-kawn-base"></i> <strong>Anticipar cambios de
                            direcci√≥n:</strong> Al identificar las etapas de acumulaci√≥n y distribuci√≥n, el trader puede
                        posicionarse a favor del movimiento probable.</li>
                    <li><i data-lucide="trending-up" class="text-kawn-base"></i> <strong>Operar con la tendencia
                            activa:</strong> Se aplica sobre tendencias en curso, buscando puntos de entrada durante
                        retrocesos en vez de adivinar giros.</li>
                    <li><i data-lucide="percent" class="text-kawn-base"></i> <strong>Mejorar el ratio
                            riesgo/beneficio:</strong> Al delinear entradas precisas con stops ajustados, se busca
                        maximizar la ganancia potencial.</li>
                </ul>
            </div>

            <h3 class="text-2xl font-bold text-slate-900 mb-4">Variantes Sim√©tricas: MMBM y MMSM</h3>
            <p class="mb-6">
                El modelo MMxM tiene dos variantes sim√©tricas: una de compra y otra de venta, dependiendo de la
                direcci√≥n de la tendencia principal.
            </p>
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div
                    class="p-6 bg-white rounded-lg shadow-md border-t-4 border-green-500 hover:shadow-lg transition-shadow">
                    <h4 class="font-bold text-lg text-green-700 mb-2 flex items-center"><i data-lucide="trending-up"
                            class="mr-2"></i> MMBM (Modelo de Compra)</h4>
                    <p class="text-sm">Patr√≥n aplicado a contextos bajistas que anteceden un gran movimiento alcista. El
                        Smart Money finge una fase bajista para luego impulsar el precio al alza.</p>
                </div>
                <div
                    class="p-6 bg-white rounded-lg shadow-md border-t-4 border-red-500 hover:shadow-lg transition-shadow">
                    <h4 class="font-bold text-lg text-red-700 mb-2 flex items-center"><i data-lucide="trending-down"
                            class="mr-2"></i> MMSM (Modelo de Venta)</h4>
                    <p class="text-sm">Es la imagen especular, aplicado a contextos alcistas antes de un movimiento
                        bajista. Inducen una subida artificial para posteriormente desplomar el precio.</p>
                </div>
            </div>

            <p class="mb-6">
                Ambos modelos comparten la misma estructura de fases, solo que invertidas. La tabla a continuaci√≥n
                resume la comparaci√≥n:
            </p>

            <div class="overflow-x-auto">
                <table class="magazine-table">
                    <thead>
                        <tr>
                            <th>Fase</th>
                            <th>MMBM ‚Äì Modelo de Compra (Bullish)</th>
                            <th>MMSM ‚Äì Modelo de Venta (Bearish)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-bold text-kawn-dark">1. Consolidaci√≥n Inicial</td>
                            <td>El Smart Money acumula posiciones largas en un rango lateral estrecho (preparando
                                movimiento alcista).</td>
                            <td>El Smart Money acumula posiciones cortas en un rango lateral (anticipando movimiento
                                bajista).</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-dark">2. Movimiento Manipulado</td>
                            <td><em>Movimiento Bajista de enga√±o:</em> rompe a la baja generando liquidez (stops de
                                compradores).</td>
                            <td><em>Movimiento Alcista de enga√±o:</em> rompe al alza cazando liquidez (stops de
                                vendedores).</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-dark">3. Reversi√≥n del Smart Money</td>
                            <td>Tras recolectar liquidez con la ca√≠da, revierten el precio al alza con fuerza iniciando
                                la tendencia real.</td>
                            <td>Tras inducir la subida y recolectar liquidez, giran el mercado a la baja iniciando la
                                tendencia real.</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-dark">4. Impulso y Distribuci√≥n</td>
                            <td>El precio sube sostenidamente mientras distribuyen posiciones largas en niveles
                                superiores.</td>
                            <td>El precio cae en tendencia sostenida mientras distribuyen posiciones cortas en niveles
                                inferiores.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p>
                Como vemos, la l√≥gica es similar: el Smart Money "enga√±a" primero y ejecuta despu√©s. A continuaci√≥n, nos
                enfocaremos en describir a detalle las fases del Market Maker Buy Model (MMBM) asumiendo un caso
                pr√°ctico alcista.
            </p>
        </section>

        <!-- NEW SECTION: PREMIUM VS DISCOUNT -->
        <section id="pd-arrays" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="scale" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Concepto Clave: Premium vs. Discount</h2>
            </div>

            <p class="mb-6">
                Antes de entender <em>cu√°ndo</em> entrar en las fases del modelo, debemos entender <em>d√≥nde</em>. El
                Smart Money nunca compra cuando el precio es "caro" (Premium) ni vende cuando es "barato" (Discount).
                Operan como mayoristas.
            </p>
            <p class="mb-8">
                Para definir esto, utilizamos el rango del impulso actual. El 50% de ese rango se llama
                <strong>Equilibrio</strong>.
            </p>

            <div class="visual-container grid md:grid-cols-2 gap-8 items-center bg-slate-50">
                <div>
                    <h3 class="font-bold text-kawn-deep mb-3">Calculadora Visual de Rangos (PD Arrays)</h3>
                    <p class="text-sm mb-4 text-slate-600">
                        Arrastra el control deslizante para simular el precio dentro de un rango definido. Observa c√≥mo
                        cambia la percepci√≥n institucional.
                    </p>

                    <div class="bg-white p-6 rounded shadow-sm border border-slate-200">
                        <div class="flex justify-between text-xs font-bold text-slate-400 mb-1">
                            <span>Alto del Rango</span>
                            <span>Bajo del Rango</span>
                        </div>
                        <input type="range" id="pd-slider" min="0" max="100" value="50"
                            class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs mt-2 font-mono">
                            <span class="text-red-500">Zona Premium (>50%)</span>
                            <span class="text-kawn-base font-bold text-center">EQUILIBRIO (50%)</span>
                            <span class="text-green-500">Zona Discount (<50%)< /span>
                        </div>
                    </div>

                    <div id="pd-feedback"
                        class="mt-4 p-4 rounded-lg bg-slate-100 text-center font-bold text-sm transition-colors duration-300">
                        Mueve el slider para ver el an√°lisis.
                    </div>
                </div>

                <div class="relative h-64 w-full border border-slate-300 rounded bg-white flex flex-col">
                    <!-- Premium Zone -->
                    <div id="zone-premium"
                        class="flex-1 bg-red-50 border-b border-red-200 flex items-center justify-center transition-colors">
                        <div class="text-center">
                            <span class="text-red-800 font-bold block">PREMIUM</span>
                            <span class="text-xs text-red-600">Solo buscar VENTAS</span>
                        </div>
                    </div>
                    <!-- Equilibrium Line -->
                    <div class="h-0.5 bg-slate-800 w-full relative z-10">
                        <span class="absolute right-2 -top-3 text-[10px] bg-slate-800 text-white px-1 rounded">50%
                            EQ</span>
                    </div>
                    <!-- Discount Zone -->
                    <div id="zone-discount"
                        class="flex-1 bg-green-50 border-t border-green-200 flex items-center justify-center transition-colors">
                        <div class="text-center">
                            <span class="text-green-800 font-bold block">DISCOUNT</span>
                            <span class="text-xs text-green-600">Solo buscar COMPRAS</span>
                        </div>
                    </div>

                    <!-- Price Marker -->
                    <div id="price-marker"
                        class="absolute left-1/2 w-full -translate-x-1/2 flex items-center transition-all duration-100"
                        style="top: 50%;">
                        <div class="w-full border-t-2 border-dashed border-blue-500"></div>
                        <div
                            class="absolute right-4 bg-blue-600 text-white text-xs px-2 py-0.5 rounded font-bold shadow-sm">
                            Precio Actual</div>
                    </div>
                </div>
            </div>

            <div class="highlight-quote border-blue-500 bg-blue-50 text-blue-900">
                <p class="font-bold mb-1">Regla de Oro:</p>
                <p class="text-sm">En un MMBM (Modelo de Compra), tras la confirmaci√≥n, debemos esperar a que el precio
                    retroceda a zona de <strong>DISCOUNT</strong> (por debajo del 50% del rango) antes de entrar.</p>
            </div>
        </section>

        <!-- NEW SECTION: KILL ZONES -->
        <section id="killzones" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="clock" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Tiempo y Precio: Las "Kill Zones"</h2>
            </div>

            <p class="mb-6">
                En el trading institucional, <em>cu√°ndo</em> operas es tan importante como <em>qu√©</em> operas. Los
                algoritmos interbancarios inyectan volatilidad en horarios espec√≠ficos del d√≠a. Operar fuera de estas
                horas suele resultar en consolidaciones lentas y trampas.
            </p>

            <div class="visual-container">
                <div class="visual-title mb-4">
                    <i data-lucide="watch" class="w-5 h-5 mr-2"></i> Cronograma de Sesiones (Hora NY - EST)
                </div>

                <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button onclick="showKillZone('asia')"
                        class="kz-btn px-4 py-2 rounded-full border border-slate-200 text-sm font-bold hover:bg-slate-50 transition-colors focus:ring-2 focus:ring-kawn-base focus:border-transparent">
                        üåè Asian Range
                    </button>
                    <button onclick="showKillZone('london')"
                        class="kz-btn px-4 py-2 rounded-full border border-slate-200 text-sm font-bold hover:bg-slate-50 transition-colors focus:ring-2 focus:ring-kawn-base focus:border-transparent">
                        üá¨üáß London Open
                    </button>
                    <button onclick="showKillZone('ny')"
                        class="kz-btn px-4 py-2 rounded-full border border-slate-200 text-sm font-bold hover:bg-slate-50 transition-colors focus:ring-2 focus:ring-kawn-base focus:border-transparent">
                        üá∫üá∏ NY Open
                    </button>
                    <button onclick="showKillZone('close')"
                        class="kz-btn px-4 py-2 rounded-full border border-slate-200 text-sm font-bold hover:bg-slate-50 transition-colors focus:ring-2 focus:ring-kawn-base focus:border-transparent">
                        üèÅ London Close
                    </button>
                </div>

                <div class="relative h-40 bg-slate-100 rounded-lg overflow-hidden border border-slate-200 mb-4">
                    <!-- Timeline Grid -->
                    <div class="absolute inset-0 grid grid-cols-24 divide-x divide-slate-200/50">
                        <!-- Generar 24 divisiones con JS o est√°tico -->
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                        <div class="col-span-1"></div>
                    </div>

                    <!-- Labels -->
                    <div
                        class="absolute bottom-1 w-full flex justify-between px-2 text-[10px] text-slate-400 font-mono">
                        <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>24:00</span>
                    </div>

                    <!-- Kill Zone Highlight Bar (Dynamic) -->
                    <div id="kz-highlight"
                        class="absolute top-0 bottom-6 bg-kawn-base/80 transition-all duration-500 ease-out shadow-[0_0_15px_rgba(20,184,166,0.5)] flex items-center justify-center text-white font-bold text-xs"
                        style="left: 0; width: 0; opacity: 0;">
                        <span id="kz-label">Selecciona una sesi√≥n</span>
                    </div>
                </div>

                <div id="kz-info"
                    class="bg-white p-4 rounded border border-l-4 border-slate-200 text-sm text-slate-600 transition-all">
                    <p class="font-bold text-slate-800 mb-1">Selecciona una sesi√≥n arriba para ver detalles.</p>
                    <p>Las Kill Zones son ventanas temporales de alta probabilidad donde se suelen formar los m√°ximos o
                        m√≠nimos del d√≠a.</p>
                </div>
            </div>
        </section>

        <section id="fases" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="git-commit" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Fases del Modelo MMBM: Acumulaci√≥n, Manipulaci√≥n y
                    Reversi√≥n</h2>
            </div>

            <!-- INTERACTIVE GRAPHIC 2: MAIN MMBM MODEL -->
            <div class="visual-container">
                <div class="visual-title flex flex-col md:flex-row justify-between md:items-center gap-4">
                    <span class="flex items-center"><i data-lucide="activity" class="w-5 h-5 mr-2"></i> Esquema
                        Interactivo: Ciclo MMBM</span>
                    <div class="flex space-x-2 bg-slate-100 p-1 rounded-lg">
                        <button onclick="setPhase(1)"
                            class="px-3 py-1 rounded text-xs font-bold phase-btn bg-white shadow-sm text-kawn-dark"
                            id="btn-p1">1. Acumulaci√≥n</button>
                        <button onclick="setPhase(2)"
                            class="px-3 py-1 rounded text-xs font-bold phase-btn text-slate-500 hover:bg-slate-200"
                            id="btn-p2">2. Manipulaci√≥n</button>
                        <button onclick="setPhase(3)"
                            class="px-3 py-1 rounded text-xs font-bold phase-btn text-slate-500 hover:bg-slate-200"
                            id="btn-p3">3. Reversi√≥n</button>
                        <button onclick="setPhase(4)"
                            class="px-3 py-1 rounded text-xs font-bold phase-btn text-slate-500 hover:bg-slate-200"
                            id="btn-p4">4. Distribuci√≥n</button>
                    </div>
                </div>

                <div class="relative h-80 w-full bg-slate-50 rounded-lg border border-slate-200 overflow-hidden"
                    id="mmbm-canvas-container">
                    <!-- Tooltip Container -->
                    <div id="mmbm-tooltip" class="chart-tooltip"></div>

                    <svg viewBox="0 0 800 300" class="w-full h-full overflow-visible">
                        <!-- Grid Background -->
                        <defs>
                            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" stroke-width="1" />
                            </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />

                        <!-- Phase 1: Consolidation -->
                        <g id="phase-1-group" class="transition-opacity duration-500">
                            <rect x="50" y="100" width="180" height="60" fill="#ccfbf1" stroke="#14b8a6"
                                stroke-width="2" stroke-dasharray="5,5" opacity="0.5" />
                            <text x="140" y="90" text-anchor="middle"
                                class="text-xs font-bold text-kawn-dark font-display uppercase tracking-wide">Consolidaci√≥n</text>
                            <path
                                d="M50,130 L70,110 L90,150 L110,120 L130,140 L150,110 L170,145 L190,120 L210,135 L230,115"
                                fill="none" stroke="#0f766e" stroke-width="2" class="path-animate"
                                style="animation-duration: 1.5s" />
                        </g>

                        <!-- Phase 2: Manipulation -->
                        <g id="phase-2-group" class="opacity-0 transition-opacity duration-500">
                            <text x="100" y="175" class="text-red-500 text-xs font-bold animate-pulse">‚úï Stops</text>
                            <text x="180" y="175" class="text-red-500 text-xs font-bold animate-pulse">‚úï Stops</text>
                            <path d="M230,115 L250,180 L270,160 L290,220 L310,190 L330,250" fill="none" stroke="#ef4444"
                                stroke-width="3" class="path-animate"
                                style="animation-delay: 0.5s; animation-duration: 1.5s" />

                            <circle cx="330" cy="250" r="6" fill="#ef4444" class="chart-point"
                                onmouseover="showTooltip(evt, 'Punto de M√°xima Manipulaci√≥n: Aqu√≠ capitulan los compradores.')"
                                onmouseout="hideTooltip()" />
                            <text x="345" y="265" class="text-xs text-red-700 font-bold bg-white/80 px-1 rounded">Low of
                                Day</text>
                        </g>

                        <!-- Phase 3: Reversal -->
                        <g id="phase-3-group" class="opacity-0 transition-opacity duration-500">
                            <path d="M330,250 L360,150 L390,180 L420,80" fill="none" stroke="#10b981" stroke-width="3"
                                class="path-animate" style="animation-delay: 0.5s; animation-duration: 1.5s" />

                            <line x1="210" y1="135" x2="450" y2="135" stroke="#0f766e" stroke-width="1"
                                stroke-dasharray="4,4" />
                            <text x="430" y="130" class="text-xs font-bold text-kawn-deep">BOS (Break of
                                Structure)</text>

                            <circle cx="390" cy="180" r="8" fill="#fbbf24" stroke="white" stroke-width="2"
                                class="chart-point animate-pulse"
                                onmouseover="showTooltip(evt, 'OTE / FVG: Zona ideal de entrada en compra tras el rompimiento.')"
                                onmouseout="hideTooltip()" />
                            <text x="390" y="205" text-anchor="middle"
                                class="text-[10px] font-bold text-amber-600">ENTRADA</text>
                        </g>

                        <!-- Phase 4: Distribution -->
                        <g id="phase-4-group" class="opacity-0 transition-opacity duration-500">
                            <path d="M420,80 L450,110 L500,40 L550,60 L600,20" fill="none" stroke="#10b981"
                                stroke-width="3" class="path-animate"
                                style="animation-delay: 0.5s; animation-duration: 1.5s" />

                            <line x1="50" y1="110" x2="600" y2="110" stroke="#6366f1" stroke-width="2"
                                stroke-dasharray="4,4" />
                            <text x="500" y="30" class="text-xs text-indigo-600 font-bold bg-white px-1">Take Profit
                                Final</text>
                        </g>
                    </svg>
                </div>
                <div id="phase-description"
                    class="mt-4 p-4 bg-kawn-light/30 border border-kawn-base/20 rounded-lg text-sm text-kawn-deep font-medium transition-all duration-300">
                    Fase 1: El precio consolida para inducir a traders a ambos lados del mercado.
                </div>
            </div>

            <div class="space-y-12">
                <div>
                    <h3 class="text-xl font-bold text-kawn-deep mb-3 flex items-center">
                        <span
                            class="bg-kawn-light text-kawn-dark w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                        Fase 1: Consolidaci√≥n Inicial (Acumulaci√≥n)
                    </h3>
                    <p class="mb-4">
                        Esta fase se caracteriza por un mercado lateral, de rango relativamente estrecho, que ocurre
                        tras un movimiento impulsivo previo. El precio oscila dentro de niveles claros de soporte y
                        resistencia, con disminuci√≥n de volumen.
                    </p>
                    <p class="mb-4">
                        Para el Smart Money, sirve para acumular √≥rdenes sin mover demasiado el mercado y
                        simult√°neamente generar liquidez futura: muchos traders minoristas colocar√°n stops en los bordes
                        de este rango. La consolidaci√≥n act√∫a como un "im√°n" de √≥rdenes, un repositorio de liquidez
                        esperando ser explotado.
                    </p>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-red-700 mb-3 flex items-center">
                        <span
                            class="bg-red-100 text-red-700 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                        Fase 2: Movimiento Bajista de Manipulaci√≥n
                    </h3>
                    <p class="mb-4">
                        Es un movimiento bajista abrupto que rompe el rango por abajo cuando el Smart Money decide
                        ejecutar su <em>raid</em> de liquidez. Parece una ruptura aut√©ntica, formando Lower Highs (LH)
                        consecutivos.
                    </p>
                    <p class="mb-4">
                        El Smart Money empuja el precio deliberadamente para activar la mayor cantidad de stop-loss de
                        compradores. A esto se le llama "ingenier√≠a de liquidez". Es la trampa perfecta: los d√©biles
                        venden cerca del fondo, entregando sus posiciones al Smart Money justo antes del giro.
                    </p>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-green-700 mb-3 flex items-center">
                        <span
                            class="bg-green-100 text-green-700 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">3</span>
                        Fase 3: Reversi√≥n del Smart Money (Cambio de Tendencia)
                    </h3>
                    <p class="mb-4">
                        Tras completar la cacer√≠a de stops, el Smart Money cambia de "vender" a "comprar" decididamente.
                        Esta reversi√≥n requiere dos componentes t√©cnicos:
                    </p>
                    <ul class="custom-list pl-4 mb-4 font-medium">
                        <li><i data-lucide="corner-up-right"></i> (1) Un Cambio de Estructura (BOS)</li>
                        <li><i data-lucide="corner-up-right"></i> (2) Un Cambio en el Estado de Entrega (CSOD/Shift)
                        </li>
                    </ul>
                    <p class="mb-4">
                        Debe ocurrir un rompimiento alcista significativo que quiebre un m√°ximo previo importante (el
                        √∫ltimo Lower High de la fase 2), se√±alando que la secuencia bajista termin√≥. Este punto se
                        conoce como <strong>Smart Money Reversal (SMR)</strong>.
                    </p>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-kawn-deep mb-3 flex items-center">
                        <span
                            class="bg-kawn-light text-kawn-dark w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">4</span>
                        Fase 4: Impulso Alcista (Distribuci√≥n)
                    </h3>
                    <p>
                        Una vez ocurre la reversi√≥n, el precio inicia la tendencia principal al alza, recorriendo
                        grandes distancias r√°pidamente. El Smart Money, habiendo acumulado barato, ahora distribuye sus
                        posiciones largas conforme el precio sube, tomando ganancias en niveles objetivo de liquidez
                        (antiguos m√°ximos).
                    </p>
                </div>
            </div>
        </section>

        <section class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="crosshair" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">La Entrada "Perfecta": El Primer Pullback al FVG</h2>
            </div>

            <p class="mb-6">
                Identificar la estructura est√° muy bien, pero ¬ød√≥nde entrar? Una vez confirmada la reversi√≥n alcista
                (tras ver el BOS), la estrategia recomienda esperar un retroceso del precio a un punto clave conocido
                como <strong>FVG (Fair Value Gap)</strong>.
            </p>

            <div class="flex flex-col md:flex-row gap-8 items-center mb-8">
                <div class="md:w-1/2">
                    <p class="mb-4">
                        Un <strong>Fair Value Gap (FVG)</strong> es un desequilibrio en el precio: un espacio vac√≠o
                        entre velas causado por un movimiento muy r√°pido donde no hubo transacciones en ciertos niveles.
                    </p>
                    <p class="mb-4">
                        Estos gaps representan zonas donde el precio tender√° a regresar moment√°neamente para
                        "reequilibrar" √≥rdenes pendientes. Esa es nuestra zona dorada de entrada: el precio hace un
                        pullback controlado para llenar parcialmente ese FVG en zona de descuento, y all√≠ tomamos la
                        entrada con un stop muy ajustado.
                    </p>
                </div>

                <!-- INTERACTIVE GRAPHIC 3: FVG ZOOM -->
                <div
                    class="md:w-1/2 visual-container m-0 bg-slate-50 group hover:shadow-xl transition-all duration-300">
                    <div class="visual-title text-sm flex justify-between">
                        <span><i data-lucide="zoom-in" class="w-4 h-4 mr-2 inline"></i> Zoom Interactivo: FVG</span>
                        <span class="text-[10px] bg-slate-200 px-2 py-1 rounded text-slate-500">Pasa el mouse sobre el
                            gr√°fico</span>
                    </div>
                    <div
                        class="relative h-64 w-full bg-white overflow-hidden flex items-center justify-center border border-slate-100 rounded">
                        <svg viewBox="0 0 400 250" class="w-full h-full">
                            <!-- Candles -->
                            <g class="opacity-50 group-hover:opacity-100 transition-opacity">
                                <rect x="50" y="180" width="20" height="40" fill="#ef4444" />
                                <line x1="60" y1="170" x2="60" y2="230" stroke="#ef4444" stroke-width="2" />
                                <rect x="80" y="150" width="20" height="60" fill="#10b981" />
                                <line x1="90" y1="140" x2="90" y2="210" stroke="#10b981" stroke-width="2" />
                                <rect x="110" y="100" width="20" height="70" fill="#10b981" />
                                <line x1="120" y1="90" x2="120" y2="170" stroke="#10b981" stroke-width="2" />
                                <rect x="140" y="110" width="20" height="30" fill="#10b981" />
                                <line x1="150" y1="105" x2="150" y2="140" stroke="#10b981" stroke-width="2" />
                            </g>

                            <!-- Interactive FVG Zone -->
                            <rect id="fvg-zone" x="90" y="140" width="200" height="30" fill="#fbbf24" opacity="0.1"
                                class="transition-all duration-300 cursor-crosshair"
                                onmouseover="this.setAttribute('opacity', '0.4'); document.getElementById('fvg-desc').style.opacity = '1';"
                                onmouseout="this.setAttribute('opacity', '0.1'); document.getElementById('fvg-desc').style.opacity = '0';" />

                            <text x="170" y="155"
                                class="text-xs font-bold text-amber-600 font-display pointer-events-none">Zona FVG
                                (Gap)</text>

                            <!-- Entry Simulation -->
                            <g id="fvg-desc" opacity="0" class="transition-opacity duration-300 pointer-events-none">
                                <line x1="90" y1="140" x2="130" y2="140" stroke="#fbbf24" stroke-width="2" />
                                <line x1="120" y1="170" x2="150" y2="170" stroke="#fbbf24" stroke-width="2" />
                                <polyline points="150,125 170,145 190,135 210,160" fill="none" stroke="#ef4444"
                                    stroke-width="2" stroke-dasharray="2,2" />
                                <circle cx="210" cy="160" r="6" fill="#14b8a6" stroke="white" stroke-width="2"
                                    class="animate-pulse" />
                                <text x="225" y="165" class="text-sm font-bold text-kawn-base font-display">ENTRADA
                                    EJECUTADA</text>
                                <rect x="200" y="180" width="140" height="40" rx="4" fill="rgba(15, 23, 42, 0.9)" />
                                <text x="210" y="195" class="text-[10px] fill-white">Limit Order: Activada</text>
                                <text x="210" y="210" class="text-[10px] fill-white">Riesgo: 1% | TP: 1:3</text>
                            </g>

                            <!-- Stop Loss Line -->
                            <line x1="50" y1="235" x2="230" y2="235" stroke="#ef4444" stroke-width="2"
                                stroke-dasharray="4,4" opacity="0.5" />
                            <text x="240" y="240" class="text-xs font-bold text-red-500 opacity-50">Invalidaci√≥n
                                (SL)</text>

                            <line x1="20" y1="165" x2="150" y2="165" stroke="#0f766e" stroke-width="1.5" />
                            <text x="30" y="160" class="text-[10px] font-bold text-kawn-dark">BOS (Anterior LH)</text>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-slate-100 p-6 rounded-lg border-l-4 border-kawn-base">
                <h4 class="font-bold text-lg text-slate-900 mb-3">Pasos para la Entrada Ideal:</h4>
                <ol class="list-decimal pl-5 space-y-2 font-medium text-slate-700">
                    <li>Confirmar el cambio de estructura (rompimiento de m√°ximo clave).</li>
                    <li>Identificar un FVG alcista por debajo del nuevo m√°ximo.</li>
                    <li>Esperar pacientemente el retroceso para rellenar el FVG (zona de descuento).</li>
                    <li>Ejecutar la compra en la zona del FVG.</li>
                    <li>Colocar el stop-loss justo por debajo del m√≠nimo de la reversi√≥n.</li>
                </ol>
            </div>
            <p class="mt-4 text-sm text-slate-500">
                Esta combinaci√≥n eleva el ratio riesgo/beneficio exponencialmente, permitiendo a veces ratios de 1:5 o
                superiores.
            </p>
        </section>

        <section class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="layers" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Estructura de Mercado y Conceptos Avanzados</h2>
            </div>

            <p class="mb-6">
                Para aplicar exitosamente el modelo es importante reconocer la jerarqu√≠a de m√°ximos y m√≠nimos. ICT
                define t√©rminos espec√≠ficos para estos pivotes.
            </p>

            <div class="overflow-x-auto mb-8">
                <table class="magazine-table">
                    <thead>
                        <tr>
                            <th>Sigla</th>
                            <th>Definici√≥n</th>
                            <th>Descripci√≥n en el Gr√°fico</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-bold text-kawn-dark">STL</td>
                            <td>Short Term Low</td>
                            <td>M√≠nimo de corto plazo (valle local peque√±o).</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-dark">STH</td>
                            <td>Short Term High</td>
                            <td>M√°ximo de corto plazo (pico local peque√±o).</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-base">ITL</td>
                            <td>Intermediate Term Low</td>
                            <td>M√≠nimo intermedio importante, rodeado de dos m√≠nimos m√°s altos (STL‚ÄìITL‚ÄìSTL). Suelo
                                relevante.</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-kawn-base">ITH</td>
                            <td>Intermediate Term High</td>
                            <td>M√°ximo intermedio significativo, rodeado de dos m√°ximos menores (STH‚ÄìITH‚ÄìSTH). Techo
                                relevante.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p class="mb-8">
                Identificar correctamente la diferencia entre ruido (STL/STH) y estructura significativa (ITL/ITH) es
                clave para entender los ciclos fractales de acumulaci√≥n y distribuci√≥n.
            </p>

            <h3 class="text-2xl font-bold text-slate-900 mb-4">Re-entradas y Pyramiding</h3>
            <p class="mb-4">
                El modelo es fractal y puede desarrollarse en m√∫ltiples etapas. Un movimiento del Smart Money a menudo
                sigue un patr√≥n repetitivo de "acumular ‚Üí impulsar ‚Üí re-acumular ‚Üí impulsar".
            </p>
            <p class="mb-6">
                Esto permite realizar <strong>re-entradas</strong> (pyramiding) cuando la tendencia se confirma. Claves
                para hacerlo: mantener el stop original, esperar zonas de descuento en cada nuevo impulso, y escalonar
                tama√±os decrecientes en las nuevas posiciones.
            </p>

            <h3 class="text-2xl font-bold text-slate-900 mb-6">Patrones Complementarios: Turtle Soup, PO3 y SMT</h3>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <!-- Turtle Soup Animated -->
                <div
                    class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:border-kawn-base transition-colors">
                    <h4 class="font-bold text-lg text-kawn-dark mb-3 flex items-center"><i data-lucide="shield-alert"
                            class="mr-2"></i> Patr√≥n Turtle Soup (Animado)</h4>
                    <p class="text-sm mb-4">
                        Es un patr√≥n de falsa ruptura de un nivel clave seguido de una r√°pida reversi√≥n. Es la
                        manifestaci√≥n cl√°sica de un barrido de liquidez.
                    </p>
                    <div
                        class="h-32 bg-slate-50 rounded flex items-center justify-center border border-slate-100 relative overflow-hidden">
                        <svg viewBox="0 0 200 100" class="w-full h-full">
                            <line x1="10" y1="60" x2="190" y2="60" stroke="#94a3b8" stroke-width="2"
                                stroke-dasharray="4,4" />
                            <text x="20" y="55" class="text-[10px] text-slate-500">Soporte Clave</text>

                            <!-- Animated Path -->
                            <polyline points="20,40 50,60 80,40 110,60 130,80" fill="none" stroke="#ef4444"
                                stroke-width="2">
                                <animate attributeName="stroke-dasharray" from="0, 200" to="200, 0" dur="2s"
                                    fill="freeze" />
                            </polyline>
                            <circle cx="130" cy="80" r="4" fill="#ef4444" class="animate-ping" />

                            <text x="135" y="90" class="text-[10px] text-red-600 font-bold opacity-0"
                                style="animation: fadeIn 0.5s forwards 1.5s">Falsa Ruptura</text>

                            <polyline points="130,80 150,30 180,20" fill="none" stroke="#10b981" stroke-width="3"
                                stroke-dasharray="200" stroke-dashoffset="200"
                                style="animation: dash 1s linear forwards 2s" />
                        </svg>
                    </div>
                    <p class="text-xs text-slate-500 mt-2">Valida que hubo manipulaci√≥n y cambio de intenci√≥n.</p>
                </div>

                <!-- Power of 3 Animated -->
                <div
                    class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:border-kawn-base transition-colors">
                    <h4 class="font-bold text-lg text-kawn-dark mb-3 flex items-center"><i data-lucide="bar-chart-3"
                            class="mr-2"></i> Power of 3 (PO3)</h4>
                    <p class="text-sm mb-4">
                        Describe el ciclo de una vela de alta temporalidad en tres fases: Acumulaci√≥n ‚Üí Manipulaci√≥n
                        (Judas Swing) ‚Üí Distribuci√≥n.
                    </p>
                    <div
                        class="h-32 bg-slate-50 rounded flex items-center justify-center border border-slate-100 relative overflow-hidden group">
                        <svg viewBox="0 0 200 100" class="w-full h-full">
                            <!-- Shadows -->
                            <line x1="100" y1="10" x2="100" y2="95" stroke="#e2e8f0" stroke-width="2" />

                            <!-- Dynamic Candle Building -->
                            <!-- Open -->
                            <line x1="85" y1="60" x2="100" y2="60" stroke="#64748b" stroke-width="3">
                                <animate attributeName="x2" from="85" to="100" dur="0.5s" fill="freeze" />
                            </line>
                            <text x="40" y="60" class="text-[10px] font-bold text-slate-600">Open (Acum)</text>

                            <!-- Manipulation Low -->
                            <line x1="100" y1="60" x2="100" y2="90" stroke="#ef4444" stroke-width="3">
                                <animate attributeName="y2" from="60" to="90" begin="0.5s" dur="0.5s" fill="freeze" />
                            </line>
                            <text x="40" y="95" class="text-[10px] font-bold text-red-600">Low (Manipulaci√≥n)</text>

                            <!-- Distribution High -->
                            <rect x="90" y="30" width="20" height="0" fill="#10b981" y="90">
                                <animate attributeName="y" from="90" to="30" begin="1s" dur="1s" fill="freeze" />
                                <animate attributeName="height" from="0" to="60" begin="1s" dur="1s" fill="freeze" />
                            </rect>
                            <line x1="100" y1="30" x2="100" y2="10" stroke="#10b981" stroke-width="2">
                                <animate attributeName="y2" from="30" to="10" begin="2s" dur="0.5s" fill="freeze" />
                            </line>

                            <text x="120" y="20" class="text-[10px] font-bold text-green-600">High (Expansi√≥n)</text>
                        </svg>
                        <div class="absolute bottom-1 right-1 text-[8px] text-slate-400">Loop Animation</div>
                    </div>
                    <p class="text-xs text-slate-500 mt-2">Ayuda a establecer take-profits matem√°ticos basados en el
                        rango inicial.</p>
                </div>
            </div>

            <!-- NEW SECTION: SMT DIVERGENCE -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-bold text-lg text-kawn-deep flex items-center"><i data-lucide="split"
                            class="mr-2"></i> SMT Divergence (Smart Money Tool)</h4>
                    <button onclick="revealSMT()"
                        class="text-xs bg-kawn-light text-kawn-deep px-3 py-1 rounded font-bold hover:bg-kawn-base hover:text-white transition-colors">Revelar
                        Divergencia</button>
                </div>
                <p class="text-sm mb-6">
                    El Smart Money deja huellas cuando activos correlacionados (como EURUSD y DXY, o GBPUSD y EURUSD)
                    pierden su simetr√≠a. Si uno hace un nuevo m√°ximo y el otro falla, es una se√±al potente de reversi√≥n.
                </p>

                <div class="grid grid-cols-2 gap-4 h-40 bg-slate-50 p-4 rounded border border-slate-100">
                    <!-- Asset A -->
                    <div class="relative">
                        <div class="text-[10px] font-bold text-slate-500 mb-1">Activo A (ej. EURUSD)</div>
                        <svg viewBox="0 0 150 100" class="w-full h-full overflow-visible">
                            <polyline points="10,80 40,30 70,60 100,20 130,50" fill="none" stroke="#64748b"
                                stroke-width="2" />
                            <!-- Lower High visualization (initially hidden) -->
                            <line id="smt-line-a" x1="40" y1="30" x2="100" y2="20" stroke="#ef4444" stroke-width="2"
                                stroke-dasharray="5,5" opacity="0" class="transition-opacity duration-500" />
                            <text id="smt-text-a" x="70" y="10" text-anchor="middle"
                                class="text-[8px] fill-red-500 font-bold opacity-0 transition-opacity duration-500">HIGHER
                                HIGH</text>
                        </svg>
                    </div>

                    <!-- Asset B -->
                    <div class="relative">
                        <div class="text-[10px] font-bold text-slate-500 mb-1">Activo B (ej. GBPUSD)</div>
                        <svg viewBox="0 0 150 100" class="w-full h-full overflow-visible">
                            <polyline points="10,85 40,35 70,65 100,40 130,70" fill="none" stroke="#64748b"
                                stroke-width="2" />
                            <!-- Failure Swing visualization (initially hidden) -->
                            <line id="smt-line-b" x1="40" y1="35" x2="100" y2="40" stroke="#10b981" stroke-width="2"
                                stroke-dasharray="5,5" opacity="0" class="transition-opacity duration-500" />
                            <circle id="smt-dot-b" cx="100" cy="40" r="3" fill="#10b981" opacity="0"
                                class="transition-opacity duration-500" />
                            <text id="smt-text-b" x="70" y="30" text-anchor="middle"
                                class="text-[8px] fill-green-600 font-bold opacity-0 transition-opacity duration-500">LOWER
                                HIGH (Fallo)</text>
                        </svg>
                    </div>
                </div>
                <p class="text-xs text-slate-400 mt-2 text-center">Haz clic en "Revelar Divergencia" para ver la
                    "grieta" en la correlaci√≥n.</p>
            </div>
        </section>

        <!-- NEW AI LAB SECTION -->
        <section id="ai-lab" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8">
                <i data-lucide="sparkles" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Laboratorio de Inteligencia KawnBit (AI-Powered) ‚ú®</h2>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">

                <!-- AI Mentor Chatbot -->
                <div
                    class="lg:col-span-2 bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col h-[500px]">
                    <div class="bg-gradient-to-r from-kawn-deep to-kawn-dark p-4 flex justify-between items-center">
                        <div class="flex items-center text-white">
                            <i data-lucide="bot" class="w-6 h-6 mr-2"></i>
                            <div>
                                <h3 class="font-bold text-sm">Mentor de Trading IA</h3>
                                <p class="text-[10px] opacity-80">Especialista en MMxM y Smart Money</p>
                            </div>
                        </div>
                        <span class="bg-green-400 w-2 h-2 rounded-full animate-pulse"></span>
                    </div>

                    <div id="chat-messages" class="flex-1 p-6 overflow-y-auto bg-slate-50">
                        <div class="ai-message bot">
                            Hola, soy tu mentor virtual de KawnBit. ¬øTienes dudas sobre el modelo de acumulaci√≥n, c√≥mo
                            identificar un FVG o d√≥nde colocar tu stop loss? ¬°Preg√∫ntame! ‚ú®
                        </div>
                    </div>

                    <div class="p-4 bg-white border-t border-slate-200">
                        <form id="chat-form" class="flex gap-2">
                            <input type="text" id="user-input"
                                class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-kawn-base focus:border-transparent outline-none"
                                placeholder="Ej: ¬øQu√© hago si el precio no llega al FVG?">
                            <button type="submit" id="chat-submit-btn"
                                class="bg-kawn-dark text-white p-2 rounded-lg hover:bg-kawn-base transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="send" class="w-5 h-5"></i>
                            </button>
                        </form>
                        <p class="text-[10px] text-center text-slate-400 mt-2">Powered by Gemini AI. Las respuestas
                            pueden variar.</p>
                    </div>
                </div>

                <!-- Right Column: Analyzer & Quiz -->
                <div class="flex flex-col gap-6">

                    <!-- AI Scenario Analyzer -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex-1 flex flex-col">
                        <h3 class="font-bold text-kawn-deep mb-3 flex items-center"><i data-lucide="microscope"
                                class="mr-2"></i> Analizador de Escenarios</h3>
                        <p class="text-xs text-slate-500 mb-3">Describe una situaci√≥n de mercado y la IA te dir√° qu√©
                            buscar√≠a un trader institucional.</p>

                        <textarea id="scenario-input"
                            class="w-full h-20 border border-slate-200 rounded p-3 text-sm focus:ring-1 focus:ring-kawn-base outline-none resize-none mb-3"
                            placeholder="Ej: El precio barri√≥ los m√°ximos de Asia y ahora rompi√≥ estructura a la baja..."></textarea>

                        <button id="scenario-btn" onclick="analyzeScenario()"
                            class="w-full py-2 bg-slate-800 text-white rounded font-bold text-sm hover:bg-slate-700 transition flex justify-center items-center gap-2 mb-3 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="sparkles" class="w-4 h-4"></i> Analizar con IA
                        </button>

                        <div id="scenario-result"
                            class="bg-slate-50 p-3 rounded border border-slate-100 text-xs text-slate-700 h-24 overflow-y-auto custom-scrollbar">
                            <span class="opacity-50 italic">Esperando descripci√≥n...</span>
                        </div>
                    </div>

                    <!-- AI Quiz Generator (NEW) -->
                    <div
                        class="bg-gradient-to-br from-kawn-light/30 to-white p-6 rounded-2xl shadow-sm border border-kawn-base/20 flex-1 flex flex-col justify-center">
                        <h3 class="font-bold text-kawn-deep mb-2 flex items-center"><i data-lucide="award"
                                class="mr-2"></i> Desaf√≠o de Trading ‚ú®</h3>
                        <p class="text-xs text-slate-500 mb-4">Pon a prueba tu retenci√≥n. Gemini generar√° preguntas
                            √∫nicas para ti.</p>

                        <div id="quiz-container">
                            <button id="quiz-btn" onclick="generateQuiz()"
                                class="w-full py-3 bg-kawn-base text-white rounded-lg font-bold text-sm hover:bg-kawn-dark transition flex justify-center items-center gap-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="zap" class="w-4 h-4"></i> Generar Quiz Din√°mico
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </section>


        <section id="gestion" class="mb-16 scroll-mt-24 bg-slate-50 p-8 rounded-2xl border border-slate-200">
            <div class="flex items-center mb-8">
                <i data-lucide="shield-check" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Gesti√≥n de Riesgo y Psicolog√≠a: Los Pilares</h2>
            </div>

            <p class="mb-6 font-medium text-lg">
                Ninguna estrategia est√° completa sin un s√≥lido plan de gesti√≥n. La disciplina en gesti√≥n de riesgo es
                tan importante como la habilidad t√©cnica para identificar el modelo.
            </p>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="font-bold text-kawn-dark mb-4 flex items-center"><i data-lucide="check-circle"
                            class="mr-2"></i> Lo que DEBES hacer (Do's)</h3>
                    <ul class="custom-list text-sm">
                        <li><i data-lucide="check" class="text-green-500"></i> Esperar la confirmaci√≥n completa (BOS +
                            FVG) antes de arriesgar.</li>
                        <li><i data-lucide="check" class="text-green-500"></i> Arriesgar m√°ximo 1-2% del capital por
                            operaci√≥n.</li>
                        <li><i data-lucide="check" class="text-green-500"></i> Buscar un Ratio Riesgo/Beneficio m√≠nimo
                            de 1:3.</li>
                        <li><i data-lucide="check" class="text-green-500"></i> Usar siempre Stop-Loss en el punto de
                            invalidaci√≥n.</li>
                        <li><i data-lucide="check" class="text-green-500"></i> Documentar cada trade en un diario.</li>
                        <li><i data-lucide="check" class="text-green-500"></i> Priorizar la protecci√≥n del capital sobre
                            la ganancia r√°pida.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-red-700 mb-4 flex items-center"><i data-lucide="x-circle"
                            class="mr-2"></i> Lo que DEBES EVITAR (Don'ts)</h3>
                    <ul class="custom-list text-sm">
                        <li><i data-lucide="x" class="text-red-500"></i> Sobre-operar por aburrimiento o venganza.</li>
                        <li><i data-lucide="x" class="text-red-500"></i> Perseguir al precio tras una oportunidad
                            perdida (FOMO).</li>
                        <li><i data-lucide="x" class="text-red-500"></i> A√±adir a posiciones perdedoras (promediar en
                            contra).</li>
                        <li><i data-lucide="x" class="text-red-500"></i> Mover el stop-loss en contra de la posici√≥n
                            (ampliar riesgo).</li>
                        <li><i data-lucide="x" class="text-red-500"></i> Ignorar los criterios del modelo por miedo o
                            euforia.</li>
                    </ul>
                </div>
            </div>

            <div class="highlight-quote bg-kawn-deep/5 border-kawn-deep text-kawn-deep">
                <p class="mb-2 font-bold">"Cut your losses short, let your winners run"</p>
                <p class="text-sm">Corta r√°pido tus p√©rdidas, deja correr tus ganancias. La supervivencia precede al
                    √©xito.</p>
            </div>

            <h3 class="text-2xl font-bold text-slate-900 mb-4">Conclusi√≥n y Pr√≥ximos Pasos</h3>
            <p class="mb-6">
                El Modelo MMxM es una herramienta estrat√©gica poderosa para operar en armon√≠a con el Smart Money. Al
                comprender c√≥mo acumulan, manipulan y distribuyen, podemos anticipar movimientos en lugar de reaccionar
                tarde.
            </p>
            <p class="mb-6">
                El √©xito no proviene de perseguir todas las oportunidades, sino de esperar pacientemente aquellas que
                encajan perfectamente con la metodolog√≠a. Para alcanzar la maestr√≠a operativa, sigue este proceso:
            </p>

            <div class="flex flex-col md:flex-row justify-between gap-4 text-center px-4">
                <div
                    class="flex-1 bg-white p-4 rounded-lg shadow-sm border-t-4 border-kawn-light hover:shadow-md transition-shadow cursor-pointer">
                    <i data-lucide="book-open" class="w-8 h-8 mx-auto text-kawn-base mb-2"></i>
                    <h4 class="font-bold text-sm">1. Comprensi√≥n Te√≥rica</h4>
                </div>
                <div
                    class="flex-1 bg-white p-4 rounded-lg shadow-sm border-t-4 border-kawn-base hover:shadow-md transition-shadow cursor-pointer">
                    <i data-lucide="gamepad-2" class="w-8 h-8 mx-auto text-kawn-base mb-2"></i>
                    <h4 class="font-bold text-sm">2. Pr√°ctica en Demo</h4>
                </div>
                <div
                    class="flex-1 bg-white p-4 rounded-lg shadow-sm border-t-4 border-kawn-accent hover:shadow-md transition-shadow cursor-pointer">
                    <i data-lucide="search" class="w-8 h-8 mx-auto text-kawn-base mb-2"></i>
                    <h4 class="font-bold text-sm">3. Backtesting</h4>
                </div>
                <div
                    class="flex-1 bg-white p-4 rounded-lg shadow-sm border-t-4 border-kawn-dark hover:shadow-md transition-shadow cursor-pointer">
                    <i data-lucide="trending-up" class="w-8 h-8 mx-auto text-kawn-base mb-2"></i>
                    <h4 class="font-bold text-sm">4. Operativa Real Gradual</h4>
                </div>
            </div>

            <p class="text-center mt-8 font-bold text-kawn-deep text-lg">
                ¬°La consistencia y la disciplina son las llaves para convertir este conocimiento en rentabilidad real!
            </p>

        </section>

    </main>

    <footer class="bg-slate-900 text-slate-400 py-12">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3">
                <!-- Placeholder Logo Footer -->
                <div
                    class="h-10 w-10 bg-gradient-to-br from-kawn-dark to-kawn-base rounded-md opacity-80 flex items-center justify-center text-white font-bold">
                    K</div>
                <div class="flex flex-col">
                    <span class="text-xl font-black text-white tracking-tight leading-none font-display">KAWNBIT</span>
                    <span
                        class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.2em] leading-none mt-1">Quantitative
                        Trading Community</span>
                </div>
            </div>
            <p class="text-sm text-center md:text-right">
                ¬© <span id="current-year">2024</span> KawnBit Magazine. Todos los derechos reservados.<br>
                <span class="text-xs opacity-50">Material educativo sobre Smart Money Concepts. No constituye
                    asesoramiento financiero.</span>
            </p>
        </div>
    </footer>

    <script>
        // Set Current Year in Footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Init Icons
        lucide.createIcons();

        // -----------------------------------------------------
        // 1. LIQUIDITY SIMULATOR LOGIC
        // -----------------------------------------------------
        function runLiquiditySim() {
            const path = document.getElementById('liquidity-price-path');
            const ball = document.getElementById('price-ball');
            const poolBuy = document.getElementById('pool-buy');
            const poolSell = document.getElementById('pool-sell');
            const status = document.getElementById('sim-status');
            const btn = document.getElementById('btn-hunt-liquidity');

            // Disable button
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> Ejecutando...`;
            lucide.createIcons();

            status.textContent = "El precio busca stops de venta...";
            status.style.opacity = "1";

            // Reset
            poolBuy.setAttribute('r', '0');
            poolSell.setAttribute('r', '0');

            // Step 1: Hunt Highs (Red) - Animation frames
            let startTime = null;

            function animatePrice(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = (timestamp - startTime) / 3000; // 3 seconds total

                if (progress < 0.4) {
                    // Phase 1: Go up to resistance
                    const y = 130 - (progress / 0.4 * 90); // 130 -> 40
                    ball.setAttribute('cy', y);
                    ball.setAttribute('cx', 250 + (progress * 50));
                } else if (progress < 0.5) {
                    // Hit Resistance
                    poolBuy.setAttribute('r', '20'); // Explosion
                    ball.setAttribute('fill', '#ef4444');
                    status.textContent = "¬°Liquidez tomada!";
                    status.setAttribute('fill', '#ef4444');
                } else if (progress < 0.9) {
                    // Phase 2: Go down fast to support
                    const relProgress = (progress - 0.5) / 0.4;
                    const y = 40 + (relProgress * 170); // 40 -> 210
                    ball.setAttribute('cy', y);
                    ball.setAttribute('cx', 270 + (relProgress * 10));
                    status.textContent = "Movimiento Institucional...";
                    status.setAttribute('fill', '#64748b');
                } else if (progress < 1) {
                    // Hit Support
                    poolSell.setAttribute('r', '20');
                    ball.setAttribute('fill', '#10b981');
                } else {
                    // End
                    status.textContent = "Ciclo Completado.";
                    btn.disabled = false;
                    btn.innerHTML = `<i data-lucide="rotate-ccw" class="w-3 h-3"></i> Reiniciar`;
                    lucide.createIcons();
                    return;
                }
                requestAnimationFrame(animatePrice);
            }
            requestAnimationFrame(animatePrice);
        }


        // -----------------------------------------------------
        // 2. MMBM STEPPER LOGIC
        // -----------------------------------------------------
        const descriptions = {
            1: "Fase 1: El precio consolida en un rango estrecho (Acumulaci√≥n) para inducir a traders minoristas a colocar √≥rdenes cerca.",
            2: "Fase 2: El Smart Money manipula el precio agresivamente a la baja (Manipulaci√≥n), activando los Stop-Loss de los compradores.",
            3: "Fase 3: Tras tomar la liquidez, el precio rompe la estructura al alza (BOS), confirmando el cambio de tendencia.",
            4: "Fase 4: El precio se expande r√°pidamente hacia los objetivos superiores, permitiendo al Smart Money distribuir sus ganancias."
        };

        function setPhase(phaseNum) {
            // Update Text
            const descEl = document.getElementById('phase-description');
            descEl.style.opacity = 0;
            setTimeout(() => {
                descEl.textContent = descriptions[phaseNum];
                descEl.style.opacity = 1;
            }, 300);

            // Update Buttons
            document.querySelectorAll('.phase-btn').forEach((btn, idx) => {
                if (idx + 1 === phaseNum) {
                    btn.classList.remove('text-slate-500', 'hover:bg-slate-200');
                    btn.classList.add('bg-white', 'shadow-sm', 'text-kawn-dark');
                } else {
                    btn.classList.add('text-slate-500', 'hover:bg-slate-200');
                    btn.classList.remove('bg-white', 'shadow-sm', 'text-kawn-dark');
                }
            });

            // Update Graph Visibility
            const phases = [1, 2, 3, 4];
            phases.forEach(p => {
                const group = document.getElementById(`phase-${p}-group`);
                if (p <= phaseNum) {
                    group.classList.remove('opacity-0');
                    // Restart animation for the active phase only
                    if (p === phaseNum) {
                        const path = group.querySelector('.path-animate');
                        if (path) {
                            path.style.animation = 'none';
                            path.offsetHeight; /* trigger reflow */
                            path.style.animation = null;
                        }
                    }
                } else {
                    group.classList.add('opacity-0');
                }
            });
        }

        // Initialize Phase 1
        setPhase(1);

        // Tooltip Logic
        function showTooltip(evt, text) {
            const tooltip = document.getElementById('mmbm-tooltip');
            tooltip.textContent = text;
            tooltip.style.opacity = 1;
            tooltip.style.left = (evt.offsetX + 10) + 'px';
            tooltip.style.top = (evt.offsetY - 30) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('mmbm-tooltip');
            tooltip.style.opacity = 0;
        }

        // -----------------------------------------------------
        // 3. PREMIUM VS DISCOUNT LOGIC
        // -----------------------------------------------------
        const pdSlider = document.getElementById('pd-slider');
        const priceMarker = document.getElementById('price-marker');
        const pdFeedback = document.getElementById('pd-feedback');
        const zonePremium = document.getElementById('zone-premium');
        const zoneDiscount = document.getElementById('zone-discount');

        if (pdSlider) {
            pdSlider.addEventListener('input', (e) => {
                const val = 100 - e.target.value; // Invert because slider top (100) is visually top
                priceMarker.style.top = val + "%";

                if (val < 50) {
                    // Premium Zone (0-49% from top in CSS top, actually high prices)
                    pdFeedback.innerHTML = `<span class="text-red-600">ZONA PREMIUM:</span> El precio es caro. Probabilidad de ventas institucional alta. <br> <span class="text-xs font-normal">No comprar aqu√≠.</span>`;
                    pdFeedback.className = "mt-4 p-4 rounded-lg bg-red-50 border border-red-200 text-center font-bold text-sm transition-colors duration-300";
                    zonePremium.style.opacity = "1";
                    zoneDiscount.style.opacity = "0.5";
                } else if (val > 50) {
                    // Discount Zone (51-100% from top)
                    pdFeedback.innerHTML = `<span class="text-green-600">ZONA DISCOUNT:</span> El precio es barato. Aqu√≠ es donde el Smart Money compra. <br> <span class="text-xs font-normal">Buscar entradas en largo.</span>`;
                    pdFeedback.className = "mt-4 p-4 rounded-lg bg-green-50 border border-green-200 text-center font-bold text-sm transition-colors duration-300";
                    zonePremium.style.opacity = "0.5";
                    zoneDiscount.style.opacity = "1";
                } else {
                    pdFeedback.innerHTML = "EQUILIBRIO (50%): Punto neutral.";
                    pdFeedback.className = "mt-4 p-4 rounded-lg bg-slate-100 text-center font-bold text-sm transition-colors duration-300";
                    zonePremium.style.opacity = "0.8";
                    zoneDiscount.style.opacity = "0.8";
                }
            });
        }

        // -----------------------------------------------------
        // 4. KILL ZONES LOGIC
        // -----------------------------------------------------
        const kzData = {
            'asia': { label: 'Asian Range (Consolidaci√≥n)', left: '0%', width: '25%', desc: '20:00 - 02:00 NY. Suele establecer el rango inicial. Baja volatilidad.' },
            'london': { label: 'London Open (Judas Swing)', left: '25%', width: '20%', desc: '02:00 - 05:00 NY. Alta probabilidad de formar el m√°ximo/m√≠nimo del d√≠a.' },
            'ny': { label: 'New York Open (Expansi√≥n)', left: '50%', width: '20%', desc: '07:00 - 10:00 NY. Continuaci√≥n de tendencia o reversi√≥n importante.' },
            'close': { label: 'London Close (Retorno)', left: '70%', width: '15%', desc: '10:00 - 12:00 NY. A menudo el precio retrocede parte del movimiento.' }
        };

        function showKillZone(zone) {
            const data = kzData[zone];
            const hl = document.getElementById('kz-highlight');
            const lbl = document.getElementById('kz-label');
            const info = document.getElementById('kz-info');

            hl.style.left = data.left;
            hl.style.width = data.width;
            hl.style.opacity = '1';
            lbl.textContent = data.label;

            info.innerHTML = `<span class="font-bold text-kawn-dark">${data.label}:</span> ${data.desc}`;
            info.classList.add('bg-kawn-light/20', 'border-kawn-base');
        }

        // -----------------------------------------------------
        // 5. SMT LOGIC
        // -----------------------------------------------------
        function revealSMT() {
            document.getElementById('smt-line-a').style.opacity = '1';
            document.getElementById('smt-text-a').style.opacity = '1';

            setTimeout(() => {
                document.getElementById('smt-line-b').style.opacity = '1';
                document.getElementById('smt-dot-b').style.opacity = '1';
                document.getElementById('smt-text-b').style.opacity = '1';
            }, 500);
        }

        // -----------------------------------------------------
        // 6. AI GEMINI INTEGRATION
        // -----------------------------------------------------

        const proxyUrl = "/.netlify/functions/gemini-proxy";

        // Helper to call Gemini with Exponential Backoff via Netlify Proxy
        async function callGeminiAPI(systemInstruction, userPrompt) {
            const maxRetries = 5;
            let retryCount = 0;
            let delay = 1000;

            while (retryCount <= maxRetries) {
                try {
                    const response = await fetch(proxyUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`Proxy overloaded or server error: ${response.status}`);
                        }
                        throw new Error(`Proxy Error: ${response.status}`);
                    }

                    const data = await response.json();

                    // Extraemos la respuesta de la estructura de Gemini o del campo result del proxy
                    if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                        return data.candidates[0].content.parts[0].text;
                    }
                    return data.result || "La IA no devolvi√≥ una respuesta v√°lida.";

                } catch (error) {
                    console.warn(`Intento ${retryCount + 1} fallido:`, error.message);

                    if (retryCount === maxRetries) {
                        console.error("M√°ximo de reintentos alcanzado.");
                        return "‚ö†Ô∏è Error de conexi√≥n: Aseg√∫rate de haber configurado la reserva de API en Netlify.";
                    }

                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                    retryCount++;
                }
            }
        }

        // --- Chatbot Logic ---
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('user-input');
        const chatMessages = document.getElementById('chat-messages');
        const chatSubmitBtn = document.getElementById('chat-submit-btn');

        const MENTOR_SYSTEM_PROMPT = `
            Eres KawnBit Mentor, un experto en trading institucional, Smart Money Concepts (SMC) y el modelo MMxM (Market Maker Buy/Sell Model).
            Tu objetivo es educar a traders sobre estos conceptos.
            Usa un tono profesional pero alentador.
            Responde de manera concisa (m√°ximo 3 p√°rrafos).
            Usa emojis ocasionalmente ‚ú®.
            El contexto es un art√≠culo educativo sobre MMxM, Acumulaci√≥n, Manipulaci√≥n, Distribuci√≥n, FVG, Order Blocks, Kill Zones.
        `;

        if (chatForm) {
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = chatInput.value.trim();
                if (!message) return;

                // Disable UI
                chatInput.disabled = true;
                chatSubmitBtn.disabled = true;

                // Add User Message
                appendMessage(message, 'user');
                chatInput.value = '';

                // Add Typing Indicator
                const loadingId = appendTypingIndicator();

                // Call API
                const reply = await callGeminiAPI(MENTOR_SYSTEM_PROMPT, message);

                // Remove Loading & Add Bot Message
                document.getElementById(loadingId).remove();

                if (reply) {
                    appendMessage(reply, 'bot');
                } else {
                    appendMessage("Lo siento, la red est√° muy ocupada. Por favor, intenta de nuevo en unos momentos.", 'bot error text-red-500');
                }

                // Re-enable UI
                chatInput.disabled = false;
                chatSubmitBtn.disabled = false;
                chatInput.focus();
            });
        }

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `ai-message ${sender}`;

            // Check if marked is available for robust rendering
            if (typeof marked !== 'undefined') {
                div.innerHTML = marked.parse(text);
            } else {
                div.innerText = text; // Fallback to plain text
            }

            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function appendTypingIndicator() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'ai-message bot typing-indicator';
            div.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return id;
        }

        // --- Scenario Analyzer Logic ---
        const SCENARIO_SYSTEM_PROMPT = `
            Act√∫a como un analista de mercado institucional senior.
            El usuario te dar√° una descripci√≥n de un escenario de mercado.
            Anal√≠zalo buscando las siguientes confluencias:
            1. ¬øHubo toma de liquidez (Stop Hunt)?
            2. ¬øHay rompimiento de estructura (BOS)?
            3. ¬øHay ineficiencias (FVG)?
            4. ¬øCu√°l es el bias (alcista/bajista)?
            
            Da una respuesta estructurada y breve.
        `;

        async function analyzeScenario() {
            const input = document.getElementById('scenario-input').value;
            const resultBox = document.getElementById('scenario-result');
            const btn = document.getElementById('scenario-btn');

            if (!input.trim()) {
                resultBox.innerHTML = '<span class="text-red-500">Por favor describe un escenario primero.</span>';
                return;
            }

            // UI Loading State
            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader" class="animate-spin w-4 h-4"></i> Analizando...';
            lucide.createIcons();

            const analysis = await callGeminiAPI(SCENARIO_SYSTEM_PROMPT, input);

            // UI Reset State
            btn.disabled = false;
            btn.innerHTML = '<i data-lucide="sparkles" class="w-4 h-4"></i> Analizar con IA';
            lucide.createIcons();

            if (analysis) {
                resultBox.innerHTML = typeof marked !== 'undefined' ? marked.parse(analysis) : analysis;
            } else {
                resultBox.innerHTML = '<span class="text-red-500">Error de conexi√≥n. Intenta de nuevo.</span>';
            }
        }

        // --- AI Quiz Generator Logic ---
        async function generateQuiz() {
            const container = document.getElementById('quiz-container');
            const originalContent = container.innerHTML; // Backup

            // Show Loading State
            container.innerHTML = `
                <div class="text-center py-6 text-kawn-dark">
                    <i data-lucide="loader-2" class="animate-spin w-8 h-8 mx-auto mb-2"></i>
                    <p class="font-bold">Gemini est√° dise√±ando tu examen...</p>
                    <p class="text-xs opacity-70">Analizando conceptos de SMC y MMxM</p>
                </div>
            `;
            lucide.createIcons();

            const QUIZ_PROMPT = `
                Genera un examen corto de 3 preguntas de selecci√≥n m√∫ltiple (en Espa√±ol) sobre Trading Institucional, MMxM y Order Blocks.
                Formato JSON estricto SIN markdown ni bloques de c√≥digo.
                Ejemplo de estructura:
                [
                    {
                        "q": "Pregunta...",
                        "options": ["Opci√≥n A", "Opci√≥n B", "Opci√≥n C", "Opci√≥n D"],
                        "a": 0 
                    }
                ]
                Nota: "a" es el √≠ndice de la respuesta correcta (0, 1, 2 o 3).
                Responde SOLO con el JSON.
            `;

            try {
                let text = await callGeminiAPI("Eres un instructor experto de trading. Genera solo JSON v√°lido.", QUIZ_PROMPT);

                if (!text) throw new Error("No response from AI");

                // Robust JSON Cleanup: Find first [ and last ]
                const firstBracket = text.indexOf('[');
                const lastBracket = text.lastIndexOf(']');

                if (firstBracket !== -1 && lastBracket !== -1) {
                    text = text.substring(firstBracket, lastBracket + 1);
                } else {
                    // Fallback cleanup if brackets not found cleanly
                    text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                }

                const questions = JSON.parse(text);
                renderQuiz(questions);

            } catch (e) {
                console.error("Quiz Error:", e);
                container.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-red-500 text-sm font-bold mb-2">Error generando el quiz.</p>
                        <button id="retry-quiz-btn" class="text-xs bg-slate-200 px-3 py-2 rounded font-bold hover:bg-slate-300 transition">Intentar de nuevo</button>
                    </div>
                `;
                document.getElementById('retry-quiz-btn').onclick = generateQuiz;
            }
        }

        function renderQuiz(questions) {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            // Score tracking
            let score = 0;
            let answered = 0;

            const quizWrapper = document.createElement('div');
            quizWrapper.className = 'space-y-6 animate-in fade-in duration-500';

            questions.forEach((q, qIndex) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'border-b border-slate-100 pb-4 last:border-0';

                // Question Text
                const qTitle = document.createElement('p');
                qTitle.className = 'font-bold text-sm text-kawn-deep mb-3';
                qTitle.textContent = `${qIndex + 1}. ${q.q}`;
                qDiv.appendChild(qTitle);

                // Options
                const optionsDiv = document.createElement('div');
                q.options.forEach((opt, optIndex) => {
                    const btn = document.createElement('div');
                    btn.className = 'quiz-option text-xs text-slate-600 select-none';
                    btn.textContent = opt;

                    btn.onclick = () => {
                        // Prevent changing answer
                        if (btn.parentElement.classList.contains('answered')) return;

                        btn.parentElement.classList.add('answered');
                        answered++;

                        if (optIndex === q.a) {
                            btn.classList.add('correct');
                            score++;
                            // Add checkmark
                            btn.innerHTML += ' <i data-lucide="check" class="inline w-3 h-3 ml-1"></i>';
                        } else {
                            btn.classList.add('wrong');
                            // Highlight correct one
                            optionsDiv.children[q.a].classList.add('correct');
                        }
                        lucide.createIcons();

                        // Show score if finished
                        if (answered === questions.length) {
                            showScore(score, questions.length);
                        }
                    };
                    optionsDiv.appendChild(btn);
                });

                qDiv.appendChild(optionsDiv);
                quizWrapper.appendChild(qDiv);
            });

            container.appendChild(quizWrapper);

            // Add reset button at bottom
            const resetBtn = document.createElement('button');
            resetBtn.className = 'w-full mt-4 py-2 text-xs text-slate-400 hover:text-kawn-base underline';
            resetBtn.textContent = 'Generar Nuevas Preguntas';
            resetBtn.onclick = generateQuiz;
            container.appendChild(resetBtn);
        }

        function showScore(score, total) {
            const container = document.getElementById('quiz-container');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'mt-4 p-3 bg-kawn-light/50 border border-kawn-base rounded text-center animate-pulse';
            resultDiv.innerHTML = `<span class="font-bold text-kawn-deep">Resultado: ${score}/${total}</span>`;

            if (score === total) resultDiv.innerHTML += ' ¬°Excelente! üèÜ';
            else if (score > 0) resultDiv.innerHTML += ' ¬°Buen intento!';

            // Insert before reset button
            const resetBtn = container.querySelector('button');
            if (resetBtn) {
                container.insertBefore(resultDiv, resetBtn);
            } else {
                container.appendChild(resultDiv);
            }
        }

    </script>

</body>

</html>