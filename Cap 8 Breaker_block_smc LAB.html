<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="KawnBit Cap 8: Domina los Breaker Blocks (BB) en el trading institucional. Aprende a identificar trampas de liquidez y cambios de estructura.">
    <title>KawnBit | Cap 8: Breaker Blocks</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Librerías Externas (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Usamos una versión específica y estable de Plotly para evitar conflictos con Chart.js -->
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Configuración Tailwind KawnBit -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kawn: {
                            light: '#ccfbf1', // Teal 100
                            base: '#14b8a6',  // Teal 500
                            dark: '#0f766e',  // Teal 700
                            deep: '#134e4a',  // Teal 900
                        },
                        slate: {
                            50: '#f8fafc',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(20, 184, 166, 0.25)',
                        'card': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos base */
        body {
            background-color: #f8fafc;
            color: #334155;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Montserrat', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #14b8a6;
        }

        .kawn-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #14b8a6 0%, #0f766e 100%);
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(20, 184, 166, 0.4);
            flex-shrink: 0;
        }

        .kawn-logo-icon::after {
            content: 'K';
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toc-link {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .toc-link:hover {
            color: #14b8a6;
        }

        .toc-link.active {
            color: #0f766e;
            border-left: 3px solid #14b8a6;
            background-color: #f0fdfa;
            padding-left: 0.75rem;
            font-weight: 600;
        }

        #reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #14b8a6, #0f766e);
            z-index: 100;
            width: 0%;
            transition: width 0.1s ease-out;
        }

        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .callout-card {
            background-color: #f0fdfa;
            border-left: 4px solid #14b8a6;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(20, 184, 166, 0.1);
        }

        blockquote {
            font-style: italic;
            border-left: 4px solid #cbd5e1;
            padding-left: 1.5rem;
            color: #64748b;
            margin: 2rem 0;
            font-size: 1.1rem;
        }

        /* Chat Bot */
        .chat-message {
            max-width: 85%;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.95rem;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            background-color: #14b8a6;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }

        .ai-message {
            background-color: #f1f5f9;
            color: #334155;
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid #e2e8f0;
        }

        .ai-message strong {
            color: #0f766e;
            font-weight: 700;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quiz-option {
            transition: all 0.2s;
        }

        .quiz-option:hover:not(.disabled) {
            background-color: #f0fdfa;
            border-color: #14b8a6;
        }

        .quiz-option.selected {
            background-color: #ccfbf1;
            border-color: #14b8a6;
            color: #0f766e;
        }

        .quiz-option.correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #15803d !important;
        }

        .quiz-option.incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #b91c1c !important;
        }

        .ai-lab-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #134e4a 100%);
        }
    </style>
</head>

<body class="antialiased text-slate-600">

    <div id="reading-progress"></div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 w-full bg-white/95 backdrop-blur-md border-b border-slate-200 shadow-sm transition-all duration-300"
        id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center gap-3">
                    <div class="kawn-logo-icon"></div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-black text-slate-900 tracking-tight leading-none">KAWNBIT</span>
                        <span
                            class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.2em] leading-none mt-1">Quantitative
                            Trading Community</span>
                    </div>
                </div>

                <button id="mobile-menu-btn" class="md:hidden p-2 text-slate-600 hover:text-kawn-base transition-colors"
                    aria-label="Abrir menú" aria-expanded="false">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>

                <div class="hidden md:flex space-x-8 items-center">
                    <span class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Capítulo 8</span>
                    <a href="#simulacion"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-sm">Simulador</a>
                    <a href="#avanzado"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-sm">Avanzado</a>
                    <a href="#ai-lab"
                        class="px-3 py-1 bg-kawn-light text-kawn-deep rounded-md text-sm font-bold border border-kawn-base/30 hover:bg-kawn-base hover:text-white transition-colors flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-3 h-3"></i> AI Lab
                    </a>
                    <a href="#evaluacion"
                        class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-bold hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/20">Test
                        final</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Layout -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="flex flex-col md:flex-row gap-12">

            <!-- Sidebar -->
            <aside class="hidden md:block w-64 flex-shrink-0" id="sidebar" aria-label="Tabla de contenidos">
                <div class="sticky top-28">
                    <h3
                        class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 border-b border-slate-200 pb-2">
                        Contenido del capítulo</h3>
                    <nav id="toc-container"
                        class="flex flex-col space-y-1 text-sm max-h-[calc(100vh-200px)] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- JS generated -->
                    </nav>
                </div>
            </aside>

            <!-- Main -->
            <main class="flex-1 max-w-4xl min-w-0">

                <section class="mb-16 fade-in-up">
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-kawn-light text-kawn-dark text-xs font-bold uppercase tracking-wider mb-6">
                        <span class="w-2 h-2 rounded-full bg-kawn-base"></span> Smart Money Concepts
                    </div>
                    <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-6 leading-tight">
                        Bloques de Ruptura <span class="text-kawn-base">(Breaker Blocks)</span>
                    </h1>
                    <p class="text-xl text-slate-500 leading-relaxed border-l-4 border-kawn-base pl-6 py-2">
                        El arte del engaño institucional: cómo una trampa de liquidez se convierte en tu mejor
                        oportunidad de entrada.
                    </p>
                </section>

                <section id="introduccion" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">La naturaleza engañosa del Breaker Block</h2>
                    <p class="mb-6 leading-7">
                        Imagina por un momento que estás observando un partido de ajedrez entre dos maestros. Uno de
                        ellos sacrifica deliberadamente una pieza importante... En los mercados financieros, los
                        <strong>Bloques de Ruptura</strong> operan bajo este mismo principio de engaño calculado.
                    </p>

                    <div class="bg-white p-6 rounded-xl shadow-card border border-slate-100 mb-8">
                        <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                            <i data-lucide="shield-alert" class="text-kawn-base w-5 h-5"></i> Definición clave
                        </h3>
                        <p class="text-slate-600">
                            Un <strong>Breaker Block</strong> es un Order Block que ha fallado en sostener el precio y
                            que, al ser quebrado, marca un cambio pivotal en la estructura y liquidez del mercado.
                        </p>
                    </div>
                </section>

                <section id="anatomia" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">La anatomía de un Breaker Block: Estructura y
                        fases</h2>
                    <p class="mb-8">Entender un Breaker Block requiere desglosar su secuencia de formación en cuatro
                        fases claras.</p>

                    <!-- Fases Interactivas -->
                    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden mb-12">
                        <div class="bg-slate-900 p-4 border-b border-slate-800 flex justify-between items-center">
                            <h3 class="text-white font-bold flex items-center gap-2">
                                <i data-lucide="layers" class="text-kawn-base w-5 h-5"></i> Secuencia de manipulación
                            </h3>
                            <span class="text-xs font-mono text-slate-400">Guía interactiva</span>
                        </div>
                        <div class="grid md:grid-cols-2">
                            <div class="p-6 bg-slate-50 border-r border-slate-200">
                                <div class="space-y-2">
                                    <button onclick="setPhase(1)" id="btn-phase-1"
                                        class="w-full text-left p-4 rounded-lg border-2 border-kawn-base bg-white shadow-md transition-all">
                                        <div class="font-bold text-slate-900">Fase 1: El cebo (Order Block)</div>
                                        <div class="text-xs text-slate-500 mt-1">Se crea un soporte aparente.</div>
                                    </button>
                                    <button onclick="setPhase(2)" id="btn-phase-2"
                                        class="w-full text-left p-4 rounded-lg border-2 border-transparent hover:bg-white hover:shadow-sm transition-all opacity-60">
                                        <div class="font-bold text-slate-900">Fase 2: Toma de liquidez</div>
                                        <div class="text-xs text-slate-500 mt-1">Ruptura falsa, trampa de toros/osos.
                                        </div>
                                    </button>
                                    <button onclick="setPhase(3)" id="btn-phase-3"
                                        class="w-full text-left p-4 rounded-lg border-2 border-transparent hover:bg-white hover:shadow-sm transition-all opacity-60">
                                        <div class="font-bold text-slate-900">Fase 3: Desplazamiento</div>
                                        <div class="text-xs text-slate-500 mt-1">Ruptura violenta del nivel original.
                                        </div>
                                    </button>
                                    <button onclick="setPhase(4)" id="btn-phase-4"
                                        class="w-full text-left p-4 rounded-lg border-2 border-transparent hover:bg-white hover:shadow-sm transition-all opacity-60">
                                        <div class="font-bold text-slate-900">Fase 4: Transformación</div>
                                        <div class="text-xs text-slate-500 mt-1">El soporte roto ahora es resistencia
                                            (BB).</div>
                                    </button>
                                </div>
                            </div>
                            <div class="p-6 flex flex-col justify-center items-center bg-white relative h-80">
                                <canvas id="phaseChart"></canvas>
                                <div id="phase-desc" class="mt-4 text-center text-sm text-slate-600 italic">
                                    Selecciona una fase para visualizar la estructura.
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="psicologia" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Psicología: Entendiendo la manipulación</h2>
                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <div
                            class="bg-gradient-to-br from-white to-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-kawn-deep mb-3">La visión institucional</h3>
                            <p class="text-sm leading-relaxed">
                                "Necesito vender millones. No puedo hacerlo si nadie compra. Primero crearé euforia
                                alcista para que los minoristas compren mis ventas."
                            </p>
                        </div>
                        <div
                            class="bg-gradient-to-br from-white to-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-slate-600 mb-3">El dolor minorista</h3>
                            <p class="text-sm leading-relaxed">
                                Codicia en la ruptura. Miedo en el desplazamiento. Esperanza en el retorno. Esa
                                esperanza es la liquidez del Breaker.
                            </p>
                        </div>
                    </div>
                </section>

                <section id="retorno-entrada" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">El retorno: La oportunidad de oro</h2>
                    <p class="mb-6">El precio suele volver al Breaker Block para mitigar posiciones. Aquí es donde
                        operamos.</p>

                    <!-- Simulador Plotly -->
                    <div id="simulacion" class="bg-slate-900 rounded-xl p-6 shadow-2xl mb-10 border border-slate-700">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                            <div>
                                <h3 class="text-white font-bold text-lg flex items-center gap-2">
                                    <i data-lucide="activity" class="text-kawn-base"></i> Simulador de trading: Breaker
                                    bajista
                                </h3>
                                <p class="text-slate-400 text-xs mt-1">Observa la formación de velas y decide cuándo
                                    entrar.</p>
                            </div>
                            <div class="flex gap-2">
                                <button id="sim-next"
                                    class="px-4 py-2 bg-kawn-base hover:bg-kawn-light hover:text-kawn-deep text-white font-bold rounded-lg text-xs transition-colors shadow-glow">
                                    Siguiente vela
                                </button>
                                <button id="sim-reset"
                                    class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-lg text-xs transition-colors">
                                    Reiniciar
                                </button>
                            </div>
                        </div>
                        <div id="plotly-chart" class="w-full h-[400px] bg-slate-800 rounded-lg"></div>
                        <div id="sim-status"
                            class="mt-4 p-3 bg-slate-800 rounded-lg border border-slate-700 text-sm text-kawn-light font-mono min-h-[50px] flex items-center">
                            Estado: Mercado en rango. Esperando manipulación...
                        </div>
                    </div>
                </section>

                <section id="gestion-riesgo" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Gestión de riesgo: Stop Loss y posicionamiento
                    </h2>
                    <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden mb-8">
                        <div class="flex border-b border-slate-200">
                            <button onclick="switchRiskTab('conservative')" id="tab-conservative"
                                class="flex-1 py-4 text-sm font-bold text-kawn-deep border-b-2 border-kawn-base bg-kawn-light/20 transition-colors">
                                Enfoque conservador
                            </button>
                            <button onclick="switchRiskTab('aggressive')" id="tab-aggressive"
                                class="flex-1 py-4 text-sm font-bold text-slate-500 border-b-2 border-transparent hover:bg-slate-50 transition-colors">
                                Enfoque agresivo
                            </button>
                        </div>
                        <div class="p-8">
                            <div id="content-conservative" class="fade-in-up">
                                <div class="flex items-start gap-4">
                                    <div class="p-3 bg-blue-100 text-blue-700 rounded-lg"><i data-lucide="shield"
                                            class="w-6 h-6"></i></div>
                                    <div>
                                        <h4 class="font-bold text-lg text-slate-900 mb-2">Stop cubriendo todo el bloque
                                        </h4>
                                        <p class="text-slate-600 mb-4">Se coloca el SL por encima (o debajo) de todo el
                                            rango del Breaker Block.</p>
                                    </div>
                                </div>
                            </div>
                            <div id="content-aggressive" class="hidden fade-in-up">
                                <div class="flex items-start gap-4">
                                    <div class="p-3 bg-orange-100 text-orange-700 rounded-lg"><i data-lucide="crosshair"
                                            class="w-6 h-6"></i></div>
                                    <div>
                                        <h4 class="font-bold text-lg text-slate-900 mb-2">Stop en el 50% del bloque
                                            ("Mean Threshold")</h4>
                                        <p class="text-slate-600 mb-4">Se asume que si el precio penetra más del 50% del
                                            cuerpo del Breaker, la idea está invalidada.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="tipos-confluencias" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Tipos y confluencias</h2>
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="border border-slate-200 p-5 rounded-lg hover:border-kawn-base transition-colors">
                            <h4 class="font-bold text-slate-800 mb-2">Inicio de tendencia</h4>
                            <p class="text-sm text-slate-600">Se forman en giros mayores (semanal/diario). Ofrecen el
                                mayor recorrido pero requieren operar contra la inercia previa.</p>
                        </div>
                        <div class="border border-slate-200 p-5 rounded-lg hover:border-kawn-base transition-colors">
                            <h4 class="font-bold text-slate-800 mb-2">Continuación</h4>
                            <p class="text-sm text-slate-600">Dentro de una tendencia establecida. Más seguros, mayor
                                frecuencia.</p>
                        </div>
                    </div>
                </section>

                <!-- NUEVA SECCIÓN: CONCEPTOS AVANZADOS -->
                <section id="avanzado" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2">
                        <i data-lucide="microscope" class="text-kawn-base"></i> Refinamiento Avanzado: Maestría Fractal
                    </h2>

                    <p class="mb-8 leading-7 text-slate-600">
                        Más allá de la identificación básica, el trading institucional requiere entender la naturaleza
                        <strong>fractal</strong> del mercado y saber reaccionar cuando la estructura falla.
                    </p>

                    <!-- Concepto 1: Breaker Blocks Anidados -->
                    <div class="mb-12">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">1. Breaker Blocks Anidados (Fractalidad)</h3>
                        <p class="mb-6 text-sm text-slate-600">
                            En mercados complejos, a menudo encontramos "Breakers dentro de Breakers". Un BB masivo en
                            el gráfico diario (H4/D1) puede contener una estructura más limpia y precisa en M15. Esta
                            alineación aumenta la probabilidad de éxito exponencialmente.
                        </p>

                        <!-- Interactive Tool: Fractal Visualizer -->
                        <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                            <div class="bg-slate-100 p-3 border-b border-slate-200 flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Visualizador
                                    Multi-Timeframe</span>
                                <div class="flex space-x-2">
                                    <button onclick="toggleFractalView('macro')" id="btn-macro"
                                        class="px-3 py-1 text-xs font-bold rounded bg-kawn-base text-white shadow-sm">Vista
                                        Macro (H4)</button>
                                    <button onclick="toggleFractalView('micro')" id="btn-micro"
                                        class="px-3 py-1 text-xs font-bold rounded bg-white text-slate-600 hover:bg-slate-200 border border-slate-300">Vista
                                        Micro (M15)</button>
                                </div>
                            </div>
                            <div class="relative h-64 w-full bg-slate-900 p-6 flex justify-center items-center"
                                id="fractal-container">
                                <!-- Canvas para Chart.js Fractal -->
                                <canvas id="fractalChart"></canvas>
                            </div>
                            <div class="p-4 bg-slate-50 text-xs text-slate-500 italic border-t border-slate-200"
                                id="fractal-desc">
                                Vista H4: Una sola vela bajista grande representa el Breaker Block completo. Zona amplia
                                de riesgo.
                            </div>
                        </div>
                    </div>

                    <!-- Concepto 2: Breaker Fallido -->
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-4">2. Breaker Blocks Fallidos como Señales</h3>
                        <p class="mb-6 text-sm text-slate-600">
                            Paradójicamente, un BB que falla es información valiosa. Si el precio atraviesa el bloque
                            sin respeto alguno, indica una fuerza abrumadora en la dirección opuesta. El "techo" se
                            convierte en "trampolín".
                        </p>

                        <!-- Interactive Tool: Failure Simulator -->
                        <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                            <h4 class="text-white font-bold mb-2 text-sm flex items-center gap-2">
                                <i data-lucide="zap-off" class="text-red-400 w-4 h-4"></i> Simulador de Escenarios de
                                Ruptura
                            </h4>
                            <p class="text-slate-400 text-xs mb-4">Haz clic para testear la fuerza del nivel.</p>

                            <div class="flex gap-3 mb-4">
                                <button onclick="simulateScenario('respect')"
                                    class="flex-1 py-2 bg-green-600 hover:bg-green-700 text-white rounded text-xs font-bold transition-colors">Escenario:
                                    Respeto</button>
                                <button onclick="simulateScenario('fail')"
                                    class="flex-1 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-xs font-bold transition-colors">Escenario:
                                    Fallo (Invalidación)</button>
                            </div>

                            <div class="h-40 bg-slate-900 rounded border border-slate-700 relative overflow-hidden"
                                id="scenario-display">
                                <canvas id="scenarioChart"></canvas>
                            </div>
                            <div id="scenario-feedback" class="mt-3 text-xs text-kawn-light font-mono min-h-[40px]">
                                Selecciona un escenario para ver la reacción del precio.
                            </div>
                        </div>
                    </div>
                </section>

                <section id="errores-casos" class="mb-20 scroll-mt-28">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6">Errores comunes</h2>
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-lg mb-8">
                        <ul class="space-y-2 text-red-800 text-sm font-medium">
                            <li>1. <strong>Identificación prematura:</strong> No esperar a que la vela cierre.</li>
                            <li>2. <strong>Ignorar contexto:</strong> Operar un BB contra tendencia fuerte.</li>
                            <li>3. <strong>FOMO:</strong> Entrar antes de tiempo.</li>
                        </ul>
                    </div>
                </section>

                <section id="ai-lab" class="mb-20 scroll-mt-28">
                    <div class="ai-lab-gradient p-1 rounded-2xl shadow-xl">
                        <div class="bg-slate-900 rounded-xl p-8 border border-slate-700">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="p-3 bg-kawn-base rounded-full text-white animate-pulse">
                                    <i data-lucide="sparkles" class="w-6 h-6"></i>
                                </div>
                                <h2 class="text-2xl font-black text-white">Laboratorio Institucional con IA ✨</h2>
                            </div>

                            <p class="text-slate-300 mb-8 max-w-2xl">
                                Utiliza la potencia de Gemini para analizar escenarios de mercado complejos o generar
                                desafíos infinitos.
                            </p>

                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- Detective -->
                                <div
                                    class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-kawn-base transition-all">
                                    <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                                        <i data-lucide="search" class="text-kawn-light w-5 h-5"></i> Detective de
                                        Estructura
                                    </h3>
                                    <textarea id="structure-input" rows="3"
                                        class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-sm text-white mb-4 focus:ring-1 focus:ring-kawn-base focus:border-kawn-base focus:outline-none placeholder-slate-500"
                                        placeholder="Ej: El precio rompió el máximo de ayer con poco volumen..."></textarea>
                                    <button id="analyze-btn"
                                        class="w-full py-2 bg-kawn-deep text-kawn-light border border-kawn-base rounded-lg font-bold hover:bg-kawn-base hover:text-white transition-all flex justify-center items-center gap-2 text-sm">
                                        <i data-lucide="cpu" class="w-4 h-4"></i> Analizar Setup
                                    </button>
                                    <div id="analyze-result"
                                        class="mt-4 hidden p-3 bg-slate-900/50 rounded-lg text-sm text-slate-300 border-l-2 border-kawn-base">
                                    </div>
                                </div>

                                <!-- Quiz -->
                                <div
                                    class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-kawn-base transition-all flex flex-col">
                                    <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                                        <i data-lucide="brain-circuit" class="text-kawn-light w-5 h-5"></i> Quiz
                                        Infinito
                                    </h3>
                                    <div id="dynamic-quiz-container"
                                        class="flex-1 flex flex-col justify-center items-center min-h-[120px] bg-slate-900/50 rounded-lg p-4 border border-dashed border-slate-600 mb-4">
                                        <span class="text-slate-500 text-sm text-center">Pulsa el botón para generar un
                                            reto.</span>
                                    </div>
                                    <button id="generate-quiz-btn"
                                        class="w-full py-2 bg-gradient-to-r from-kawn-dark to-kawn-base text-white rounded-lg font-bold hover:shadow-lg hover:shadow-kawn-base/20 transition-all flex justify-center items-center gap-2 text-sm mt-auto">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> Generar Pregunta
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="evaluacion" class="mb-24 scroll-mt-28">
                    <div class="bg-white p-8 rounded-2xl shadow-card border border-slate-200 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-5">
                            <i data-lucide="award" class="w-32 h-32 text-kawn-base"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-2">
                            <i data-lucide="check-circle-2" class="text-kawn-base"></i> Validación del conocimiento
                        </h2>

                        <div class="space-y-6 relative z-10">
                            <!-- Preguntas estáticas -->
                            <div class="quiz-item">
                                <p class="font-semibold text-slate-800 mb-3">1. ¿Qué define principalmente a un Breaker
                                    Block?</p>
                                <div class="grid gap-2">
                                    <button
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 text-sm text-slate-600 hover:shadow-sm"
                                        onclick="checkAnswer(this, false, 0)">A. Es un Order Block que nunca fue
                                        tocado.</button>
                                    <button
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 text-sm text-slate-600 hover:shadow-sm"
                                        onclick="checkAnswer(this, true, 0)">B. Es un Order Block que falló, fue roto y
                                        ahora invierte su rol.</button>
                                    <button
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 text-sm text-slate-600 hover:shadow-sm"
                                        onclick="checkAnswer(this, false, 0)">C. Es una zona de consolidación.</button>
                                </div>
                            </div>
                            <!-- Más preguntas... -->
                        </div>
                        <div id="quiz-feedback"
                            class="hidden mt-6 p-6 bg-slate-50 border-l-4 border-kawn-base rounded-r-lg text-sm text-slate-700 leading-relaxed shadow-sm transition-all duration-500 ease-in-out">
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- AI Button & Modal -->
    <button id="ai-toggle"
        class="fixed bottom-6 right-6 z-40 bg-slate-900 text-white p-4 rounded-full shadow-2xl hover:bg-kawn-base hover:scale-105 transition-all flex items-center gap-2 group"
        aria-label="Abrir mentor de IA">
        <i data-lucide="bot" class="w-6 h-6 group-hover:animate-bounce"></i>
    </button>

    <div id="ai-modal"
        class="hidden fixed bottom-24 right-6 w-96 max-w-[90vw] bg-white rounded-xl shadow-2xl border border-slate-200 z-50 flex flex-col h-[500px] animate-fade-in-up">
        <div class="p-4 bg-slate-900 text-white rounded-t-xl flex justify-between items-center">
            <h3 class="font-bold flex items-center gap-2 text-sm"><i data-lucide="sparkles"
                    class="text-kawn-base w-4 h-4"></i> Mentor inteligente</h3>
            <button id="close-ai" class="hover:text-kawn-light transition-colors"><i data-lucide="x"
                    class="w-5 h-5"></i></button>
        </div>
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 bg-slate-50 flex flex-col custom-scrollbar">
            <div class="ai-message chat-message shadow-sm">Hola, soy tu mentor de trading. ¿Dudas sobre Breaker Blocks?
            </div>
        </div>
        <div class="p-4 border-t border-slate-200 bg-white rounded-b-xl">
            <div class="flex gap-2 relative">
                <input type="text" id="user-input"
                    class="flex-1 border border-slate-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-kawn-base pr-10"
                    placeholder="Pregunta...">
                <button id="send-ai"
                    class="absolute right-2 top-1.5 p-1 text-kawn-base hover:text-kawn-dark transition-colors"><i
                        data-lucide="send" class="w-4 h-4"></i></button>
            </div>
            <div id="ai-typing" class="hidden text-xs text-slate-400 mt-2 pl-2">KawnBit AI escribiendo...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- 1. CONFIGURACIÓN Y VARIABLES GLOBALES ---

        // Inicializar Iconos
        if (typeof lucide !== 'undefined') lucide.createIcons();

        // Variables de gráficos
        let phaseChart = null;
        let fractalChart = null;
        let scenarioChart = null;
        let step = 0;
        let resizeTimeout;

        // Datos del gráfico de velas (Plotly)
        const candleData = [
            { open: 100, high: 102, low: 99, close: 101 },
            { open: 101, high: 103, low: 100, close: 102 },
            { open: 102, high: 104, low: 101, close: 101.5 },
            { open: 101.5, high: 106, low: 101.5, close: 105.5 },
            { open: 105.5, high: 106, low: 98, close: 98.5 },
            { open: 98.5, high: 101.5, low: 98, close: 100 },
            { open: 100, high: 100.5, low: 90, close: 92 }
        ];

        // --- 2. FUNCIONES DEFINIDAS EN WINDOW (ACCESIBLES DESDE HTML) ---

        // Función para cambiar fase en gráfico Chart.js
        window.setPhase = function (phase) {
            const desc = document.getElementById('phase-desc');
            let d = [], c = '#94a3b8';

            document.querySelectorAll('[id^="btn-phase-"]').forEach((b, i) => {
                if (i + 1 === phase) { b.classList.add('border-kawn-base', 'bg-white', 'shadow-md'); b.classList.remove('border-transparent', 'opacity-60'); }
                else { b.classList.remove('border-kawn-base', 'bg-white', 'shadow-md'); b.classList.add('border-transparent', 'opacity-60'); }
            });

            if (phase === 1) { d = [100, 105, 104, null, null, null, null]; desc.innerText = "Fase 1: Formación de OB."; }
            else if (phase === 2) { d = [100, 105, 104, 108, null, null, null]; desc.innerText = "Fase 2: Liquidity Grab."; c = '#ef4444'; }
            else if (phase === 3) { d = [100, 105, 104, 108, 100, null, null]; desc.innerText = "Fase 3: Desplazamiento."; c = '#14b8a6'; }
            else { d = [100, 105, 104, 108, 100, 104, 90]; desc.innerText = "Fase 4: Retesteo y entrada."; c = '#14b8a6'; }

            if (phaseChart) { phaseChart.data.datasets[0].data = d; phaseChart.data.datasets[0].borderColor = c; phaseChart.update(); }
        };

        // Función para alternar vista fractal
        window.toggleFractalView = function (view) {
            const btnMacro = document.getElementById('btn-macro');
            const btnMicro = document.getElementById('btn-micro');
            const desc = document.getElementById('fractal-desc');

            if (view === 'macro') {
                btnMacro.classList.replace('bg-white', 'bg-kawn-base');
                btnMacro.classList.replace('text-slate-600', 'text-white');
                btnMicro.classList.replace('bg-kawn-base', 'bg-white');
                btnMicro.classList.replace('text-white', 'text-slate-600');

                desc.innerText = "Vista H4: Una sola vela bajista grande representa el Breaker Block completo. Zona amplia de riesgo.";

                fractalChart.data.labels = ['H4 Candle (BB)'];
                fractalChart.data.datasets[0].data = [[100, 110]];
                fractalChart.data.datasets[0].backgroundColor = 'rgba(20, 184, 166, 0.5)';
            } else {
                btnMicro.classList.replace('bg-white', 'bg-kawn-base');
                btnMicro.classList.replace('text-slate-600', 'text-white');
                btnMacro.classList.replace('bg-kawn-base', 'bg-white');
                btnMacro.classList.replace('text-white', 'text-slate-600');

                desc.innerText = "Vista M15: Dentro de esa vela H4, vemos una estructura clara de 'Order Block + Rompimiento'. Aquí podemos refinar la entrada (Sniper Entry).";

                fractalChart.data.labels = ['M15-1', 'M15-2', 'M15-3 (OB)', 'M15-4 (Break)', 'M15-5'];
                fractalChart.data.datasets[0].data = [
                    [100, 102], [102, 105], [105, 104], [104, 110], [110, 108]
                ];
                fractalChart.data.datasets[0].backgroundColor = [
                    '#cbd5e1', '#cbd5e1', '#ef4444', '#14b8a6', '#cbd5e1'
                ];
            }
            fractalChart.update();
        };

        // Función para simular escenarios
        window.simulateScenario = function (type) {
            const feedback = document.getElementById('scenario-feedback');

            if (type === 'respect') {
                scenarioChart.data.datasets[0].borderColor = '#14b8a6';
                scenarioChart.data.datasets[0].data = [100, 105, 100, 102, 90];
                feedback.innerHTML = "<strong class='text-green-400'>¡RESPETO!</strong> El precio tocó el BB y rechazó con fuerza. La narrativa bajista continúa.";
            } else {
                scenarioChart.data.datasets[0].borderColor = '#ef4444';
                scenarioChart.data.datasets[0].data = [100, 105, 100, 108, 115];
                feedback.innerHTML = "<strong class='text-red-400'>¡FALLO!</strong> El precio atravesó el bloque sin detenerse. <strong>Señal:</strong> Posible inversión a tendencia alcista.";
            }
            scenarioChart.update();
        };

        // Función para cambiar pestañas de riesgo
        window.switchRiskTab = function (t) {
            const cC = document.getElementById('content-conservative'), cA = document.getElementById('content-aggressive');
            const tC = document.getElementById('tab-conservative'), tA = document.getElementById('tab-aggressive');
            if (t === 'conservative') { cC.classList.remove('hidden'); cA.classList.add('hidden'); tC.classList.add('text-kawn-deep', 'border-kawn-base'); tA.classList.remove('text-kawn-deep', 'border-kawn-base'); }
            else { cC.classList.add('hidden'); cA.classList.remove('hidden'); tA.classList.add('text-kawn-deep', 'border-kawn-base'); tC.classList.remove('text-kawn-deep', 'border-kawn-base'); }
        };

        // Función de evaluación de Quiz estático
        const staticExpl = ["Un BB es un OB fallido que invierte su rol.", "La toma de liquidez activa stops para llenar órdenes institucionales.", "El stop conservador cubre todo el bloque para evitar mechazos."];
        window.checkAnswer = function (b, ok, idx) {
            document.getElementById('quiz-feedback').innerHTML = (ok ? "<strong class='text-green-600'>¡Correcto!</strong> " : "<strong class='text-red-500'>Incorrecto.</strong> ") + staticExpl[idx];
            document.getElementById('quiz-feedback').classList.remove('hidden');
        };

        // Función de evaluación de Quiz dinámico (IA)
        window.evalQuiz = function (btn, idx, ans, exp) {
            const isCorr = idx === ans;
            const fb = document.getElementById('ai-fb');
            fb.classList.remove('hidden');
            fb.innerHTML = (isCorr ? "<strong class='text-green-400'>¡Correcto!</strong> " : "<strong class='text-red-400'>Incorrecto.</strong> ") + exp;
            btn.classList.add(isCorr ? 'bg-green-900' : 'bg-red-900');
        };

        // --- 3. FUNCIONES INTERNAS (GRÁFICOS E INICIALIZACIÓN) ---

        function initFractalChart() {
            const ctx = document.getElementById('fractalChart').getContext('2d');
            if (fractalChart) fractalChart.destroy();

            fractalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['H4 Candle (BB)'],
                    datasets: [{
                        label: 'Rango de Precio',
                        data: [[100, 110]],
                        backgroundColor: 'rgba(20, 184, 166, 0.5)',
                        borderColor: '#14b8a6',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { min: 95, max: 115 } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function initScenarioChart() {
            const ctx = document.getElementById('scenarioChart').getContext('2d');
            if (scenarioChart) scenarioChart.destroy();

            scenarioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['T1', 'T2', 'T3', 'T4', 'T5'],
                    datasets: [{
                        label: 'Precio',
                        data: [100, 102, 104, 103, 103],
                        borderColor: '#94a3b8',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { display: false } }
                }
            });
        }

        function initPhaseChart() {
            const ctx = document.getElementById('phaseChart').getContext('2d');
            if (phaseChart) phaseChart.destroy();
            phaseChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7'],
                    datasets: [{ label: 'Precio', data: [100, 105, 105, 105, 105, 105, 105], borderColor: '#94a3b8' }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } }
            });
            setPhase(1);
        }

        function drawPlotly(limit) {
            if (typeof Plotly === 'undefined') return;
            const plotDiv = document.getElementById('plotly-chart');
            if (!plotDiv) return;

            const sub = candleData.slice(0, limit + 1);
            const trace = { x: sub.map((_, i) => i + 1), open: sub.map(d => d.open), high: sub.map(d => d.high), low: sub.map(d => d.low), close: sub.map(d => d.close), type: 'candlestick', increasing: { line: { color: '#14b8a6' } }, decreasing: { line: { color: '#ef4444' } } };
            const shapes = limit >= 2 ? [{ type: 'rect', x0: 2.5, x1: limit + 1.5, y0: 101, y1: 102, fillcolor: 'rgba(20,184,166,0.2)', line: { width: 0 } }] : [];

            const layout = {
                xaxis: {
                    visible: false,
                    rangeslider: { visible: false },
                    type: 'category'
                },
                yaxis: { gridcolor: '#334155' },
                paper_bgcolor: '#0f172a',
                plot_bgcolor: '#0f172a',
                font: {
                    family: 'Inter, sans-serif',
                    color: '#94a3b8',
                    size: 12
                },
                margin: { l: 40, r: 20, t: 20, b: 20 },
                shapes: shapes,
                dragmode: false
            };

            try {
                Plotly.newPlot(plotDiv, [trace], layout, { displayModeBar: false, responsive: true });
            } catch (e) {
                console.error("Plotly error:", e);
            }
        }

        // --- 4. INTEGRACIÓN IA ---
        const proxyUrl = "/.netlify/functions/gemini-proxy";
        async function callGemini(prompt, sys = "Eres un mentor experto en SMC Trading.") {
            try {
                const response = await fetch(proxyUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: sys }] }
                    })
                });

                if (!response.ok) throw new Error(`Proxy Error: ${response.status}`);

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || data.result || null;
            } catch (e) {
                console.warn("Gemini Error:", e);
                return null;
            }
        }

        // --- 5. EVENT LISTENERS AL CARGAR ---
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar Gráficos
            try {
                if (typeof Chart !== 'undefined') {
                    initPhaseChart();
                    initFractalChart();
                    initScenarioChart();
                }
                if (typeof Plotly !== 'undefined') {
                    drawPlotly(0);
                }
            } catch (e) { console.error("Error inicializando gráficos:", e); }

            // Listeners Simulador
            document.getElementById('sim-next').addEventListener('click', () => { if (step < candleData.length - 1) { step++; drawPlotly(step); } });
            document.getElementById('sim-reset').addEventListener('click', () => { step = 0; drawPlotly(0); });

            // Listener Resize
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (typeof Plotly !== 'undefined') Plotly.Plots.resize(document.getElementById('plotly-chart'));
                }, 100);
            });

            // Generador TOC
            document.querySelectorAll('main h2').forEach((h, i) => {
                const id = 's-' + i; h.id = id;
                document.getElementById('toc-container').innerHTML += `<a href="#${id}" class="toc-link block py-2 px-3 text-slate-500 hover:bg-slate-50 rounded">${h.innerText}</a>`;
            });

            // UI Menú Móvil
            const menuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.className = sidebar.classList.contains('hidden') ? "hidden md:block w-64 flex-shrink-0" : "fixed inset-0 bg-white z-40 p-6 overflow-y-auto w-full h-full";
            });
            document.querySelectorAll('#toc-container a').forEach(l => l.addEventListener('click', () => { if (window.innerWidth < 768) sidebar.classList.add('hidden'); }));

            // Listeners IA
            const chatHistory = document.getElementById('chat-history');
            const userInput = document.getElementById('user-input');
            const aiTyping = document.getElementById('ai-typing');

            async function sendMessage() {
                const t = userInput.value.trim();
                if (!t) return;
                chatHistory.innerHTML += `<div class="user-message chat-message">${t}</div>`;
                userInput.value = ''; chatHistory.scrollTop = chatHistory.scrollHeight; aiTyping.classList.remove('hidden');

                const reply = await callGemini(`Pregunta sobre Breaker Blocks: "${t}". Responde brevemente.`, "Mentor experto SMC.");
                aiTyping.classList.add('hidden');

                const txt = reply ? (typeof marked !== 'undefined' ? marked.parse(reply) : reply) : "<strong>[Modo Demo]</strong> El servidor no responde. En producción, te explicaría el concepto.";
                chatHistory.innerHTML += `<div class="ai-message chat-message">${txt}</div>`;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }

            document.getElementById('ai-toggle').onclick = () => document.getElementById('ai-modal').classList.remove('hidden');
            document.getElementById('close-ai').onclick = () => document.getElementById('ai-modal').classList.add('hidden');
            document.getElementById('send-ai').addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage() });

            document.getElementById('analyze-btn').addEventListener('click', async () => {
                const inp = document.getElementById('structure-input');
                const res = document.getElementById('analyze-result');
                if (!inp.value.trim()) return;
                res.classList.add('hidden');
                const reply = await callGemini(`Analiza setup: "${inp.value}". Breve.`, "Analista de riesgo.");
                res.classList.remove('hidden');
                res.innerHTML = reply ? (typeof marked !== 'undefined' ? marked.parse(reply) : reply) : "<strong>[Modo Demo]</strong> Parece una toma de liquidez clásica.";
            });

            document.getElementById('generate-quiz-btn').addEventListener('click', async () => {
                const cont = document.getElementById('dynamic-quiz-container');
                cont.innerHTML = '<span class="text-sm text-slate-400">Generando...</span>';
                const reply = await callGemini('Genera 1 pregunta JSON: {question, options[], answer(int), explanation}. Tema: Breaker Blocks.', "Formato JSON estricto.");
                let data = null;
                if (reply) {
                    try {
                        const cleanReply = reply.substring(reply.indexOf('{'), reply.lastIndexOf('}') + 1);
                        data = JSON.parse(cleanReply);
                    } catch (e) {
                        console.error("JSON Parse Error:", e);
                    }
                }

                if (!data) {
                    const demos = [
                        { question: "[Demo] ¿Qué invalida un BB?", options: ["Rebote 50%", "Romper el máximo", "Bajo volumen"], answer: 1, explanation: "Romper el máximo invalida la estructura." },
                        { question: "[Demo] ¿Dónde colocas el Stop Loss conservador?", options: ["En el 50%", "Por encima del bloque", "En la mecha"], answer: 1, explanation: "El enfoque conservador cubre toda la zona." },
                        { question: "[Demo] ¿Qué fase precede al Breaker?", options: ["Consolidación", "Toma de Liquidez", "Expansión"], answer: 1, explanation: "El 'Stop Hunt' es clave para crear la trampa." }
                    ];
                    data = demos[Math.floor(Math.random() * demos.length)];
                }

                cont.innerHTML = `<p class="font-bold text-white mb-2">${data.question}</p><div class="space-y-2">${data.options.map((o, i) => `<button class="w-full p-2 text-sm border rounded text-slate-300 hover:bg-slate-700 text-left q-opt" onclick="evalQuiz(this,${i},${data.answer},'${data.explanation.replace(/'/g, "\\'")}')">${o}</button>`).join('')}</div><div id="ai-fb" class="hidden mt-2 text-xs p-2 bg-slate-800"></div>`;
            });
        });
    </script>
</body>

</html>