*** Begin Patch
*** Update File: netlify/functions/gemini-proxy.js
@@ if (event.httpMethod === 'POST') {
-        // Acepta `userPrompt` o usa `prompt` como alternativa
-        userPrompt = body.userPrompt || body.prompt || '';
-
-        // Acepta `userPrompt` o usa `prompt` como alternativa
-        userPrompt = body.userPrompt || body.prompt || '';
+        // Acepta `userPrompt` o usa `prompt` como alternativa
+        // Se asigna una única vez para evitar duplicados
+        userPrompt = body.userPrompt || body.prompt || '';
@@ try {
-        const resultBody = { text, data };
-        return {
-            statusCode: 200,
-            headers: { 'Access-Control-Allow-Origin': '*' },
-            body: JSON.stringify(resultBody)
-        };
+        // Combina el `text` extraído con el resto de la respuesta de Gemini al nivel superior.
+        // De este modo, las propiedades como `candidates` siguen accesibles directamente
+        // (por ejemplo `response.candidates`) y se mantiene compatibilidad con los clientes existentes.
+        const resultBody = { text, ...data };
+        return {
+            statusCode: 200,
+            headers: { 'Access-Control-Allow-Origin': '*' },
+            body: JSON.stringify(resultBody)
+        };
*** End Patch
