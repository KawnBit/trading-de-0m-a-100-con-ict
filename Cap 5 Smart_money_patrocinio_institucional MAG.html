<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KawnBit Magazine: Patrocinio Institucional (Edición Completa AI)</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Open+Sans:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdown parsing for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            /* Paleta de colores KawnBit */
            --primary-teal: #4db6ac;
            --secondary-teal: #00897b;
            --dark-teal: #005b4f;
            --accent-dark: #263238;
            --text-grey: #546e7a;
            --light-bg: #e0f2f1;
            --white: #ffffff;
            --gradient-teal: linear-gradient(135deg, var(--primary-teal), var(--secondary-teal));
            --shadow-soft: 0 10px 30px rgba(0, 91, 79, 0.08);
            --shadow-hover: 0 15px 40px rgba(0, 91, 79, 0.15);
            --error-color: #ef5350;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            color: var(--text-grey);
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            line-height: 1.8;
            scroll-behavior: smooth;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Montserrat', sans-serif;
            color: var(--accent-dark);
            font-weight: 700;
        }

        h1 {
            font-size: 2.5rem;
            background: var(--gradient-teal);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: -1px;
            margin-bottom: 1em;
            text-align: center;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--dark-teal);
            border-left: 5px solid var(--primary-teal);
            padding-left: 20px;
            margin-top: 60px;
            margin-bottom: 25px;
        }

        h3 {
            font-size: 1.4rem;
            color: var(--secondary-teal);
            margin-top: 35px;
        }

        strong {
            color: var(--secondary-teal);
            font-weight: 700;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background-color: var(--white);
            padding: 60px;
            box-shadow: var(--shadow-soft);
            border-radius: 16px;
            overflow: hidden;
        }

        /* Header */
        .magazine-header {
            text-align: center;
            padding-bottom: 40px;
            border-bottom: 1px solid #d0e0e0;
            margin-bottom: 50px;
            position: relative;
        }

        .logo-placeholder {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 4rem;
            background: var(--gradient-teal);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            line-height: 1;
            letter-spacing: -2px;
        }

        .logo-tagline {
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: var(--secondary-teal);
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
            opacity: 0.8;
        }

        .intro-lead {
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--accent-dark);
            font-style: italic;
            border-left: 4px solid var(--primary-teal);
            padding: 25px 30px;
            margin: 40px 0;
            background: linear-gradient(to right, #f9fcfc, #fff);
            border-radius: 0 12px 12px 0;
            position: relative;
        }

        .intro-lead::before {
            content: '"';
            font-family: serif;
            font-size: 4rem;
            color: var(--primary-teal);
            opacity: 0.2;
            position: absolute;
            top: -10px;
            left: 10px;
        }

        /* --- COMPONENTES INTERACTIVOS --- */

        .infographic-box {
            background: var(--white);
            border-radius: 16px;
            padding: 40px;
            margin: 50px 0;
            border: 1px solid rgba(77, 182, 172, 0.2);
            box-shadow: var(--shadow-soft);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .infographic-box:hover {
            box-shadow: var(--shadow-hover);
        }

        .infographic-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--white);
            background: var(--secondary-teal);
            padding: 10px 25px;
            border-radius: 50px;
            position: absolute;
            top: -20px;
            left: 30px;
            box-shadow: 0 5px 15px rgba(0, 137, 123, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Gráfico 1: Analogía Slider */
        .analogy-container {
            position: relative;
            height: 300px;
            background: #f0f4f4;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            display: flex;
        }

        .analogy-side {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.5s ease;
            cursor: pointer;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .analogy-side:hover {
            background: rgba(77, 182, 172, 0.1);
        }

        .analogy-side.active {
            background: var(--white);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            z-index: 10;
            transform: scale(1.05);
            border: 2px solid var(--primary-teal);
        }

        .analogy-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .analogy-side:hover .analogy-icon {
            transform: scale(1.1) rotate(5deg);
        }

        /* Gráfico 2: Tráfico Animado */
        .traffic-simulation {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .traffic-panel {
            background: #f9fbfb;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid #eee;
        }

        .traffic-viz {
            height: 150px;
            position: relative;
            border-bottom: 2px solid #ddd;
            margin: 20px 0;
            overflow: hidden;
        }

        .car-bar {
            width: 20px;
            position: absolute;
            bottom: 0;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }

        /* Animación para tráfico retail */
        .retail-car {
            background-color: #b0bec5;
            animation: slowMove 2s infinite alternate ease-in-out;
        }

        @keyframes slowMove {
            0% {
                height: 20px;
            }

            100% {
                height: 40px;
            }
        }

        /* Animación para Institucional */
        .inst-car {
            background: var(--gradient-teal);
            animation: fastMove 1.5s infinite cubic-bezier(0.1, 0.7, 1.0, 0.1);
        }

        @keyframes fastMove {
            0% {
                height: 20px;
                opacity: 0.5;
            }

            50% {
                height: 120px;
                opacity: 1;
            }

            100% {
                height: 130px;
                opacity: 0.8;
            }
        }

        /* Gráfico 3: Tactics Tabs */
        .tactics-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: transparent;
            border: 2px solid var(--primary-teal);
            color: var(--dark-teal);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active,
        .tab-btn:hover {
            background: var(--primary-teal);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        .svg-chart-container {
            background: #fff;
            border: 1px dashed #b2dfdb;
            border-radius: 8px;
            padding: 20px;
            height: 250px;
            position: relative;
        }

        /* Animación SVG Stop Hunt */
        .path-line {
            fill: none;
            stroke: var(--accent-dark);
            stroke-width: 3;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 4s infinite linear;
        }

        @keyframes drawLine {
            0% {
                stroke-dashoffset: 1000;
            }

            40% {
                stroke-dashoffset: 600;
            }

            /* Baja a stops */
            50% {
                stroke-dashoffset: 500;
            }

            /* Pausa breve */
            100% {
                stroke-dashoffset: 0;
            }

            /* Sube violento */
        }

        .stop-point {
            fill: #e57373;
            animation: pulsePoint 4s infinite;
            opacity: 0;
        }

        @keyframes pulsePoint {

            0%,
            40% {
                opacity: 0;
                transform: scale(0);
            }

            45% {
                opacity: 1;
                transform: scale(1.5);
            }

            50% {
                opacity: 0;
                transform: scale(0);
            }

            100% {
                opacity: 0;
            }
        }

        /* Gráfico 4: Flip Cards */
        .flip-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .flip-card {
            background-color: transparent;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .flip-card-front {
            background-color: var(--white);
            color: var(--dark-teal);
            border: 2px solid var(--light-bg);
        }

        .flip-card-back {
            background: var(--gradient-teal);
            color: white;
            transform: rotateY(180deg);
        }

        /* Gráfico 5: Secuencia Maestra Stepper */
        .stepper-container {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 40px;
        }

        .stepper-container::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            z-index: 0;
        }

        .step-node {
            width: 50px;
            height: 50px;
            background: white;
            border: 4px solid #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
            cursor: pointer;
            transition: all 0.3s;
        }

        .step-node.active {
            border-color: var(--secondary-teal);
            background: var(--secondary-teal);
            color: white;
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--primary-teal);
        }

        .step-display {
            background: #f4fafa;
            padding: 30px;
            border-radius: 12px;
            border-left: 5px solid var(--secondary-teal);
            min-height: 150px;
            transition: all 0.3s;
        }

        /* --- NUEVOS ELEMENTOS PARA CONTENIDO AÑADIDO --- */

        /* Multi-timeframe Exercise */
        .mtf-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .mtf-card {
            background: white;
            border: 1px solid #b2dfdb;
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            transition: all 0.3s;
            cursor: pointer;
        }

        .mtf-card:hover,
        .mtf-card.active {
            background: var(--light-bg);
            border-color: var(--secondary-teal);
            transform: translateY(-3px);
        }

        .mtf-question {
            font-weight: bold;
            color: var(--dark-teal);
            margin-bottom: 10px;
            display: block;
        }

        .mtf-detail {
            font-size: 0.9rem;
            display: none;
            color: var(--text-grey);
            border-top: 1px solid #d0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .mtf-card.active .mtf-detail {
            display: block;
        }

        /* Context Radar (Visual) */
        .context-visual {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .context-pill {
            background: white;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: help;
            transition: all 0.2s;
        }

        .context-pill:hover {
            background: var(--secondary-teal);
            color: white;
            border-color: var(--secondary-teal);
        }

        /* Timeline Roadmap */
        .roadmap-container {
            position: relative;
            padding-left: 30px;
            margin-top: 30px;
        }

        .roadmap-container::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--gradient-teal);
            border-radius: 2px;
        }

        .roadmap-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 15px solid transparent;
            /* Spacer */
        }

        .roadmap-item::before {
            content: '';
            position: absolute;
            left: -38px;
            top: 20px;
            width: 20px;
            height: 20px;
            background: var(--white);
            border: 4px solid var(--secondary-teal);
            border-radius: 50%;
            z-index: 2;
        }

        .roadmap-time {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--secondary-teal);
            font-weight: 700;
            margin-bottom: 5px;
        }

        /* Gráfico 6: Integration Grid */
        .integration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .integration-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            border-top: 3px solid transparent;
        }

        .integration-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .integration-card.fvg {
            border-color: #e57373;
        }

        .integration-card.ob {
            border-color: #64b5f6;
        }

        .integration-card.liq {
            border-color: #ffd54f;
        }

        .integration-card.kz {
            border-color: #ba68c8;
        }

        /* Kill Zone Time Bar */
        .time-bar-container {
            margin-top: 15px;
            background: #f0f0f0;
            height: 20px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .time-zone {
            position: absolute;
            height: 100%;
            top: 0;
            color: white;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .london {
            background: #ba68c8;
            width: 40%;
            left: 20%;
        }

        /* Ilustrativo */
        .ny {
            background: #7e57c2;
            width: 40%;
            left: 50%;
            opacity: 0.8;
        }

        /* Gráfico 7: Casos de Estudio (Acordeón) */
        .accordion-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            background: white;
        }

        .accordion-header {
            background: #f9fbfb;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            color: var(--dark-teal);
            transition: background 0.2s;
        }

        .accordion-header:hover {
            background: #e0f2f1;
        }

        .accordion-body {
            padding: 0 25px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s;
            background: white;
        }

        .accordion-body.open {
            padding: 25px;
            max-height: 500px;
            /* Altura máxima arbitraria para animación */
        }

        .chevron {
            transition: transform 0.3s;
        }

        .accordion-header.active .chevron {
            transform: rotate(180deg);
        }

        /* Journal Template */
        .journal-template {
            background: #fff8e1;
            padding: 20px;
            border-left: 4px solid #ffc107;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
        }

        /* --- ESTILOS AI ASSISTANT --- */
        .ai-section {
            background: linear-gradient(135deg, #e0f7fa, #fff);
            border: 2px solid var(--primary-teal);
            border-radius: 16px;
            padding: 30px;
            margin-top: 60px;
            position: relative;
            overflow: hidden;
        }

        .ai-section::before {
            content: '✨';
            font-size: 10rem;
            position: absolute;
            top: -50px;
            right: -20px;
            opacity: 0.1;
        }

        .ai-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .ai-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            color: var(--dark-teal);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-container {
            background: white;
            border: 1px solid #b2dfdb;
            border-radius: 12px;
            height: 350px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            position: relative;
        }

        .message.bot {
            align-self: flex-start;
            background: #f0f4f4;
            color: var(--accent-dark);
            border-bottom-left-radius: 2px;
        }

        .message.bot.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .message.user {
            align-self: flex-end;
            background: var(--secondary-teal);
            color: white;
            border-bottom-right-radius: 2px;
        }

        .message strong {
            color: inherit;
            font-weight: 700;
        }

        .message ul {
            margin: 5px 0 0 20px;
            padding: 0;
        }

        .chat-input-area {
            padding: 15px;
            background: #f9fbfb;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #d0e0e0;
            border-radius: 8px;
            font-family: inherit;
            outline: none;
            transition: border 0.3s;
        }

        .chat-input:focus {
            border-color: var(--primary-teal);
        }

        .send-btn {
            background: var(--secondary-teal);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .send-btn:hover {
            background: var(--dark-teal);
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .ai-tools {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .ai-tool-btn {
            background: white;
            border: 1px solid var(--primary-teal);
            color: var(--secondary-teal);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-tool-btn:hover {
            background: var(--light-bg);
            transform: translateY(-2px);
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                color: rgba(0, 0, 0, 0);
                text-shadow: .25em 0 0 rgba(0, 0, 0, 0), .5em 0 0 rgba(0, 0, 0, 0);
            }

            40% {
                color: inherit;
                text-shadow: .25em 0 0 rgba(0, 0, 0, 0), .5em 0 0 rgba(0, 0, 0, 0);
            }

            60% {
                text-shadow: .25em 0 0 inherit, .5em 0 0 rgba(0, 0, 0, 0);
            }

            80%,
            100% {
                text-shadow: .25em 0 0 inherit, .5em 0 0 inherit;
            }
        }

        /* --- Podcast Player Styles --- */
        .podcast-player {
            display: flex;
            align-items: center;
            background: var(--accent-dark);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .podcast-player:hover {
            transform: scale(1.02);
        }

        .play-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            color: var(--primary-teal);
        }

        .player-text {
            flex: 1;
        }

        .player-title {
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .player-subtitle {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .equalizer {
            display: flex;
            gap: 3px;
            height: 20px;
            align-items: flex-end;
        }

        .bar {
            width: 4px;
            background: var(--primary-teal);
            animation: equalize 1s infinite;
        }

        .bar:nth-child(2) {
            animation-delay: 0.2s;
        }

        .bar:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes equalize {

            0%,
            100% {
                height: 5px;
            }

            50% {
                height: 20px;
            }
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            color: var(--error-color);
            padding: 10px;
            background: #ffebee;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #ffcdd2;
            font-size: 0.9rem;
            text-align: center;
        }

        /* Footer */
        .main-footer {
            margin-top: 80px;
            padding: 50px 20px;
            border-top: 1px solid #d0e0e0;
            text-align: center;
            background-color: #f0f4f4;
            color: var(--text-grey);
        }

        .copyright {
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        /* Animaciones Globales */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 20px auto;
            }

            .logo-placeholder {
                font-size: 2.5rem;
            }

            .traffic-simulation {
                grid-template-columns: 1fr;
            }

            .analogy-container {
                flex-direction: column;
                height: auto;
            }

            .stepper-container {
                overflow-x: auto;
                padding-bottom: 20px;
            }

            .step-node {
                min-width: 50px;
            }

            .mtf-grid {
                grid-template-columns: 1fr;
            }

            .ai-tools {
                flex-direction: column;
            }

            .ai-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <header class="magazine-header">
            <div class="logo-placeholder">KawnBit</div>
            <div class="logo-tagline">Quantitative Trading Community</div>
        </header>

        <h1>Capítulo 5: Patrocinio institucional – Las huellas del dinero inteligente en los gráficos</h1>

        <!-- AI PODCAST PLAYER -->
        <div class="podcast-player" onclick="playPodcast()">
            <i id="play-btn-icon" class="fas fa-play-circle play-icon"></i>
            <div class="player-text">
                <div class="player-title">Modo Podcast AI</div>
                <div class="player-subtitle" id="podcast-status">Escuchar resumen del capítulo (Generado por Gemini)
                </div>
            </div>
            <div id="equalizer" class="equalizer hidden">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>

        <section>
            <h2>Introducción: Comprendiendo el lenguaje oculto del mercado</h2>
            <div class="intro-lead">
                <p>Imagina por un momento que estás caminando por un bosque nevado. Aunque no puedas ver al oso que pasó
                    hace unas horas, sus huellas en la nieve te cuentan toda la historia: hacia dónde iba, qué tan
                    rápido se movía, si estaba cazando o simplemente paseando.</p>
            </div>
            <p>El <strong>patrocinio institucional</strong> funciona de la misma manera en los mercados financieros. El
                dinero inteligente, aunque opera desde las sombras, deja rastros inconfundibles en los gráficos que –una
                vez que aprendes a identificarlos– te revelan sus verdaderas intenciones.</p>

            <!-- GRÁFICO 1: ANALOGÍA INTERACTIVA -->
            <div class="infographic-box">
                <div class="infographic-title"><i class="fas fa-paw"></i> Analogía Visual: El Rastro del "Oso"
                    Institucional</div>
                <p style="margin-bottom: 20px; font-size: 0.9rem; text-align: center; color: var(--secondary-teal);">Haz
                    clic en cada lado para entender la conexión.</p>

                <div class="analogy-container">
                    <div class="analogy-side active" onclick="activateAnalogy(this, 'bear')">
                        <i class="fas fa-snowflake analogy-icon" style="color: #b0bec5;"></i>
                        <h4>El Bosque Nevado</h4>
                        <p style="font-size: 0.9rem; padding: 0 15px;">Huellas profundas y claras revelan el paso de una
                            bestia grande.</p>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; width: 50px; z-index: 5;">
                        <i class="fas fa-exchange-alt fa-2x" style="color: var(--secondary-teal); opacity: 0.5;"></i>
                    </div>
                    <div class="analogy-side" onclick="activateAnalogy(this, 'market')">
                        <i class="fas fa-chart-line analogy-icon" style="color: var(--secondary-teal);"></i>
                        <h4>El Gráfico Financiero</h4>
                        <p style="font-size: 0.9rem; padding: 0 15px;">Velas expansivas y desplazamientos violentos
                            revelan el "dinero inteligente".</p>
                    </div>
                </div>
                <div id="analogy-text"
                    style="text-align: center; margin-top: 20px; font-weight: bold; color: var(--dark-teal); min-height: 1.5em;">
                    La nieve es el gráfico. El oso es la institución.
                </div>
            </div>

            <p>El concepto de patrocinio institucional es uno de los pilares más poderosos dentro de la metodología ICT,
                porque nos permite identificar <strong>cuándo los grandes jugadores del mercado están respaldando
                    activamente una dirección específica</strong>. No hablamos de señales ambiguas o interpretaciones
                subjetivas; hablamos de evidencia clara y contundente de que el dinero profesional ha tomado una
                decisión y <strong>está comprometido con ella</strong>.</p>
        </section>

        <section>
            <h2>La naturaleza del patrocinio: por qué el dinero inteligente deja pistas</h2>
            <p>Antes de adentrarnos en las reglas específicas, es fundamental entender <strong>por qué el dinero
                    inteligente deja estas pistas</strong> en primer lugar. Las instituciones no pueden simplemente
                entrar al mercado con órdenes masivas de una sola vez, porque moverían el precio en su contra de manera
                dramática.</p>
            <p>En su lugar, <strong>necesitan construir sus posiciones gradualmente</strong>, y este proceso de
                acumulación o distribución es lo que genera los patrones que identificamos como patrocinio
                institucional. Piensa en ello como si intentaras comprar todas las manzanas de un mercado local. Si
                entras gritando que quieres comprar <strong>todas</strong> las manzanas disponibles, los vendedores
                inmediatamente subirán sus precios.</p>
            <p>En cambio, si compras gradualmente, mezclando tus compras con periodos en los que incluso vendes algunas
                manzanas para confundir a otros compradores, podrías acumular tu inventario a mejores precios. Esta
                analogía captura la esencia de cómo opera el dinero inteligente y por qué sus acciones generan
                <strong>patrones reconocibles</strong> en los gráficos.
            </p>
        </section>

        <section>
            <h2>Las reglas del patrocinio: un sistema multi-temporal</h2>
            <p>El patrocinio institucional no se detecta con una única señal, sino mediante un <strong>conjunto de
                    señales a través de varias temporalidades</strong>. Veamos cómo se manifiesta en distintos marcos de
                tiempo:</p>

            <h3>Temporalidades altas: el mapa general del dinero inteligente</h3>
            <p>En las temporalidades altas (diario, semanal, mensual), el patrocinio institucional se manifiesta
                principalmente a través de desplazamientos significativos en el precio. Pero ¿qué significa realmente un
                <strong>desplazamiento</strong> en este contexto? Un desplazamiento no es simplemente un movimiento
                fuerte del precio. Es un <strong>cambio en la velocidad y el carácter del movimiento</strong> que revela
                participación institucional activa.
            </p>

            <!-- GRÁFICO 2: ANIMACIÓN DE TRÁFICO -->
            <div class="infographic-box">
                <div class="infographic-title"><i class="fas fa-tachometer-alt"></i> Simulación: Detectando el
                    Desplazamiento</div>
                <p>Observa la diferencia en velocidad y determinación. El mercado minorista duda; la institución
                    acelera.</p>

                <div class="traffic-simulation">
                    <div class="traffic-panel">
                        <h4><i class="fas fa-car" style="color: #90a4ae;"></i> Tráfico Normal (Minorista)</h4>
                        <div class="traffic-viz">
                            <!-- Barras animadas simulando coches lentos -->
                            <div class="car-bar retail-car" style="left: 20%; animation-delay: 0s;"></div>
                            <div class="car-bar retail-car" style="left: 45%; animation-delay: 0.5s; height: 30px;">
                            </div>
                            <div class="car-bar retail-car" style="left: 70%; animation-delay: 1s; height: 25px;"></div>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--text-grey);">Velas pequeñas, superpuestas,
                            indecisión. Consolidación lenta.</p>
                    </div>

                    <div class="traffic-panel" style="background: #e0f2f1; border-color: var(--primary-teal);">
                        <h4><i class="fas fa-rocket" style="color: var(--secondary-teal);"></i> Desplazamiento
                            (Institucional)</h4>
                        <div class="traffic-viz">
                            <!-- Barras animadas simulando movimiento rápido -->
                            <div class="car-bar inst-car"
                                style="left: 30%; width: 40px; background: var(--secondary-teal);"></div>
                            <div class="car-bar inst-car"
                                style="left: 60%; width: 40px; background: var(--dark-teal); animation-delay: 0.2s;">
                            </div>
                        </div>
                        <p style="font-size: 0.85rem; color: var(--dark-teal); font-weight: bold;">¡Impulso Violento!
                            Velas de gran rango, cierres en extremos.</p>
                    </div>
                </div>
            </div>

            <p>En marcos de tiempo altos, existen dos tipos principales de desplazamiento que indican patrocinio
                institucional:</p>
            <ul>
                <li><strong>Desplazamiento de impulso:</strong> ocurre cuando el precio rompe violentamente una
                    estructura de precio previa, creando velas de gran rango con cierres fuertes cerca de sus extremos.
                    Por ejemplo, si en un gráfico diario vemos tres o cuatro velas consecutivas alcistas con cuerpos
                    grandes y mechas pequeñas, después de un período de consolidación, es una señal clara de que el
                    dinero inteligente está <strong>respaldando un movimiento alcista</strong>. Estas velas de impulso
                    muestran convicción: prácticamente no hay retrocesos y cada cierre está cerca del máximo de la
                    sesión.</li>
                <li><strong>Desplazamiento de retroceso a zona de interés:</strong> este es más sutil pero igualmente
                    poderoso. Después de un movimiento impulsivo al alza, el precio retrocede hacia una zona
                    significativa (por ejemplo, un antiguo nivel de resistencia que ahora <strong>debería</strong>
                    actuar como soporte). En lugar de perforar esta zona, vemos una <strong>reacción inmediata y
                        agresiva</strong>. Ese rechazo violento de un nivel clave es el dinero inteligente
                    <strong>defendiendo sus posiciones</strong> y añadiendo más volumen a su dirección preferida.
                </li>
            </ul>

            <h3>Temporalidades intermedias: el campo de batalla del patrocinio</h3>
            <p>En las temporalidades intermedias (gráficos de 4 horas, 1 hora), el juego se vuelve más táctico. Aquí es
                donde vemos la verdadera batalla entre el dinero inteligente y el dinero minorista en tiempo real. El
                patrocinio en estos marcos se caracteriza por dos comportamientos específicos:</p>

            <!-- GRÁFICO 3: TABS INTERACTIVOS CON ANIMACIÓN SVG -->
            <div class="infographic-box">
                <div class="infographic-title"><i class="fas fa-chess-board"></i> Tácticas en el Campo de Batalla</div>

                <div class="tactics-tabs">
                    <button class="tab-btn active" onclick="openTab('tab1')">Reacción enérgica</button>
                    <button class="tab-btn" onclick="openTab('tab2')">Liquidación de stops</button>
                </div>

                <div id="tab1" class="tab-content active">
                    <div style="text-align: center; padding: 20px;">
                        <h3><i class="fas fa-bolt" style="color: var(--secondary-teal);"></i> Salida Explosiva de
                            Descuento</h3>
                        <p>Cuando el precio toca zona de descuento, no se queda a "negociar". El dinero inteligente
                            compra agresivamente.</p>
                        <ul style="text-align: left; display: inline-block; margin-top: 15px;">
                            <li><i class="fas fa-check" style="color: var(--primary-teal);"></i> Sin consolidación en la
                                base.</li>
                            <li><i class="fas fa-check" style="color: var(--primary-teal);"></i> Patrones de vuelta en
                                "V".</li>
                            <li><i class="fas fa-check" style="color: var(--primary-teal);"></i> Volumen climático
                                instantáneo.</li>
                        </ul>
                    </div>
                </div>

                <div id="tab2" class="tab-content">
                    <div class="svg-chart-container">
                        <svg width="100%" height="100%" viewBox="0 0 400 200" preserveAspectRatio="none">
                            <!-- Fondo cuadriculado suave -->
                            <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f0f0f0" stroke-width="1" />
                            </pattern>
                            <rect width="100%" height="100%" fill="url(#grid)" />

                            <!-- Línea de soporte -->
                            <line x1="0" y1="150" x2="400" y2="150" stroke="#90a4ae" stroke-width="2"
                                stroke-dasharray="5,5" />
                            <text x="10" y="145" fill="#90a4ae" font-size="12">Stops Minoristas (Liquidez)</text>

                            <!-- Animación Precio -->
                            <path class="path-line" d="M 0,50 Q 100,80 150,140 L 180,170 L 200,100 L 250,50 L 400,20" />

                            <!-- Punto de stop hunt -->
                            <circle cx="180" cy="170" r="8" class="stop-point" />
                            <text x="195" y="180" fill="#e57373" font-size="14" font-weight="bold" opacity="0"
                                style="animation: fadeInOut 4s infinite;">¡LIQUIDEZ TOMADA!</text>
                        </svg>
                    </div>
                    <p style="text-align: center; font-size: 0.8rem; margin-top: 10px; color: #777;">Simulación: El
                        precio perfora los stops y revierte inmediatamente.</p>
                </div>
            </div>

            <p><strong>Retroceso hacia descuento/premium con reacción enérgica:</strong> Cuando el precio está en una
                tendencia alcista establecida y retrocede hacia la zona de <strong>descuento</strong> (por debajo del
                50% del último movimiento impulsivo), observamos cuidadosamente la reacción. Si el dinero inteligente
                está patrocinando el movimiento alcista, veremos que el precio <strong>no permanece mucho
                    tiempo</strong> en la zona, la salida es <strong>explosiva</strong>, y el volumen <strong>aumenta
                    significativamente</strong>. Están usando esos retrocesos para <strong>añadir a sus posiciones
                    largas</strong>.</p>
            <p><strong>Liquidación de stops seguida de reversión violenta:</strong> Esta es quizás la señal más clara.
                El precio perfora brevemente un nivel obvio donde están los <strong>stops</strong> del dinero minorista.
                <strong>Inmediatamente después</strong>, vemos una reversión agresiva en la dirección principal. El
                dinero inteligente necesita esa liquidez para ejecutar sus grandes órdenes. La velocidad de la reversión
                confirma el patrocinio: las ventas de pánico fueron absorbidas instantáneamente por órdenes
                institucionales de compra.
            </p>

            <h3>Temporalidades bajas: la ejecución precisa del plan institucional</h3>
            <p>En las temporalidades bajas (15 minutos, 5 minutos, 1 minuto), el patrocinio institucional se vuelve
                <strong>quirúrgicamente preciso</strong>. Aquí vemos la ejecución táctica momento a momento. La
                característica principal es que <strong>las zonas de liquidez se convierten en objetivos
                    magnéticos</strong>.
            </p>
            <p>Cuando el dinero inteligente patrocina una dirección, el precio se mueve sistemáticamente de una
                <strong>zona de liquidez</strong> a la siguiente, como un cazador metódico. Por ejemplo, en un gráfico
                de 5 minutos con patrocinio alcista, el precio toma los <strong>mínimos recientes</strong> (barriendo
                liquidez de vendedores intradía) y cada toma es seguida de una <strong>expansión alcista
                    inmediata</strong>. Los retrocesos son <strong>superficiales y breves</strong>, y los máximos
                previos son superados con <strong>facilidad y velocidad</strong>.
            </p>
        </section>

        <section>
            <h2>La confirmación: protegiendo la inversión institucional</h2>
            <p>Uno de los aspectos más fascinantes es cómo el dinero inteligente <strong>protege sus posiciones una vez
                    que las ha establecido</strong>. Cuando una institución acumula una posición grande, hará lo posible
                por evitar que el mercado vaya en contra de ella más allá de cierto punto.</p>

            <!-- GRÁFICO 4: FLIP CARDS 3D -->
            <div class="flip-grid">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i class="fas fa-shield-alt fa-4x"
                                style="color: var(--secondary-teal); margin-bottom: 20px;"></i>
                            <h3>Patrón de Rechazo Múltiple</h3>
                            <p style="font-size: 0.8rem; color: #888;">(Pasa el cursor para ver detalles)</p>
                        </div>
                        <div class="flip-card-back">
                            <p>El precio prueba un nivel clave varias veces, pero cada rebote es más fuerte. Mechas
                                largas repetidas indican compras defendiendo el nivel.</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <i class="fas fa-compress-arrows-alt fa-4x"
                                style="color: var(--dark-teal); margin-bottom: 20px;"></i>
                            <h3>Compresión de Volatilidad</h3>
                            <p style="font-size: 0.8rem; color: #888;">(Pasa el cursor para ver detalles)</p>
                        </div>
                        <div class="flip-card-back">
                            <p>El precio forma rangos cada vez más pequeños, como un resorte. Acumulación silenciosa
                                antes de liberar la energía de golpe.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>El proceso clásico del patrocinio: la secuencia maestra</h2>
            <p>Ahora que comprendemos los componentes, veamos cómo se combinan en el <strong>proceso clásico</strong> de
                patrocinio institucional. Esta secuencia de cuatro pasos es como una sinfonía en la que cada movimiento
                tiene su propósito.</p>

            <!-- GRÁFICO 5: STEPPER INTERACTIVO -->
            <div class="infographic-box">
                <div class="infographic-title"><i class="fas fa-layer-group"></i> La Secuencia Maestra (Haz clic en los
                    números)</div>

                <div class="stepper-container">
                    <div class="step-node active" onclick="setStep(1)">1</div>
                    <div class="step-node" onclick="setStep(2)">2</div>
                    <div class="step-node" onclick="setStep(3)">3</div>
                    <div class="step-node" onclick="setStep(4)">4</div>
                </div>

                <div id="step-display-content" class="step-display">
                    <!-- El contenido se llena con JS -->
                    <h4 style="color: var(--secondary-teal);">1. Toma de Liquidez (El Engaño)</h4>
                    <p>Un último descenso brusco toma un mínimo importante para activar stops y generar liquidez. Es
                        breve y engañoso.</p>
                    <i class="fas fa-hand-holding-usd fa-3x" style="color: #cfd8dc; float: right;"></i>
                </div>
            </div>

            <p>Al completar estos cuatro pasos, el mercado habrá dejado claras las <strong>huellas</strong> del dinero
                inteligente. Identificar correctamente esta secuencia en tiempo real es la clave para <strong>alinearte
                    con las instituciones</strong> en lugar de luchar contra ellas.</p>
        </section>

        <section>
            <h2>Identificando el patrocinio en tiempo real y errores comunes</h2>
            <p>La teoría sin práctica no te hará dominar este concepto. Se propone el "análisis multi-temporal
                sincronizado" (correlacionando Diario, 4H y 15M) y llevar un "Diario de patrocinio" para anotar y
                revisar tus observaciones.</p>

            <!-- NUEVO CONTENIDO INTERACTIVO: Ejercicios Prácticos detallados -->
            <div class="infographic-box" style="margin-top: 30px;">
                <div class="infographic-title"><i class="fas fa-dumbbell"></i> Ejercicio 1: Análisis Multi-temporal
                    Sincronizado</div>
                <p>Para no perderte en el ruido, debes responder preguntas específicas en cada temporalidad
                    simultáneamente. <strong>Haz clic en cada tarjeta para ver qué buscar:</strong></p>

                <div class="mtf-grid">
                    <div class="mtf-card" onclick="toggleMtf(this)">
                        <span class="mtf-question"><i class="far fa-calendar-alt"></i> Gráfico Diario</span>
                        <p style="margin: 0;">¿La intención general?</p>
                        <div class="mtf-detail">
                            ¿Dónde está la última zona de <strong>liquidez significativa</strong> que el precio aún no
                            ha tocado? (Ej. un máximo/mínimo pendiente de barrer).
                        </div>
                    </div>
                    <div class="mtf-card" onclick="toggleMtf(this)">
                        <span class="mtf-question"><i class="far fa-clock"></i> Gráfico 4 Horas</span>
                        <p style="margin: 0;">¿La preparación?</p>
                        <div class="mtf-detail">
                            ¿Ves señales de <strong>acumulación o compresión</strong> cerca de esa zona identificada en
                            diario? El precio suele ralentizarse al acercarse.
                        </div>
                    </div>
                    <div class="mtf-card" onclick="toggleMtf(this)">
                        <span class="mtf-question"><i class="fas fa-stopwatch"></i> Gráfico 15 Min</span>
                        <p style="margin: 0;">¿La chispa?</p>
                        <div class="mtf-detail">
                            ¿Detectas microestructuras de <strong>quiebre</strong> o barridas de pequeños rangos que
                            sugieran el inicio de la expansión?
                        </div>
                    </div>
                </div>
            </div>

            <h3>Ejercicio 2: El diario de patrocinio</h3>
            <p>Llevar un diario específico te ayudará a afinar tu habilidad. Anota cada posible señal, incluso si no
                operas. Después de 30 entradas, verás patrones claros. Aquí tienes una plantilla de lo que debes
                registrar:</p>

            <div class="journal-template">
                <strong>FECHA:</strong> [DD/MM/AA] <br>
                <strong>ACTIVO:</strong> EURUSD / SPX500 <br>
                <strong>SEÑAL:</strong> Rompimiento violento en 1H con 3 velas alcistas + Volumen alto.<br>
                <strong>CONTEXTO:</strong> Tras barrer mínimos semanales (Liquidez).<br>
                <strong>RESULTADO:</strong> [¿Continuó? ¿Falló?]<br>
                <strong>REFLEXIÓN:</strong> [¿Entré tarde? ¿Dudé?]
            </div>

            <h3 style="margin-top: 40px;">Errores comunes al intentar identificarlo:</h3>

            <!-- NUEVO: Visualización de Contexto para evitar errores -->
            <p>El error más grave es <strong>ignorar el contexto</strong>. El patrocinio no ocurre en el vacío. Antes de
                decidir, verifica estos 4 factores:</p>
            <div class="context-visual">
                <div class="context-pill" title="¿Tendencia definida o rango consolidativo?"><i
                        class="fas fa-chart-area"></i> Fase de Mercado</div>
                <div class="context-pill" title="¿Hay noticias de la FED o NFP cerca?"><i class="fas fa-newspaper"></i>
                    Eventos Económicos</div>
                <div class="context-pill" title="¿El DXY confirma el movimiento del EURUSD?"><i
                        class="fas fa-project-diagram"></i> Correlaciones</div>
                <div class="context-pill" title="¿Hay miedo o euforia extrema?"><i class="fas fa-theater-masks"></i>
                    Sentimiento</div>
            </div>

            <ul>
                <li><strong>Confundir volatilidad con patrocinio:</strong> Las noticias crean volatilidad, pero el
                    patrocinio real crea tendencias sostenibles, no solo movimientos de un día.</li>
                <li><strong>Forzar la identificación:</strong> A veces simplemente <strong>no hay</strong> patrocinio
                    claro. Forzar la lectura te llevará a ver fantasmas y sufrir pérdidas. La paciencia para no operar
                    es vital.</li>
            </ul>
        </section>

        <section>
            <h2>Integrando el patrocinio con otras herramientas de ICT</h2>
            <p>El patrocinio es más poderoso cuando se combina con otros conceptos de ICT:</p>

            <!-- GRÁFICO 6: GRID INTERACTIVO MEJORADO CON TIME BAR -->
            <div class="integration-grid">
                <div class="integration-card fvg">
                    <i class="fas fa-gap fa-2x" style="color: #e57373; margin-bottom: 10px;"></i>
                    <h5>Fair Value Gaps (FVG)</h5>
                    <p style="font-size: 0.85rem;">Los FVG creados durante una expulsión violenta son zonas de entrada
                        muy confiables.</p>
                </div>
                <div class="integration-card ob">
                    <i class="fas fa-cube fa-2x" style="color: #64b5f6; margin-bottom: 10px;"></i>
                    <h5>Order Blocks</h5>
                    <p style="font-size: 0.85rem;">Un OB con patrocinio tiene mucha mayor probabilidad de reacción.</p>
                </div>
                <div class="integration-card liq">
                    <i class="fas fa-water fa-2x" style="color: #ffd54f; margin-bottom: 10px;"></i>
                    <h5>Liquidez</h5>
                    <p style="font-size: 0.85rem;">El patrocinio siempre se dirige hacia la liquidez (tus objetivos o
                        TP).</p>
                </div>
                <div class="integration-card kz">
                    <i class="far fa-clock fa-2x" style="color: #ba68c8; margin-bottom: 10px;"></i>
                    <h5>Kill Zones</h5>
                    <p style="font-size: 0.85rem;">Los patrones intradía suelen ocurrir en aperturas de Londres y NY.
                    </p>
                    <div class="time-bar-container">
                        <div class="time-zone london">LONDON</div>
                        <div class="time-zone ny">NY</div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Gestión de riesgo y psicología con patrocinio institucional</h2>
            <p>Identificar el patrocinio es solo la mitad; saber cómo gestionar tu riesgo y tus emociones es crucial.
            </p>

            <h3>Gestión de Riesgo Adaptada:</h3>
            <ul>
                <li><strong>Dimensionamiento escalonado:</strong> Divide tu entrada en tres partes. Entrada inicial en
                    el retroceso (Paso 3), entrada de confirmación al inicio de la expulsión (Paso 4), y entrada de
                    momentum cuando la expulsión está en marcha.</li>
                <li><strong>Stops dinámicos:</strong> Adapta tu stop según la fase. Debajo del order block durante el
                    retroceso, al 50% del bloque tras la confirmación, y usando trailing stops detrás de nuevas
                    estructuras durante la expulsión.</li>
                <li><strong>Toma de beneficios alineada con liquidez:</strong> Planea salidas en torno a zonas de
                    liquidez. TP1 (50%) en la primera zona significativa, TP2 (25%) en la siguiente, y deja un "runner"
                    (25%) con trailing stop para capturar movimientos extendidos.</li>
            </ul>

            <h3>Psicología del Trading:</h3>
            <p>Domina la <strong>paciencia</strong> para esperar la configuración clara; no aparecerá todos los días.
                Cultiva la <strong>convicción</strong> para mantener posiciones cuando el mercado está de tu lado,
                confiando en tu plan. Y gestiona la <strong>avaricia</strong> poniendo objetivos razonables y no
                esperando atrapar siempre el giro completo. Mantén una mentalidad de procesos, no de resultados
                inmediatos.</p>
        </section>

        <section>
            <h2>Casos de estudio: patrocinio en acción</h2>

            <!-- GRÁFICO 7: ACORDEÓN DE CASOS -->
            <div id="case-studies-container">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span><i class="fas fa-euro-sign" style="margin-right: 10px;"></i> Caso 1: El falso rompimiento
                            (EUR/USD)</span>
                        <i class="fas fa-chevron-down chevron"></i>
                    </div>
                    <div class="accordion-body">
                        <p>El precio oscila en rango (1.0800 - 1.0900). En sesión asiática, rompe el soporte de 1.0800
                            (toma de liquidez, Paso 1), induciendo ventas minoristas. Sin embargo, recupera rápidamente
                            el nivel y, en la apertura europea, muestra un cambio de estructura alcista en 15M (Paso 2).
                            Retrocede al order block de inicio en 1.0810 (Paso 3) y reacciona con volumen, iniciando una
                            expulsión violenta hasta 1.0950 (Paso 4). El dinero inteligente usó la ruptura inicial para
                            comprar barato.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span><i class="fas fa-chart-line" style="margin-right: 10px;"></i> Caso 2: Defensa
                            Institucional (S&P 500)</span>
                        <i class="fas fa-chevron-down chevron"></i>
                    </div>
                    <div class="accordion-body">
                        <p>En tendencia alcista, el índice retrocede a 4400 (confluencia de Fibonacci y order block).
                            Realiza tres pruebas al nivel: la primera con mecha larga de rechazo, la segunda con una
                            mecha menor, y la tercera ni siquiera llega al mínimo, formando un mínimo más alto con
                            rebote decidido y volumen creciente. Es evidente que el dinero inteligente está
                            <strong>defendiendo agresivamente</strong> su zona de acumulación, absorbiendo ventas antes
                            de retomar la tendencia.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- NUEVA SECCIÓN: REFINANDO TU HABILIDAD (ROADMAP) -->
        <section>
            <h2>Refinando tu habilidad: el camino hacia la maestría</h2>
            <p>Dominar el patrocinio institucional es un viaje, no un destino. Aquí tienes un plan de desarrollo
                progresivo para convertirte en un experto:</p>

            <div class="roadmap-container">
                <div class="roadmap-item">
                    <div class="roadmap-time">Mes 1-2: Observación Pura</div>
                    <strong>No operes todavía.</strong> Dedica estas semanas solo a observar y aprender. Identifica 3
                    ejemplos potenciales cada día y documenta cómo se desarrollan sin invertir capital.
                </div>
                <div class="roadmap-item">
                    <div class="roadmap-time">Mes 3-4: Operaciones en Demo</div>
                    Comienza a operar las señales en simulador. Enfócate en un solo activo. Mantén un diario detallado
                    para pulir errores sin perder dinero.
                </div>
                <div class="roadmap-item">
                    <div class="roadmap-time">Mes 5-6: Transición Real (25%)</div>
                    Opera en real pero con solo el 25% de tu tamaño normal. Toma solo las señales más claras (calidad
                    sobre cantidad).
                </div>
                <div class="roadmap-item" style="border-left-color: var(--primary-teal);">
                    <div class="roadmap-time">Mes 7+: Implementación Completa</div>
                    Aumenta gradualmente el tamaño de tus posiciones (50% -> 75% -> 100%). Expande a otros instrumentos
                    solo cuando domines el primero.
                </div>
            </div>
        </section>

        <!-- NUEVA SECCIÓN AI -->
        <section class="ai-section">
            <div class="ai-header">
                <div class="ai-title"><i class="fas fa-robot" style="color: var(--secondary-teal);"></i> Centro de
                    Aprendizaje KawnBit AI ✨</div>
                <button class="ai-tool-btn" style="background: var(--accent-dark); color: white; border:none;"
                    onclick="generateFlashcards()">
                    <i class="fas fa-bolt"></i> Generar Flashcards de Estudio
                </button>
            </div>

            <div id="flashcards-container" class="flip-grid hidden" style="margin-bottom: 30px;">
                <!-- Las flashcards generadas por AI aparecerán aquí -->
            </div>

            <p style="margin-bottom: 20px;">Tengo todo el contenido de este capítulo en mi memoria. Pregúntame sobre los
                conceptos o pídeme un reto.</p>

            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot">
                        Hola, soy tu mentor de trading institucional. ¿Tienes dudas sobre los 4 pasos del patrocinio o
                        quieres un quiz rápido?
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="user-input" class="chat-input"
                        placeholder="Ej: ¿Qué es la 'Expulsión Violenta'?" onkeypress="handleKeyPress(event)">
                    <button id="send-btn" class="send-btn" onclick="sendMessage()"><i
                            class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <div class="ai-tools">
                <button class="ai-tool-btn"
                    onclick="quickAsk('Explícame los 4 pasos del patrocinio de forma sencilla.')">
                    <i class="fas fa-layer-group"></i> Resumir los 4 Pasos
                </button>
                <button class="ai-tool-btn"
                    onclick="quickAsk('Genérame una pregunta tipo test difícil sobre este capítulo para ver si lo he entendido.')">
                    <i class="fas fa-question-circle"></i> Quiz Dinámico ✨
                </button>
                <button class="ai-tool-btn"
                    onclick="quickAsk('¿Cómo diferencio un Order Block normal de uno con Patrocinio Institucional?')">
                    <i class="fas fa-cube"></i> Order Block vs Patrocinio
                </button>
            </div>
        </section>

        <section>
            <h2>Conclusión: el patrocinio como ventaja competitiva</h2>
            <div class="intro-lead" style="background: var(--gradient-teal); color: var(--white); border: none;">
                <p>El patrocinio institucional es una ventana hacia la mente del dinero inteligente. Cuando puedes
                    identificarlo, dejas de ser una víctima y operas del mismo lado que los profesionales. Es como
                    unirte a la corriente del río en vez de luchar contra ella.</p>
            </div>
            <p>Recuerda que <strong>no es una señal que aparece todos los días</strong>. Quizás veas solo 3 a 5
                oportunidades claras al mes, pero esas pueden representar la mayor parte de tus ganancias. Tu ventaja
                competitiva radica en la <strong>paciencia</strong> para esperar esas jugadas maestras, la
                <strong>disciplina</strong> para seguir el proceso de cuatro pasos, y la <strong>confianza</strong> para
                mantener tus posiciones. El dinero inteligente siempre dejará sus huellas; tu trabajo es desarrollar los
                ojos para verlas.
            </p>
        </section>

        <footer class="main-footer">
            <div class="logo-placeholder" style="font-size: 2.5rem;">KawnBit</div>
            <p class="copyright">&copy; 2025 KawnBit Magazine. Todos los derechos reservados. Quantitative Trading
                Community.</p>
        </footer>

    </div>

    <script>
        // --- VARIABLES DE ENTORNO AI ---
        const apiKey = "";

        // Global State
        let audioContext;
        let isPlaying = false;
        let cachedPageContent = null; // CACHÉ DE CONTENIDO

        // 1. ANALOGÍA INTERACTIVA
        function activateAnalogy(element, type) {
            document.querySelectorAll('.analogy-side').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            const textElement = document.getElementById('analogy-text');
            if (type === 'bear') {
                textElement.textContent = "El oso deja huellas profundas en la nieve.";
                textElement.style.color = "#546e7a";
            } else {
                textElement.textContent = "El dinero inteligente deja velas enormes en el gráfico.";
                textElement.style.color = "#00897b";
            }
        }

        // 2. TABS TÁCTICAS
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            const buttons = document.querySelectorAll('.tab-btn');
            if (tabId === 'tab1') buttons[0].classList.add('active');
            if (tabId === 'tab2') buttons[1].classList.add('active');
        }

        // 3. STEPPER
        const stepData = [
            {
                title: "1. Toma de Liquidez (El Engaño)",
                desc: "Un último descenso brusco toma un mínimo importante para activar stops y generar liquidez. Es breve y engañoso.",
                icon: "fa-hand-holding-usd",
                color: "#4db6ac"
            },
            {
                title: "2. Cambio de Estructura (La Revelación)",
                desc: "El precio rompe la secuencia bajista con violencia, velocidad y volumen confirmatorio. Muestra momentum sostenido.",
                icon: "fa-chart-line",
                color: "#00897b"
            },
            {
                title: "3. Vuelta al Order Block (La Prueba)",
                desc: "Retroceso controlado al origen del movimiento (Order Block). No debe penetrar profundo ni permanecer mucho tiempo.",
                icon: "fa-history",
                color: "#005b4f"
            },
            {
                title: "4. Expulsión Violenta (El Movimiento)",
                desc: "Confirmación definitiva. Aceleración progresiva, velas grandes, sin retrocesos significativos y creando nuevas estructuras.",
                icon: "fa-rocket",
                color: "#263238"
            }
        ];

        function setStep(stepIndex) {
            document.querySelectorAll('.step-node').forEach((node, index) => {
                if (index + 1 === stepIndex) {
                    node.classList.add('active');
                } else {
                    node.classList.remove('active');
                }
            });

            const data = stepData[stepIndex - 1];
            const display = document.getElementById('step-display-content');

            display.style.opacity = 0;
            setTimeout(() => {
                display.innerHTML = `
                <h4 style="color: ${data.color}; margin-top:0;">${data.title}</h4>
                <p>${data.desc}</p>
                <i class="fas ${data.icon} fa-3x" style="color: ${data.color}; float: right; opacity: 0.2;"></i>
            `;
                display.style.opacity = 1;
            }, 300);
        }

        // 4. ACORDEÓN
        function toggleAccordion(header) {
            header.classList.toggle('active');
            const body = header.nextElementSibling;
            if (header.classList.contains('active')) {
                body.classList.add('open');
            } else {
                body.classList.remove('open');
            }
        }

        // 5. MULTI-TIMEFRAME TOGGLE
        function toggleMtf(card) {
            if (card.classList.contains('active')) {
                card.classList.remove('active');
            } else {
                document.querySelectorAll('.mtf-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
            }
        }

        // --- UTILS FOR AI ROBUSTNESS ---

        // 1. Limpieza de respuestas AI (Markdown JSON fix)
        function cleanAIResponse(text) {
            if (!text) return "";
            // Eliminar bloques de código markdown si la IA los incluye
            return text.replace(/```json\n?|```/g, '').trim();
        }

        // 2. Caché de contenido (Performance)
        function getPageContent() {
            if (cachedPageContent) return cachedPageContent;

            const title = document.querySelector('h1').innerText;
            let content = "";
            document.querySelectorAll('section h2, section h3, section p, section li').forEach(el => {
                content += el.innerText + "\n";
            });
            cachedPageContent = `Título: ${title}\n\nContenido:\n${content}`;
            return cachedPageContent;
        }

        // --- AI CHAT LOGIC ---

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text) return;

            // Validar API Key antes de enviar
            if (!apiKey) {
                addMessage("Error de Configuración: Falta la API Key de Gemini.", 'bot error');
                return;
            }

            addMessage(text, 'user');
            input.value = '';
            toggleLoading(true);

            try {
                const response = await callGeminiAPI(text);
                toggleLoading(false);
                addMessage(response, 'bot');
            } catch (error) {
                console.error(error);
                toggleLoading(false);
                addMessage("Lo siento, hubo un error de conexión con el servidor de IA. Intenta de nuevo.", 'bot error');
            }
        }

        function quickAsk(question) {
            document.getElementById('user-input').value = question;
            sendMessage();
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function addMessage(text, sender) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;

            if (sender.includes('bot')) {
                div.innerHTML = marked.parse(text);
            } else {
                div.textContent = text;
            }

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function toggleLoading(show) {
            const container = document.getElementById('chat-messages');
            const existingLoader = document.getElementById('ai-loader');

            if (show) {
                const div = document.createElement('div');
                div.id = 'ai-loader';
                div.className = 'message bot';
                div.innerHTML = 'Pensando<span class="loading-dots"></span>';
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;
                document.getElementById('send-btn').disabled = true;
                document.getElementById('user-input').disabled = true;
            } else {
                if (existingLoader) existingLoader.remove();
                document.getElementById('send-btn').disabled = false;
                document.getElementById('user-input').disabled = false;
                document.getElementById('user-input').focus();
            }
        }

        const proxyUrl = "/.netlify/functions/gemini-proxy";

        async function callGeminiAPI(userQuery) {
            const context = getPageContent();
            const systemPrompt = `
        Eres "KawnBit AI", un mentor experto en trading institucional (Smart Money Concepts). 
        Tu objetivo es ayudar al usuario a entender el artículo que está leyendo.
        
        CONTEXTO DEL ARTÍCULO:
        ${context.substring(0, 20000)} (Truncado por seguridad)

        INSTRUCCIONES:
        1. Responde basándote EXCLUSIVAMENTE en la información del artículo proporcionado.
        2. Sé didáctico, amable y profesional.
        3. Si te piden un "Quiz", genera una pregunta de opción múltiple con la respuesta oculta o explicada después.
        4. Usa formato Markdown (negritas, listas) para estructurar tu respuesta.
        5. Sé conciso. Respuestas de máximo 3-4 párrafos.
        `;

            try {
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                if (!response.ok) throw new Error('Proxy Error');

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || data.result || "Error: La IA no devolvió respuesta.";
            } catch (error) {
                console.error("Gemini Proxy Error:", error);
                throw error;
            }
        }

        // --- TTS FUNCTIONALITY ---

        async function playPodcast() {
            if (isPlaying) return;

            const statusEl = document.getElementById('podcast-status');
            const equalizer = document.getElementById('equalizer');
            const icon = document.getElementById('play-btn-icon');

            statusEl.textContent = "Generando audio con Gemini...";
            icon.className = "fas fa-spinner fa-spin play-icon";

            try {
                const textToRead = "Bienvenido a KawnBit Magazine. Capítulo 5: Patrocinio Institucional. Imagina por un momento que estás caminando por un bosque nevado. Aunque no puedas ver al oso que pasó hace unas horas, sus huellas en la nieve te cuentan toda la historia. El dinero inteligente funciona igual.";

                const payload = {
                    contents: [{ parts: [{ text: textToRead }] }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } }
                        }
                    }
                };

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('TTS Proxy Error');

                const data = await response.json();
                const base64Audio = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;

                if (!base64Audio) throw new Error("No audio data returned from proxy");

                statusEl.textContent = "Reproduciendo...";
                equalizer.classList.remove('hidden');
                icon.className = "fas fa-volume-up play-icon";
                isPlaying = true;

                await playBase64Audio(base64Audio);

                statusEl.textContent = "Escuchar resumen del capítulo";
                equalizer.classList.add('hidden');
                icon.className = "fas fa-play-circle play-icon";
                isPlaying = false;

            } catch (error) {
                console.error(error);
                statusEl.textContent = "Error al generar audio (Proxy). Intenta de nuevo.";
                icon.className = "fas fa-exclamation-circle play-icon";
                isPlaying = false;
            }
        }

        async function playBase64Audio(base64String) {
            try {
                const binaryString = window.atob(base64String);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }

                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }

                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }

                const wavBytes = addWavHeader(bytes, 24000, 1);
                const audioBuffer = await audioContext.decodeAudioData(wavBytes.buffer);

                const source = audioContext.createBufferSource();
                source.buffer = audioBuffer;
                source.connect(audioContext.destination);
                source.start(0);

                return new Promise(resolve => {
                    source.onended = resolve;
                });
            } catch (e) {
                console.error("Audio playback error:", e);
                throw e;
            }
        }

        function addWavHeader(pcmData, sampleRate, numChannels) {
            const header = new ArrayBuffer(44);
            const view = new DataView(header);

            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.length, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numChannels * 2, true);
            view.setUint16(32, numChannels * 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.length, true);

            const wavFile = new Uint8Array(header.byteLength + pcmData.length);
            wavFile.set(new Uint8Array(header), 0);
            wavFile.set(pcmData, header.byteLength);

            return wavFile;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // --- FLASHCARD GENERATION ---
        async function generateFlashcards() {
            const container = document.getElementById('flashcards-container');
            container.classList.remove('hidden');

            container.innerHTML = '<div style="text-align:center; grid-column: 1/-1;">Generando tarjetas con IA... <span class="loading-dots"></span></div>';

            const context = getPageContent();

            const prompt = `
            Basándote en el siguiente texto sobre trading institucional, genera 3 flashcards de estudio.
            TEXTO: ${context.substring(0, 10000)}
            
            Formato de respuesta: Devuelve SOLAMENTE un array JSON válido sin bloques de código markdown.
            Estructura: [{"front": "Pregunta o Concepto", "back": "Explicación breve"}]
        `;

            try {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                };

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('Proxy Flashcards Error');

                const data = await response.json();
                let jsonText = data.candidates?.[0]?.content?.parts?.[0]?.text || data.result;

                if (!jsonText) throw new Error("No text returned for flashcards");

                jsonText = cleanAIResponse(jsonText);
                const cards = JSON.parse(jsonText);

                container.innerHTML = '';
                cards.forEach(card => {
                    const cardHtml = `
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front" style="background: #e0f7fa; border-color: var(--secondary-teal);">
                            <i class="fas fa-question-circle fa-3x" style="color: var(--secondary-teal); margin-bottom: 20px;"></i>
                            <h3 style="font-size: 1.1rem; padding: 0 10px;">${card.front}</h3>
                            <p style="font-size: 0.8rem; color: #888;">(Girar para ver respuesta)</p>
                        </div>
                        <div class="flip-card-back" style="background: var(--dark-teal);">
                            <p style="padding: 10px;">${card.back}</p>
                        </div>
                    </div>
                </div>
                `;
                    container.innerHTML += cardHtml;
                });

            } catch (e) {
                console.error(e);
                container.innerHTML = '<div class="error-message">Error generando tarjetas a través del Proxy. Intenta de nuevo.</div>';
            }
        }
    </script>

</body>

</html>