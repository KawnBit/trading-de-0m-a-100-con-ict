<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KawnBit Magazine | Cap 13: Modelo PO3 y Robustez Institucional</title>
    <meta name="description"
        content="Guía completa sobre el Modelo Power of Three (PO3), sesgo diario, Kill Zones y gestión de desviaciones según la metodología ICT.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@400;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marked.js (Markdown Parser) with error handling check in logic -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kawn: {
                            light: '#ccfbf1', // Teal 100
                            base: '#14b8a6',  // Teal 500
                            dark: '#0f766e',  // Teal 700
                            deep: '#134e4a',  // Teal 900
                            accent: '#0d9488' // Teal 600
                        },
                        slate: {
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'draw': 'drawStroke 2s ease-out forwards',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        drawStroke: {
                            '0%': { strokeDasharray: '1000', strokeDashoffset: '1000' },
                            '100%': { strokeDasharray: '1000', strokeDashoffset: '0' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #334155;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Montserrat', sans-serif;
        }

        p,
        li {
            font-family: 'Inter', sans-serif;
            line-height: 1.8;
            margin-bottom: 1em;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #134e4a 100%);
        }

        .visual-container {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin: 2rem 0;
            overflow: hidden;
        }

        .visual-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #0f766e;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .highlight-quote {
            border-left: 4px solid #14b8a6;
            background-color: #f0fdfa;
            padding: 1.5rem;
            font-style: italic;
            color: #134e4a;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 2rem 0;
        }

        /* Buttons & Interactives */
        .interactive-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .interactive-btn.active {
            background-color: #14b8a6;
            color: white;
            border-color: #14b8a6;
            box-shadow: 0 4px 6px -1px rgba(20, 184, 166, 0.3);
        }

        .interactive-btn:hover:not(.active) {
            background-color: #f1f5f9;
            transform: translateY(-1px);
        }

        /* AI Chat */
        .ai-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
        }

        .ai-message.user {
            background-color: #f1f5f9;
            color: #334155;
            border-bottom-right-radius: 0;
            margin-left: 2rem;
        }

        .ai-message.bot {
            background-color: #ccfbf1;
            color: #0f766e;
            border-bottom-left-radius: 0;
            margin-right: 2rem;
            border: 1px solid #99f6e4;
        }

        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #0f766e;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Quiz Styles */
        .quiz-option {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option.selected {
            background-color: #f0fdfa;
            border-color: #14b8a6;
            font-weight: 500;
        }

        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
        }

        .quiz-option.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #b91c1c;
        }

        /* Animation Classes */
        .path-draw {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease-out forwards;
        }

        @keyframes drawLine {
            to {
                stroke-dashoffset: 0;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .liquidity-icon {
            opacity: 0;
            transition: opacity 0.5s;
        }

        .liquidity-active .liquidity-icon {
            opacity: 1;
            animation: float 2s infinite;
        }

        .killzone-box {
            transition: all 0.3s;
            opacity: 0.3;
        }

        .killzone-active {
            opacity: 1;
            stroke-width: 2;
            filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.2));
        }

        /* Modal for API Key */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="text-slate-600 antialiased">

    <!-- API Key Modal -->
    <div id="api-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-slate-900 mb-4">Configuración de Gemini AI</h3>
            <p class="text-sm text-slate-500 mb-4">
                Para activar las funciones avanzadas de IA (Generación de Quiz y Chat Contextual) en este modo demo,
                ingresa tu API Key.
                <br><span class="text-xs text-red-400">* Tu clave se guarda solo en la memoria de tu navegador.</span>
            </p>
            <input type="password" id="api-key-input" class="w-full border border-slate-300 rounded p-2 mb-4"
                placeholder="Pegar Gemini API Key aquí...">
            <div class="flex justify-between">
                <button onclick="clearApiKey()"
                    class="px-4 py-2 text-red-500 hover:text-red-700 text-sm font-bold border border-red-200 rounded">Borrar
                    Key</button>
                <div class="flex gap-2">
                    <button onclick="closeModal()"
                        class="px-4 py-2 text-slate-500 hover:text-slate-700">Cancelar</button>
                    <button onclick="saveApiKey()"
                        class="px-4 py-2 bg-kawn-base text-white rounded hover:bg-kawn-dark">Guardar y Activar</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-slate-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center flex-shrink-0 mr-6">
                    <div
                        class="h-10 w-10 bg-gradient-to-br from-kawn-dark to-kawn-base rounded-lg shadow-sm flex items-center justify-center text-white font-bold text-xl font-display">
                        K</div>
                    <span class="ml-3 font-display font-bold text-slate-800 text-xl hidden md:block">KAWNBIT</span>
                </div>

                <div class="hidden md:flex space-x-6">
                    <a href="#intro"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wider">Intro
                        PO3</a>
                    <a href="#liquidity"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wider text-kawn-deep font-bold">Liquidez</a>
                    <a href="#scenarios"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wider">Escenarios</a>
                    <a href="#killzones"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wider text-kawn-deep font-bold">Kill
                        Zones</a>
                    <a href="#projections"
                        class="text-slate-500 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wider">Proyecciones</a>
                    <a href="#ai-lab"
                        class="text-kawn-base hover:text-kawn-dark font-bold transition-colors text-xs uppercase tracking-wider flex items-center bg-kawn-light/30 px-3 py-1 rounded-full"><i
                            data-lucide="sparkles" class="w-3 h-3 mr-1"></i> AI Lab</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero-gradient relative text-white py-24 overflow-hidden" id="top">
        <div
            class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1642790106117-e829e14a795f?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center opacity-10 mix-blend-overlay">
        </div>
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center">
            <span
                class="inline-block py-1 px-3 rounded-full bg-kawn-light/20 text-kawn-light text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur-sm">Metodología
                ICT: Inner Circle Trader</span>
            <h1 class="text-4xl md:text-5xl font-black tracking-tight leading-tight mb-6">
                Capítulo 13: Modelo <span class="text-kawn-light">PO3</span> y Precisión Institucional
            </h1>
            <p class="text-lg text-slate-200 font-light max-w-3xl mx-auto leading-relaxed">
                Descubre cómo el "Smart Money" acumula, manipula y distribuye. Una guía profunda que incluye
                <strong>Kill Zones</strong>, <strong>Piscinas de Liquidez</strong> y <strong>Proyecciones de Desviación
                    Estándar</strong> para una precisión quirúrgica.
            </p>
        </div>
    </section>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16" id="main-content">

        <section id="intro" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-6">
                <i data-lucide="layers" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Introducción al Modelo Power of Three (PO3)</h2>
            </div>

            <p>El Modelo <strong>Power of Three (PO3)</strong>, originado en la metodología ICT (Inner Circle Trader),
                es un enfoque estructurado para analizar la acción del precio que divide el movimiento del mercado en
                tres fases: <strong>acumulación</strong>, <strong>manipulación</strong> y <strong>distribución</strong>.
                Este modelo busca interpretar el comportamiento institucional (el <em>smart money</em>) dentro de cada
                jornada de trading, ayudando a los traders y profesionales a alinear sus estrategias con la dinámica
                real del mercado.</p>

            <p>En esencia, PO3 ofrece un marco para entender cómo el “dinero inteligente” acumula posiciones, provoca
                desviaciones engañosas y finalmente impulsa la tendencia verdadera, todo en el transcurso de una sesión.
                Para emprendedores y profesionales de negocios interesados en los mercados, el modelo PO3 proporciona
                lecciones valiosas sobre <strong>gestión de riesgos</strong>, <strong>optimización de procesos</strong>
                y <strong>toma de decisiones</strong>.</p>

            <p>Al igual que en un negocio, identificar correctamente el contexto (sesgo) y esperar confirmaciones antes
                de actuar puede marcar la diferencia entre el éxito y el fracaso. En este capítulo desarrollaremos de
                forma didáctica y profunda el modelo PO3 aplicado a las <strong>desviaciones ICT</strong> en el día a
                día del mercado.</p>

            <p>Exploraremos cómo determinar el <strong>sesgo diario</strong> a partir de la barra del día anterior, cómo
                reconocer las distintas interacciones del precio con ese rango previo, y cómo aplicar estrategias
                prácticas para operar con ventaja. También veremos ejemplos reales, casos prácticos y orientaciones
                estratégicas para implementar PO3 en contextos reales.</p>

            <!-- GRÁFICO INTERACTIVO PO3 -->
            <div class="visual-container bg-slate-50 border-kawn-base/20">
                <div class="visual-title justify-between">
                    <div class="flex items-center"><i data-lucide="bar-chart-2" class="w-5 h-5 mr-2"></i> Esquema
                        Interactivo: Power of Three (AMD)</div>
                    <div class="flex space-x-2 text-xs">
                        <span class="flex items-center"><span
                                class="w-3 h-3 bg-kawn-light border border-kawn-base rounded-full mr-1"></span>Acumulación</span>
                        <span class="flex items-center"><span
                                class="w-3 h-3 bg-red-100 border border-red-500 rounded-full mr-1"></span>Manipulación</span>
                        <span class="flex items-center"><span
                                class="w-3 h-3 bg-green-100 border border-green-500 rounded-full mr-1"></span>Distribución</span>
                    </div>
                </div>

                <div
                    class="relative h-80 w-full bg-white rounded-lg border border-slate-200 overflow-hidden shadow-inner mb-4">
                    <!-- Botones de Control con ARIA -->
                    <div class="absolute top-4 right-4 z-10 flex flex-col gap-2">
                        <button onclick="playPhase('A')" aria-label="Ver fase Acumulación"
                            class="bg-white hover:bg-kawn-light text-kawn-dark border border-kawn-base p-2 rounded-full shadow transition-all"
                            title="Ver Acumulación"><i data-lucide="box" class="w-4 h-4"></i></button>
                        <button onclick="playPhase('M')" aria-label="Ver fase Manipulación"
                            class="bg-white hover:bg-red-50 text-red-600 border border-red-400 p-2 rounded-full shadow transition-all"
                            title="Ver Manipulación"><i data-lucide="alert-octagon" class="w-4 h-4"></i></button>
                        <button onclick="playPhase('D')" aria-label="Ver fase Distribución"
                            class="bg-white hover:bg-green-50 text-green-600 border border-green-400 p-2 rounded-full shadow transition-all"
                            title="Ver Distribución"><i data-lucide="trending-up" class="w-4 h-4"></i></button>
                        <button onclick="playPhase('ALL')" aria-label="Reproducir animación completa"
                            class="bg-slate-800 hover:bg-slate-700 text-white p-2 rounded-full shadow transition-all"
                            title="Reproducir Todo"><i data-lucide="play" class="w-4 h-4"></i></button>
                    </div>

                    <svg id="amd-svg" viewBox="0 0 800 300" class="w-full h-full p-4">
                        <defs>
                            <linearGradient id="gradAcc" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#ccfbf1;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#ccfbf1;stop-opacity:0.1" />
                            </linearGradient>
                            <linearGradient id="gradMan" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#fee2e2;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#fee2e2;stop-opacity:0.1" />
                            </linearGradient>
                            <linearGradient id="gradDis" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#dcfce7;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#dcfce7;stop-opacity:0.1" />
                            </linearGradient>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e" />
                            </marker>
                        </defs>

                        <!-- Grid Lines -->
                        <line x1="50" y1="150" x2="750" y2="150" stroke="#f1f5f9" stroke-width="1" />
                        <line x1="50" y1="50" x2="750" y2="50" stroke="#f1f5f9" stroke-width="1" />
                        <line x1="50" y1="250" x2="750" y2="250" stroke="#f1f5f9" stroke-width="1" />

                        <!-- Phase A -->
                        <g id="phase-a" class="opacity-0 transition-opacity duration-500">
                            <rect x="50" y="100" width="200" height="100" fill="url(#gradAcc)" stroke="#14b8a6"
                                stroke-width="1" stroke-dasharray="4,4" rx="4" />
                            <text x="150" y="90" text-anchor="middle" class="text-sm font-bold fill-kawn-dark">1.
                                ACUMULACIÓN</text>
                            <text x="150" y="220" text-anchor="middle" class="text-xs fill-slate-400">Rango
                                Estrecho</text>
                            <path
                                d="M50,150 L70,130 L90,170 L110,140 L130,160 L150,130 L170,160 L190,140 L210,160 L230,150 L250,150"
                                fill="none" stroke="#0f766e" stroke-width="2" class="path-draw" />
                        </g>

                        <!-- Phase M -->
                        <g id="phase-m" class="opacity-0 transition-opacity duration-500">
                            <rect x="250" y="150" width="150" height="120" fill="url(#gradMan)" stroke="#ef4444"
                                stroke-width="1" stroke-dasharray="4,4" rx="4" />
                            <text x="325" y="290" text-anchor="middle" class="text-sm font-bold fill-red-600">2.
                                MANIPULACIÓN</text>
                            <text x="325" y="140" text-anchor="middle" class="text-xs fill-slate-400">Trampa Bajista
                                (Judas Swing)</text>
                            <path d="M250,150 L270,200 L290,180 L320,240 L350,260 L400,200" fill="none" stroke="#ef4444"
                                stroke-width="3" class="path-draw" />
                        </g>

                        <!-- Phase D -->
                        <g id="phase-d" class="opacity-0 transition-opacity duration-500">
                            <rect x="400" y="20" width="350" height="180" fill="url(#gradDis)" stroke="#22c55e"
                                stroke-width="1" stroke-dasharray="4,4" rx="4" />
                            <text x="575" y="40" text-anchor="middle" class="text-sm font-bold fill-green-700">3.
                                DISTRIBUCIÓN</text>
                            <path d="M400,200 L450,100 L480,130 L550,50 L600,80 L700,30" fill="none" stroke="#22c55e"
                                stroke-width="3" marker-end="url(#arrowhead)" class="path-draw" />
                        </g>
                    </svg>
                </div>
                <div id="amd-caption"
                    class="p-3 bg-kawn-light/30 rounded border-l-4 border-kawn-base text-sm text-slate-700">
                    Pulsa <i data-lucide="play" class="w-3 h-3 inline"></i> para ver la secuencia completa del algoritmo
                    interbancario.
                </div>
            </div>

            <h3 class="text-2xl font-bold text-slate-900 mt-8 mb-4">Fundamentos del Modelo PO3 y el Sesgo Diario</h3>
            <p>Antes de entrar en las dinámicas intradía, debemos entender el concepto de <strong>sesgo diario</strong>.
                El sesgo diario es la expectativa informada sobre la dirección predominante del precio en una sesión de
                trading, basada en la información que nos dio el día anterior. En términos simples, determina si para el
                día actual tendremos preferencia por posiciones largas (alcistas), cortas (bajistas) o un enfoque
                neutral.</p>

            <p>Este sesgo actúa como un filtro maestro para nuestras decisiones operativas: si el sesgo es alcista,
                priorizaremos operaciones de compra y evitaremos ventas temerarias; si es bajista, haremos lo contrario;
                y si no hay un sesgo claro (neutral), quizá optemos por no operar o enfocarnos en estrategias de rango.
                Establecer correctamente el sesgo diario nos impide ir contra la corriente principal del mercado y nos
                protege de operar señales engañosas.</p>

            <div class="highlight-quote">
                <p class="font-bold mb-2">La Premisa Central:</p>
                <p>El modelo PO3 aplicado al día a día parte de una premisa central: <strong>la barra del día anterior
                        es la referencia clave</strong>. En particular, el máximo y el mínimo de la sesión previa
                    definen un rango cuyo rompimiento o respeto brinda información crucial sobre la intención del
                    mercado.</p>
            </div>

            <p>La pregunta fundamental cada mañana es: <em>¿Está el precio actual rompiendo el rango del día anterior o
                    permaneciendo dentro de él, y de qué manera?</em> Según la respuesta, podremos encajar la situación
                en uno de los escenarios previstos por el modelo. Esto nos lleva a las cuatro posibilidades de
                interacción.</p>
        </section>

        <!-- NUEVO CONTENIDO: LIQUIDEZ INSTITUCIONAL -->
        <section id="liquidity" class="mb-16 scroll-mt-24 border-t border-slate-200 pt-16">
            <div class="flex items-center mb-6">
                <i data-lucide="droplet" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Concepto Fundamental: La Liquidez Institucional</h2>
            </div>
            <p>Para comprender el PO3, debemos entender <strong>por qué</strong> ocurre la Manipulación. El mercado
                busca liquidez como un coche busca gasolina. La liquidez reposa en forma de <strong>Stop Loss</strong>
                (órdenes de salida) por encima de máximos antiguos (Buy-side Liquidity - BSL) y por debajo de mínimos
                antiguos (Sell-side Liquidity - SSL).</p>

            <div class="visual-container bg-slate-900 text-white border-slate-700">
                <div class="visual-title text-kawn-light justify-between">
                    <span><i data-lucide="eye" class="w-4 h-4 inline mr-2"></i> Escáner de Liquidez (X-Ray
                        Vision)</span>
                    <button onclick="toggleLiquidity()" id="liq-btn"
                        class="text-xs bg-kawn-base text-white px-3 py-1 rounded-full font-bold hover:bg-kawn-light hover:text-kawn-deep transition-all">
                        ACTIVAR VISIÓN
                    </button>
                </div>

                <div id="liquidity-chart"
                    class="relative h-64 w-full bg-slate-800 rounded border border-slate-700 flex items-center justify-center overflow-hidden">
                    <svg viewBox="0 0 600 200" class="w-full h-full">
                        <!-- Price Action -->
                        <path d="M50,150 L100,100 L150,140 L200,90 L250,130 L300,80 L350,120 L400,70 L450,110 L500,50"
                            fill="none" stroke="#94a3b8" stroke-width="2" />

                        <!-- Equal Highs (BSL) -->
                        <line x1="200" y1="90" x2="300" y2="80" stroke="#f8fafc" stroke-width="1" stroke-dasharray="2,2"
                            opacity="0.3" />

                        <!-- Equal Lows (SSL) -->
                        <line x1="150" y1="140" x2="250" y2="130" stroke="#f8fafc" stroke-width="1"
                            stroke-dasharray="2,2" opacity="0.3" />

                        <!-- Liquidity Icons (Hidden by default) -->
                        <g class="liquidity-icon fill-green-400 text-green-400 font-bold text-xs">
                            <text x="200" y="70">$$$ (BSL)</text>
                            <text x="300" y="60">$$$ (Stops de Ventas)</text>
                            <rect x="190" y="85" width="120" height="5" fill="#ef4444" opacity="0.3" />
                        </g>

                        <g class="liquidity-icon fill-red-400 text-red-400 font-bold text-xs">
                            <text x="150" y="170">$$$ (SSL)</text>
                            <text x="250" y="160">$$$ (Stops de Compras)</text>
                            <rect x="140" y="135" width="120" height="5" fill="#22c55e" opacity="0.3" />
                        </g>
                    </svg>
                </div>
                <p class="text-xs text-slate-400 mt-4">
                    La manipulación (Fase 2 del PO3) suele dirigirse a estas zonas de "$$$" para tomar la liquidez antes
                    de iniciar la tendencia real. Sin liquidez, el mercado no se mueve.
                </p>
            </div>
        </section>

        <section id="scenarios" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-6">
                <i data-lucide="compass" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Interacciones con la Barra Anterior: 4 Escenarios</h2>
            </div>

            <p class="mb-6">Existen cuatro interacciones posibles entre la vela actual y la del día anterior. Cada una
                tiene implicaciones distintas para nuestra estrategia.</p>

            <!-- VISUALIZADOR DE ESCENARIOS ANIMADO -->
            <div class="visual-container bg-white border border-slate-200">
                <div class="visual-title mb-4 flex justify-between items-center">
                    <span><i data-lucide="monitor" class="w-4 h-4 inline mr-2"></i> Simulador de Escenarios
                        (Interactivo)</span>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-6">
                    <button onclick="setScenario(1)" id="btn-sc1" class="interactive-btn active">
                        <i data-lucide="box-select" class="w-4 h-4"></i> 1. Consolidación
                    </button>
                    <button onclick="setScenario(2)" id="btn-sc2" class="interactive-btn">
                        <i data-lucide="arrow-up-circle" class="w-4 h-4"></i> 2. Rotura Arriba
                    </button>
                    <button onclick="setScenario(3)" id="btn-sc3" class="interactive-btn">
                        <i data-lucide="arrow-down-circle" class="w-4 h-4"></i> 3. Rotura Abajo
                    </button>
                    <button onclick="setScenario(4)" id="btn-sc4" class="interactive-btn">
                        <i data-lucide="maximize" class="w-4 h-4"></i> 4. Expansión
                    </button>
                </div>

                <div
                    class="relative h-80 w-full bg-slate-50 rounded border border-slate-100 flex items-center justify-center mb-4 overflow-hidden relative">
                    <!-- Etiquetas Estáticas de Fondo -->
                    <div class="absolute right-2 top-[25%] text-[10px] text-slate-400 font-mono">PDH (Ayer)</div>
                    <div class="absolute right-2 bottom-[25%] text-[10px] text-slate-400 font-mono">PDL (Ayer)</div>

                    <svg viewBox="0 0 600 300" class="w-full h-full" id="scenario-svg">
                        <defs>
                            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="0.5" />
                            </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />

                        <!-- Líneas de referencia PDH/PDL -->
                        <line x1="50" y1="75" x2="550" y2="75" stroke="#94a3b8" stroke-width="2"
                            stroke-dasharray="6,4" />
                        <line x1="50" y1="225" x2="550" y2="225" stroke="#94a3b8" stroke-width="2"
                            stroke-dasharray="6,4" />

                        <!-- Rango del día anterior visualizado -->
                        <rect x="80" y="75" width="80" height="150" fill="#cbd5e1" opacity="0.4" rx="4" />
                        <text x="120" y="155" text-anchor="middle"
                            class="text-[10px] fill-slate-500 font-bold rotate-90 opacity-50">DÍA ANTERIOR</text>

                        <!-- Contenido Dinámico -->
                        <g id="scenario-content">
                            <!-- Se inyecta vía JS -->
                        </g>
                    </svg>
                </div>

                <div id="scenario-desc"
                    class="p-4 bg-gradient-to-r from-kawn-light/40 to-white rounded border-l-4 border-kawn-base text-sm text-slate-700 transition-all shadow-sm">
                    <!-- Texto dinámico -->
                </div>
            </div>

            <div class="space-y-8 mt-8">
                <div>
                    <h3 class="font-bold text-lg text-slate-800">1. Consolidación: El mercado en pausa</h3>
                    <p>Si el rango de precios del día actual se mantiene <strong>completamente dentro</strong> del rango
                        del día anterior, estamos ante un día de consolidación. El mercado esencialmente toma una pausa:
                        digiere el movimiento anterior o espera un catalizador. En estos días, es común que el “dinero
                        inteligente” esté acumulando o distribuyendo posiciones de forma discreta. Para los traders, la
                        consolidación exige paciencia extra, pues el precio puede moverse de forma errática cazando
                        <em>stops</em>. Un nivel a vigilar es el <strong>punto medio (50%)</strong>; si actúa como
                        soporte sugiere sesgo ligeramente alcista; si es resistencia, bajista.</p>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-800">2. Rotura por arriba: El impulso alcista</h3>
                    <p>Cuando el precio rompe y cierra por encima del máximo del día anterior, hay señal de fortaleza.
                        Pero cuidado: <strong>no todas las roturas son iguales</strong>. Debe haber
                        <strong>desplazamiento</strong> (velas amplias, velocidad). Si la rotura es tímida y con mechas,
                        podría ser una trampa alcista.</p>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-800">3. Rotura por abajo: La presión bajista</h3>
                    <p>Simétrico al anterior. Si rompe el mínimo previo con fuerza, hay sesgo bajista. Si rompe y
                        revierte de inmediato (Swing Failure), es una falsa toma de liquidez y el sesgo podría girar al
                        alza.</p>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-800">4. Rotura por ambos lados: El día de expansión</h3>
                    <p>Ocurre cuando el precio rompe ambos extremos en la misma sesión. Llamado también día de búsqueda
                        de liquidez bilateral. Típicamente, la <strong>primera rotura es falsa (manipulación)</strong> y
                        la segunda es la real (distribución). Ejemplo: Rotura de mínimos en Londres (falso) seguido de
                        rotura de máximos en Nueva York (real). Este es el patrón clásico PO3.</p>
                </div>
            </div>
        </section>

        <section id="displacement" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-6">
                <i data-lucide="zap" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Confirmación Práctica: El Arte del Desplazamiento</h2>
            </div>

            <p>Identificar el escenario es solo el primer paso. La verdadera determinación del sesgo viene al responder:
                <em>¿Hubo desplazamiento en la rotura?</em></p>
            <p>El <strong>desplazamiento</strong> es la calidad del movimiento. Un desplazamiento auténtico tiene
                características visuales específicas:</p>

            <!-- COMPARATIVA VISUAL -->
            <div class="grid md:grid-cols-2 gap-6 my-8">
                <div class="bg-green-50 border border-green-200 rounded-lg p-5">
                    <h4 class="font-bold text-green-800 flex items-center mb-3"><i data-lucide="check-circle"
                            class="w-5 h-5 mr-2"></i> Desplazamiento Válido</h4>
                    <div
                        class="h-32 w-full bg-white rounded border border-green-100 mb-3 flex items-center justify-center overflow-hidden">
                        <svg viewBox="0 0 200 100" class="w-full h-full">
                            <!-- Velas fuertes -->
                            <rect x="20" y="60" width="15" height="20" fill="#22c55e" />
                            <rect x="40" y="50" width="15" height="30" fill="#22c55e" />
                            <rect x="60" y="30" width="15" height="50" fill="#22c55e" />
                            <rect x="80" y="10" width="15" height="70" fill="#22c55e" />
                            <path d="M100,50 L120,50 L140,20 L160,10" fill="none" stroke="#15803d" stroke-width="2" />
                            <circle cx="87" cy="45" r="15" stroke="red" stroke-width="2" fill="none" opacity="0.5" />
                            <text x="130" y="80" class="text-[10px] fill-green-700">Fair Value Gap (FVG)</text>
                        </svg>
                    </div>
                    <ul class="text-xs text-green-900 space-y-1 list-disc pl-4">
                        <li>Velas grandes con cuerpo sólido.</li>
                        <li>Crea vacíos de liquidez (FVG).</li>
                        <li>Movimiento rápido y decisivo.</li>
                    </ul>
                </div>

                <div class="bg-red-50 border border-red-200 rounded-lg p-5">
                    <h4 class="font-bold text-red-800 flex items-center mb-3"><i data-lucide="x-circle"
                            class="w-5 h-5 mr-2"></i> Movimiento Débil (Trampa)</h4>
                    <div
                        class="h-32 w-full bg-white rounded border border-red-100 mb-3 flex items-center justify-center overflow-hidden">
                        <svg viewBox="0 0 200 100" class="w-full h-full">
                            <!-- Velas débiles con mucha mecha -->
                            <line x1="27" y1="40" x2="27" y2="80" stroke="#ef4444" stroke-width="1" />
                            <rect x="20" y="55" width="15" height="10" fill="#ef4444" />

                            <line x1="47" y1="30" x2="47" y2="70" stroke="#ef4444" stroke-width="1" />
                            <rect x="40" y="45" width="15" height="10" fill="#ef4444" />

                            <line x1="67" y1="20" x2="67" y2="80" stroke="#ef4444" stroke-width="1" />
                            <rect x="60" y="40" width="15" height="5" fill="#ef4444" />

                            <path d="M90,50 L110,60 L130,40 L150,55" fill="none" stroke="#b91c1c" stroke-width="1"
                                stroke-dasharray="2,2" />
                        </svg>
                    </div>
                    <ul class="text-xs text-red-900 space-y-1 list-disc pl-4">
                        <li>Cuerpos pequeños, muchas mechas.</li>
                        <li>Solapamiento entre velas (acción lenta).</li>
                        <li>Sin gaps claros. Posible reversión.</li>
                    </ul>
                </div>
            </div>

            <ul class="list-none space-y-4 mb-8">
                <li class="flex items-start">
                    <div class="bg-kawn-light p-2 rounded-full mr-3 mt-1"><i data-lucide="activity"
                            class="w-4 h-4 text-kawn-dark"></i></div>
                    <div>
                        <strong>Velocidad y urgencia:</strong> El precio "despega" en cuestión de minutos, no horas. Es
                        un salto repentino impulsado por volumen.
                    </div>
                </li>
                <li class="flex items-start">
                    <div class="bg-kawn-light p-2 rounded-full mr-3 mt-1"><i data-lucide="bar-chart"
                            class="w-4 h-4 text-kawn-dark"></i></div>
                    <div>
                        <strong>Velas de rango amplio:</strong> Cuerpos largos en dirección del movimiento y mechas
                        cortas. Indica control total de un bando.
                    </div>
                </li>
                <li class="flex items-start">
                    <div class="bg-kawn-light p-2 rounded-full mr-3 mt-1"><i data-lucide="layers"
                            class="w-4 h-4 text-kawn-dark"></i></div>
                    <div>
                        <strong>Huecos de liquidez (FVG):</strong> El movimiento es tan rápido que deja vacíos (Fair
                        Value Gaps) donde no hubo negociación eficiente.
                    </div>
                </li>
            </ul>

            <div class="bg-red-50 border border-red-200 p-6 rounded-lg mb-8">
                <h4 class="font-bold text-red-700 flex items-center mb-2"><i data-lucide="alert-triangle"
                        class="w-5 h-5 mr-2"></i> Ausencia de Desplazamiento = Trampa</h4>
                <p class="text-sm text-red-900">
                    Si el mercado cruza un extremo de manera tibia (velas pequeñas, muchas mechas, retrocesos), es señal
                    de que el <em>smart money</em> no apoya el rompimiento. Probablemente están cazando stops para
                    revertir el precio. Regla de oro: <strong>Sin desplazamiento no hay confirmación de sesgo.</strong>
                </p>
            </div>

            <h3 class="text-2xl font-bold text-slate-900 mt-8 mb-4">Guía Paso a Paso para el Sesgo Diario</h3>
            <div class="space-y-4">
                <div class="flex">
                    <div
                        class="flex-shrink-0 h-8 w-8 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold mr-4">
                        1</div>
                    <div>
                        <h4 class="font-bold text-slate-800">Marca los extremos del día anterior</h4>
                        <p class="text-sm">Traza líneas horizontales en el máximo y mínimo de la sesión previa.</p>
                    </div>
                </div>
                <div class="flex">
                    <div
                        class="flex-shrink-0 h-8 w-8 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold mr-4">
                        2</div>
                    <div>
                        <h4 class="font-bold text-slate-800">Observa la apertura actual</h4>
                        <p class="text-sm">¿Abre dentro del rango (neutral), por encima (alcista) o por debajo
                            (bajista)?</p>
                    </div>
                </div>
                <div class="flex">
                    <div
                        class="flex-shrink-0 h-8 w-8 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold mr-4">
                        3</div>
                    <div>
                        <h4 class="font-bold text-slate-800">Espera la primera prueba de un extremo</h4>
                        <p class="text-sm">Paciencia hasta que el precio toque el máximo o mínimo. Analiza la calidad de
                            la ruptura.</p>
                    </div>
                </div>
                <div class="flex">
                    <div
                        class="flex-shrink-0 h-8 w-8 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold mr-4">
                        4</div>
                    <div>
                        <h4 class="font-bold text-slate-800">Confirma o rechaza el sesgo</h4>
                        <p class="text-sm">Si rompe con desplazamiento, sigue la tendencia. Si falla y revierte, opera
                            en contra de la ruptura fallida.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- NUEVO CONTENIDO: KILL ZONES -->
        <section id="killzones" class="mb-16 scroll-mt-24 border-t border-slate-200 pt-16">
            <div class="flex items-center mb-6">
                <i data-lucide="clock" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Cronometría: Kill Zones</h2>
            </div>
            <p>El PO3 no ocurre al azar; obedece a un horario estricto. Las fases de acumulación, manipulación y
                distribución suelen alinearse con las sesiones globales de mercado. Conocer <strong>cuándo</strong>
                operar es tan importante como saber hacia dónde.</p>

            <div class="visual-container bg-white border-slate-300">
                <div class="visual-title">
                    <span><i data-lucide="watch" class="w-4 h-4 inline mr-2"></i> Reloj de Mercado (Horario
                        EST/NY)</span>
                </div>

                <div class="flex justify-center gap-4 mb-4">
                    <button onclick="highlightZone('asia')" class="interactive-btn text-xs">Asia (Acumulación)</button>
                    <button onclick="highlightZone('london')" class="interactive-btn text-xs">Londres
                        (Manipulación)</button>
                    <button onclick="highlightZone('ny')" class="interactive-btn text-xs">New York (Expansión)</button>
                </div>

                <div class="relative h-40 w-full bg-slate-50 border border-slate-200 rounded flex items-center px-4">
                    <!-- Base Timeline -->
                    <div class="w-full h-2 bg-slate-200 rounded relative">
                        <!-- Asia -->
                        <div id="zone-asia"
                            class="killzone-box absolute top-[-20px] left-[0%] width-[25%] h-6 bg-slate-400 rounded text-[10px] text-white flex items-center justify-center w-1/4">
                            18:00 - 00:00</div>

                        <!-- London -->
                        <div id="zone-london"
                            class="killzone-box absolute top-[-20px] left-[33%] width-[20%] h-6 bg-green-500 rounded text-[10px] text-white flex items-center justify-center w-1/5">
                            02:00 - 05:00</div>

                        <!-- NY -->
                        <div id="zone-ny"
                            class="killzone-box absolute top-[-20px] left-[58%] width-[20%] h-6 bg-blue-500 rounded text-[10px] text-white flex items-center justify-center w-1/5">
                            07:00 - 10:00</div>
                    </div>
                </div>
                <div id="zone-desc" class="mt-4 text-sm text-slate-600 bg-slate-100 p-3 rounded">
                    Selecciona una sesión para ver su función en el PO3.
                </div>
            </div>
        </section>

        <!-- NUEVO CONTENIDO: PROYECCIONES -->
        <section id="projections" class="mb-16 scroll-mt-24 border-t border-slate-200 pt-16">
            <div class="flex items-center mb-6">
                <i data-lucide="crosshair" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Proyecciones de Desviación Estándar (SD)</h2>
            </div>
            <p>Una vez confirmada la manipulación (Judas Swing), podemos proyectar matemáticamente hasta dónde llegará
                la expansión. ICT utiliza las <strong>Desviaciones Estándar</strong> del rango de manipulación para
                fijar objetivos (Take Profit) precisos.</p>

            <div class="visual-container bg-slate-50 border-kawn-base/30">
                <div class="visual-title text-kawn-deep">
                    <i data-lucide="ruler" class="w-4 h-4 inline mr-2"></i> Calculadora Visual de Objetivos
                </div>

                <div class="flex gap-4 mb-4">
                    <button onclick="projectSD(2.5)" class="interactive-btn text-xs active">Proyección Conservadora (2.0
                        - 2.5 SD)</button>
                    <button onclick="projectSD(4.0)" class="interactive-btn text-xs">Proyección Extendida (4.0
                        SD)</button>
                </div>

                <div
                    class="relative h-64 w-full bg-white border border-slate-200 rounded flex items-end overflow-hidden p-4">
                    <svg id="sd-svg" viewBox="0 0 400 300" class="w-full h-full">
                        <!-- Rango Manipulación Base (X-A) -->
                        <rect x="50" y="200" width="100" height="50" fill="#fee2e2" stroke="#ef4444" opacity="0.5" />
                        <text x="100" y="230" text-anchor="middle" class="text-[10px] fill-red-800">Rango
                            Manipulación</text>

                        <!-- Proyecciones (Dinámicas) -->
                        <line id="line-sd" x1="150" y1="200" x2="350" y2="100" stroke="#14b8a6" stroke-width="3"
                            stroke-dasharray="5,5" />
                        <circle id="target-sd" cx="350" cy="100" r="6" fill="#14b8a6" />
                        <text id="text-sd" x="350" y="80" text-anchor="middle"
                            class="font-bold text-xs fill-kawn-deep">Objetivo 2.5 SD</text>
                    </svg>
                </div>
                <p class="text-xs text-slate-500 mt-2">
                    Mide la altura de la pata de manipulación (Acumulación a Manipulación) y proyéctala en dirección
                    opuesta. 2.0 a 2.5 SD es el objetivo estándar de alta probabilidad.
                </p>
            </div>
        </section>

        <section class="mb-16 scroll-mt-24">
            <h2 class="text-3xl font-bold text-slate-900 mb-6">Alineación y Confluencias</h2>

            <p>El sesgo diario no existe en el vacío. Debe contextualizarse mediante la <strong>fractalidad</strong>. Un
                modelo que funciona en diario también aplica en semanal o mensual.</p>

            <h4 class="font-bold text-kawn-deep mt-4">Jerarquía de Temporalidades:</h4>
            <ul class="list-disc pl-5 space-y-2 mb-6 text-sm">
                <li><strong>Mensual (Macro):</strong> El "clima" general. ¿Temporada de lluvias o sequía?</li>
                <li><strong>Semanal (Intermedio):</strong> Los frentes climáticos dentro de la estación. ¿Semana de
                    corrección o impulso?</li>
                <li><strong>Diario (Micro):</strong> El pronóstico de hoy. ¿Lloverá por la mañana y despejará por la
                    tarde?</li>
            </ul>

            <p>Debemos buscar la alineación. Si el mensual es alcista, el semanal corrige a soporte y el diario rompe al
                alza con desplazamiento, tenemos <strong>alineación perfecta</strong> (luz verde). Si hay conflicto
                (diario alcista contra mensual bajista), debemos reducir el riesgo y tomar ganancias rápido.</p>

            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 mt-6">
                <h3 class="font-bold text-slate-900 mb-4 flex items-center"><i data-lucide="crosshair"
                        class="w-5 h-5 mr-2 text-kawn-base"></i> Capas de Confluencia Adicionales</h3>
                <p class="mb-4 text-sm">Para maestría en PO3, añade estas preguntas a tu análisis:</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div
                        class="bg-slate-50 p-3 rounded text-sm hover:bg-kawn-light/10 transition-colors border border-transparent hover:border-kawn-base/30">
                        <strong>¿Hay liquidez cerca?</strong><br>
                        Doble techos o suelos cercanos actúan como imanes para el precio.
                    </div>
                    <div
                        class="bg-slate-50 p-3 rounded text-sm hover:bg-kawn-light/10 transition-colors border border-transparent hover:border-kawn-base/30">
                        <strong>¿Hay FVGs alineados?</strong><br>
                        Un hueco (gap) pendiente de llenar en la dirección del sesgo aumenta la probabilidad.
                    </div>
                    <div
                        class="bg-slate-50 p-3 rounded text-sm hover:bg-kawn-light/10 transition-colors border border-transparent hover:border-kawn-base/30">
                        <strong>¿Coincide con un Order Block?</strong><br>
                        Si el extremo del día anterior es también un bloque de órdenes mayor, la reacción será fuerte.
                    </div>
                    <div
                        class="bg-slate-50 p-3 rounded text-sm hover:bg-kawn-light/10 transition-colors border border-transparent hover:border-kawn-base/30">
                        <strong>¿Es una Kill Zone?</strong><br>
                        Las rupturas en apertura de Londres o Nueva York son más fiables que las del mediodía.
                    </div>
                </div>
            </div>
        </section>

        <section id="routine" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-6">
                <i data-lucide="clipboard-list" class="w-8 h-8 text-kawn-base mr-4"></i>
                <h2 class="text-3xl font-bold text-slate-900">Implementación Práctica: Rutina y Ejecución</h2>
            </div>

            <p>La disciplina convierte la teoría en resultados. Aquí tu "Checklist de Vuelo":</p>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div
                    class="col-span-1 bg-white p-5 rounded-lg border-t-4 border-slate-800 shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold mb-3 flex items-center"><span
                            class="w-6 h-6 rounded-full bg-slate-100 text-slate-800 text-xs flex items-center justify-center mr-2">1</span>
                        Pre-Mercado</h4>
                    <ul class="text-xs space-y-2">
                        <li>• Marcar PDH (Máximo Ayer) y PDL (Mínimo Ayer).</li>
                        <li>• Revisar tendencia semanal/mensual.</li>
                        <li>• Identificar noticias de alto impacto.</li>
                        <li>• Localizar piscinas de liquidez cercanas.</li>
                        <li>• Definir escenarios "Si... Entonces".</li>
                    </ul>
                </div>
                <div
                    class="col-span-1 bg-white p-5 rounded-lg border-t-4 border-kawn-base shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold mb-3 flex items-center"><span
                            class="w-6 h-6 rounded-full bg-kawn-light text-kawn-dark text-xs flex items-center justify-center mr-2">2</span>
                        Ejecución</h4>
                    <ul class="text-xs space-y-2">
                        <li>• Observar interacción con niveles clave.</li>
                        <li>• Bajar a temporalidad menor (5m/15m) para ver detalles.</li>
                        <li>• <strong>No entrar en la ruptura:</strong> Esperar el retroceso (pullback).</li>
                        <li>• Entrar en zona de FVG o Breaker tras el desplazamiento.</li>
                        <li>• Cambiar sesgo rápido si falla la ruptura.</li>
                    </ul>
                </div>
                <div
                    class="col-span-1 bg-white p-5 rounded-lg border-t-4 border-kawn-deep shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold mb-3 flex items-center"><span
                            class="w-6 h-6 rounded-full bg-slate-100 text-kawn-deep text-xs flex items-center justify-center mr-2">3</span>
                        Gestión</h4>
                    <ul class="text-xs space-y-2">
                        <li>• Stop Loss tras el extremo opuesto del rango (o mínimo local).</li>
                        <li>• Take Profit en siguiente zona de liquidez.</li>
                        <li>• Breakeven tras avance 1:1.</li>
                        <li>• Riesgo máx 1-2% por operación.</li>
                    </ul>
                </div>
            </div>

            <h3 class="font-bold text-lg text-slate-900 mb-2">Casos Especiales</h3>
            <ul class="list-disc pl-5 space-y-2 mb-6 text-sm">
                <li><strong>Días Festivos:</strong> Poca liquidez, movimientos erráticos. Mejor no operar.</li>
                <li><strong>Gaps de Apertura:</strong> Si el gap es >50% del rango anterior, los niveles previos pierden
                    relevancia. Fíjate si el gap se cierra o se expande.</li>
                <li><strong>Rangos extremos:</strong> Si ayer fue gigante, usa solo la sesión de NY. Si fue muy pequeño,
                    prepárate para una expansión (rotura de ambos lados).</li>
            </ul>

            <h3 class="font-bold text-lg text-slate-900 mb-2">Errores Comunes</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-red-50 p-3 rounded text-xs text-red-800 border border-red-100 flex items-start">
                    <i data-lucide="x" class="w-4 h-4 mr-2 mt-0.5"></i>
                    <div>
                        <strong>Ignorar el desplazamiento:</strong> Operar cualquier cruce de línea es suicida. Sin
                        fuerza, no hay trade.
                    </div>
                </div>
                <div class="bg-red-50 p-3 rounded text-xs text-red-800 border border-red-100 flex items-start">
                    <i data-lucide="x" class="w-4 h-4 mr-2 mt-0.5"></i>
                    <div>
                        <strong>No ver el contexto:</strong> Operar contra la tendencia semanal sin precaución.
                    </div>
                </div>
                <div class="bg-red-50 p-3 rounded text-xs text-red-800 border border-red-100 flex items-start">
                    <i data-lucide="x" class="w-4 h-4 mr-2 mt-0.5"></i>
                    <div>
                        <strong>Sobre-complicar:</strong> Buscar 15 indicadores. PO3 es simple: Niveles + Acción de
                        Precio.
                    </div>
                </div>
                <div class="bg-red-50 p-3 rounded text-xs text-red-800 border border-red-100 flex items-start">
                    <i data-lucide="x" class="w-4 h-4 mr-2 mt-0.5"></i>
                    <div>
                        <strong>Cambiar de sesgo constantemente:</strong> Mantén tu hipótesis salvo evidencia masiva en
                        contra.
                    </div>
                </div>
            </div>
        </section>

        <section id="ai-lab" class="mb-16 scroll-mt-24">
            <div class="flex items-center mb-8 justify-between">
                <div class="flex items-center">
                    <i data-lucide="sparkles" class="w-8 h-8 text-kawn-base mr-4"></i>
                    <h2 class="text-3xl font-bold text-slate-900">Laboratorio de Inteligencia KawnBit (AI-Powered)</h2>
                </div>
                <button onclick="openModal()"
                    class="text-xs flex items-center text-slate-400 hover:text-kawn-base transition-colors"
                    title="Configurar API Key">
                    <i data-lucide="settings" class="w-4 h-4 mr-1"></i> Config
                </button>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">

                <div
                    class="lg:col-span-2 bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col h-[500px]">
                    <div class="bg-gradient-to-r from-kawn-deep to-kawn-dark p-4 flex justify-between items-center">
                        <div class="flex items-center text-white">
                            <i data-lucide="bot" class="w-6 h-6 mr-2"></i>
                            <div>
                                <h3 class="font-bold text-sm">Mentor PO3 IA</h3>
                                <p class="text-[10px] opacity-80">Conectado a Gemini 2.5 Flash</p>
                            </div>
                        </div>
                        <span id="ai-status" class="bg-red-400 w-2 h-2 rounded-full animate-pulse"
                            title="Sin API Key"></span>
                    </div>

                    <div id="chat-messages" class="flex-1 p-6 overflow-y-auto bg-slate-50">
                        <div class="ai-message bot">
                            Hola, soy tu mentor virtual de KawnBit. Puedo analizar el contenido de este artículo para
                            responder tus dudas sobre el modelo PO3. ¡Pregúntame! ✨
                        </div>
                    </div>

                    <div class="p-4 bg-white border-t border-slate-200">
                        <form id="chat-form" class="flex gap-2">
                            <input type="text" id="user-input"
                                class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-kawn-base focus:border-transparent outline-none transition-all"
                                placeholder="Ej: ¿Qué relación hay entre Londres y NY?">
                            <button type="submit" id="chat-submit-btn"
                                class="bg-kawn-dark text-white p-2 rounded-lg hover:bg-kawn-base transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="send" class="w-5 h-5"></i>
                            </button>
                        </form>
                        <p class="text-[10px] text-center text-slate-400 mt-2">Powered by Google Gemini API.</p>
                    </div>
                </div>

                <div class="flex flex-col gap-6">
                    <div
                        class="bg-gradient-to-br from-kawn-light/30 to-white p-6 rounded-2xl shadow-sm border border-kawn-base/20 flex-1 flex flex-col justify-center relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="brain-circuit"
                                class="w-24 h-24 text-kawn-base"></i></div>
                        <h3 class="font-bold text-kawn-deep mb-2 flex items-center relative z-10"><i data-lucide="award"
                                class="mr-2"></i> Desafío PO3 Infinito ✨</h3>
                        <p class="text-xs text-slate-500 mb-4 relative z-10">Genera preguntas únicas basadas en el
                            contenido de este artículo usando IA.</p>

                        <div id="quiz-container" class="relative z-10">
                            <button id="quiz-btn" onclick="generateQuiz()"
                                class="w-full py-3 bg-kawn-base text-white rounded-lg font-bold text-sm hover:bg-kawn-dark transition flex justify-center items-center gap-2 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="zap" class="w-4 h-4"></i> Generar Quiz con IA
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="exercises" class="mb-16 scroll-mt-24">
            <h2 class="text-3xl font-bold text-slate-900 mb-6">Ejercicios Prácticos y Conclusión</h2>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div
                    class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 hover:border-kawn-base transition-all">
                    <h4 class="font-bold text-kawn-deep mb-2">Ejercicio 1: Análisis Histórico</h4>
                    <p class="text-sm">Revisa las últimas 30 sesiones de tu activo favorito. Marca máximos y mínimos
                        previos. Clasifica cada día en uno de los 4 escenarios. ¿Hubo desplazamiento? Anota tus
                        hallazgos.</p>
                </div>
                <div
                    class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 hover:border-kawn-base transition-all">
                    <h4 class="font-bold text-kawn-deep mb-2">Ejercicio 2: Predicción sin Operar</h4>
                    <p class="text-sm">Durante 2 semanas, define tu sesgo cada mañana en tiempo real. No operes. Al
                        final del día, evalúa: ¿Acertaste la dirección? ¿Fallaste por leer mal una trampa?</p>
                </div>
                <div
                    class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 hover:border-kawn-base transition-all">
                    <h4 class="font-bold text-kawn-deep mb-2">Ejercicio 3: Paper Trading</h4>
                    <p class="text-sm">Cuando aciertes el 70% de sesgos, empieza a simular entradas (Demo). Registra
                        dónde pones el stop y el TP. Busca la disciplina de ejecución.</p>
                </div>
                <div
                    class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 hover:border-kawn-base transition-all">
                    <h4 class="font-bold text-kawn-deep mb-2">Ejercicio 4: Trading Real Mínimo</h4>
                    <p class="text-sm">Pasa a real con el tamaño más bajo posible (0.01 lotes). El objetivo es entrenar
                        la psicología con riesgo insignificante. Escala solo tras 3 meses rentables.</p>
                </div>
            </div>

            <div class="bg-kawn-deep text-white p-8 rounded-2xl text-center shadow-xl">
                <h3 class="text-2xl font-bold mb-4">La Elegante Simplicidad del Modelo</h3>
                <p class="mb-6 opacity-90">
                    El modelo PO3 encapsula la esencia de ICT: toma algo simple (precio de hoy vs. ayer) y lo convierte
                    en una herramienta quirúrgica. No necesitas indicadores complejos. Con unas pocas líneas y la
                    habilidad de leer el desplazamiento, puedes inferir las intenciones institucionales.
                </p>
                <p class="font-bold text-kawn-light">
                    "El camino a la maestría no es acumular estrategias, sino dominar profundamente unas pocas
                    herramientas poderosas y aplicarlas con consistencia implacable."
                </p>
            </div>
        </section>

    </main>

    <footer class="bg-slate-900 text-slate-400 py-12">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3">
                <div
                    class="h-10 w-10 bg-gradient-to-br from-kawn-dark to-kawn-base rounded-md opacity-80 flex items-center justify-center text-white font-bold font-display">
                    K</div>
                <div class="flex flex-col">
                    <span class="text-xl font-black text-white tracking-tight leading-none font-display">KAWNBIT</span>
                    <span
                        class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.2em] leading-none mt-1">Quantitative
                        Trading Community</span>
                </div>
            </div>
            <p class="text-sm text-center md:text-right">
                © <span id="current-year">2025</span> KawnBit Magazine. Todos los derechos reservados.<br>
                <span class="text-xs opacity-50">Basado en documentación ICT PO3. No constituye asesoramiento
                    financiero.</span>
            </p>
        </div>
    </footer>

    <script>
        // Wait for DOM to be ready before initializing any logic
        document.addEventListener('DOMContentLoaded', () => {

            document.getElementById('current-year').textContent = new Date().getFullYear();
            lucide.createIcons();

            const proxyUrl = "/.netlify/functions/gemini-proxy";

            // --- CORE AI FUNCTION ---
            async function callGemini(systemPrompt, userPrompt, jsonMode = false) {
                try {
                    const response = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: jsonMode ? { responseMimeType: "application/json" } : {}
                        })
                    });

                    if (!response.ok) {
                        throw new Error("Proxy Error: " + response.status);
                    }

                    const data = await response.json();

                    // Extraemos la respuesta de la estructura de Gemini o del campo result del proxy
                    if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                        return data.candidates[0].content.parts[0].text;
                    }
                    return data.result || null;

                } catch (error) {
                    console.error("Gemini Proxy Error:", error);
                    return null;
                }
            }

            // --- CHAT LOGIC ---
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('user-input');
            const chatMessages = document.getElementById('chat-messages');

            // Extract context safely
            const mainContentEl = document.getElementById('main-content');
            const pageContent = mainContentEl ? mainContentEl.innerText.substring(0, 10000) : "Contenido no disponible";

            if (chatForm) {
                chatForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const msg = chatInput.value.trim();
                    if (!msg) return;

                    appendMessage(msg, 'user');
                    chatInput.value = '';
                    chatInput.disabled = true;
                    const loadId = appendTypingIndicator();

                    const sysPrompt = `Eres un experto mentor de trading ICT. Usa el siguiente contexto del artículo para responder. Sé breve y útil. Si no sabes la respuesta, dilo.\n\nCONTEXTO:\n${pageContent}`;

                    let reply = await callGemini(sysPrompt, msg);

                    if (!reply) {
                        const simResponses = [
                            "Para responder con precisión necesito conectarme a la API real. (Configura la Key arriba ⚙️). Por ahora te diré: La manipulación suele ocurrir en la apertura de Londres.",
                            "Sin conexión a Gemini, solo puedo recordarte: ¡Espera el desplazamiento antes de entrar!",
                            "Modo simulación (Sin Key): Revisa si el precio barrió un máximo anterior antes de caer."
                        ];
                        reply = simResponses[Math.floor(Math.random() * simResponses.length)];
                    }

                    const loader = document.getElementById(loadId);
                    if (loader) loader.remove();

                    appendMessage(reply, 'bot');
                    chatInput.disabled = false;
                    chatInput.focus();
                });
            }

            function appendMessage(text, sender) {
                const div = document.createElement('div');
                div.className = `ai-message ${sender} fade-in`;
                // Robust check for marked library
                if (typeof marked !== 'undefined') {
                    div.innerHTML = marked.parse(text);
                } else {
                    div.textContent = text; // Fallback to plain text to prevent crash
                }
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function appendTypingIndicator() {
                const id = 'loading-' + Date.now();
                const div = document.createElement('div');
                div.id = id;
                div.className = 'ai-message bot typing-indicator';
                div.innerHTML = '<span></span><span></span><span></span>';
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return id;
            }

            // --- DYNAMIC QUIZ LOGIC (ROBUST JSON HANDLING) ---
            window.generateQuiz = async function () {
                const container = document.getElementById('quiz-container');
                container.innerHTML = `
                    <div class="text-center py-6 text-kawn-dark">
                        <i data-lucide="loader-2" class="animate-spin w-8 h-8 mx-auto mb-2"></i>
                        <p class="font-bold">Gemini está leyendo el artículo...</p>
                        <p class="text-xs">Generando preguntas únicas...</p>
                    </div>
                `;
                lucide.createIcons();

                const sysPrompt = `Genera 3 preguntas de opción múltiple (en JSON crudo) basadas en el siguiente texto sobre trading. 
                IMPORTANTE: Responde ÚNICAMENTE con el JSON. No uses bloques de código Markdown (no uses \`\`\`json).
                Formato esperado: [{"q": "Pregunta", "options": ["A", "B", "C", "D"], "a": 0}] donde 'a' es el índice de la correcta (0-3).`;

                let rawResponse = await callGemini(sysPrompt, pageContent, true);

                let questions = [];

                if (!rawResponse) {
                    // Fallback Questions
                    questions = [
                        { q: "¿Qué fase del PO3 busca engañar a los traders?", options: ["Acumulación", "Manipulación", "Distribución", "Expansión"], a: 1 },
                        { q: "¿Qué confirma un sesgo diario válido?", options: ["Cruce de medias", "RSI sobrevendido", "Desplazamiento fuerte", "Volumen bajo"], a: 2 },
                        { q: "La sesión de Londres se asocia típicamente con:", options: ["El cierre del día", "La manipulación (Judas Swing)", "Baja volatilidad", "Consolidación"], a: 1 }
                    ];
                } else {
                    try {
                        // CLEANUP: Remove potential markdown wrapping provided by LLM
                        let cleanJson = rawResponse.replace(/```json\n?|```/g, '').trim();
                        questions = JSON.parse(cleanJson);
                    } catch (e) {
                        console.error("JSON Parse Error:", e, "Raw:", rawResponse);
                        questions = [{ q: "Error procesando la respuesta de la IA. Intenta de nuevo.", options: ["Error", "Error", "Error", "Error"], a: 0 }];
                    }
                }

                renderQuiz(questions);
            }

            function renderQuiz(questions) {
                const container = document.getElementById('quiz-container');
                container.innerHTML = '';

                let score = 0;
                let answered = 0;

                questions.forEach((q, idx) => {
                    const div = document.createElement('div');
                    div.className = "mb-4 border-b border-slate-100 pb-4 fade-in";
                    div.style.animationDelay = `${idx * 0.1}s`;
                    div.innerHTML = `<p class="font-bold text-sm mb-2 text-slate-800">${idx + 1}. ${q.q}</p>`;

                    const optsDiv = document.createElement('div');
                    q.options.forEach((opt, oIdx) => {
                        const btn = document.createElement('div');
                        btn.className = "quiz-option text-xs";
                        btn.textContent = opt;
                        btn.onclick = () => {
                            if (btn.parentElement.classList.contains('answered')) return;
                            btn.parentElement.classList.add('answered');
                            answered++;
                            if (oIdx === q.a) {
                                btn.classList.add('correct');
                                score++;
                            } else {
                                btn.classList.add('wrong');
                                optsDiv.children[q.a].classList.add('correct');
                            }
                            if (answered === questions.length) showScore(score, questions.length);
                        };
                        optsDiv.appendChild(btn);
                    });
                    div.appendChild(optsDiv);
                    container.appendChild(div);
                });

                const reset = document.createElement('button');
                reset.textContent = "Generar Nuevas Preguntas (IA)";
                reset.className = "text-xs text-kawn-base font-bold mt-2 w-full hover:underline";
                reset.onclick = generateQuiz;
                container.appendChild(reset);
            }

            function showScore(s, t) {
                const d = document.createElement('div');
                d.className = "bg-kawn-light/80 p-3 rounded-lg text-center font-bold text-kawn-deep mt-2 animate-bounce border border-kawn-base";
                d.innerHTML = `<i data-lucide="trophy" class="inline w-4 h-4 mr-1"></i> Resultado: ${s}/${t}`;
                document.getElementById('quiz-container').prepend(d);
                lucide.createIcons();
            }

            // -----------------------------------------------------
            // INTERACTIVE VISUALIZATIONS LOGIC
            // -----------------------------------------------------

            // AMD Animation
            window.playPhase = function (phase) {
                const a = document.getElementById('phase-a');
                const m = document.getElementById('phase-m');
                const d = document.getElementById('phase-d');
                const caption = document.getElementById('amd-caption');

                a.style.opacity = '0'; m.style.opacity = '0'; d.style.opacity = '0';

                const paths = document.querySelectorAll('#amd-svg .path-draw');
                paths.forEach(p => { p.style.animation = 'none'; p.offsetHeight; p.style.animation = null; });

                if (phase === 'A' || phase === 'ALL') {
                    setTimeout(() => { a.style.opacity = '1'; caption.innerHTML = "<strong>1. Acumulación:</strong> Rango estrecho."; }, 100);
                }
                if (phase === 'M' || phase === 'ALL') {
                    setTimeout(() => { m.style.opacity = '1'; caption.innerHTML = "<strong>2. Manipulación:</strong> Judas Swing."; }, phase === 'ALL' ? 1500 : 100);
                }
                if (phase === 'D' || phase === 'ALL') {
                    setTimeout(() => { d.style.opacity = '1'; caption.innerHTML = "<strong>3. Distribución:</strong> Expansión real."; }, phase === 'ALL' ? 3000 : 100);
                }
            }
            setTimeout(() => window.playPhase('A'), 500);

            // Liquidity Toggle
            window.toggleLiquidity = function () {
                const chart = document.getElementById('liquidity-chart');
                const btn = document.getElementById('liq-btn');
                if (chart.classList.contains('liquidity-active')) {
                    chart.classList.remove('liquidity-active');
                    btn.textContent = "ACTIVAR VISIÓN";
                    btn.classList.remove('bg-kawn-light', 'text-kawn-deep');
                    btn.classList.add('bg-kawn-base', 'text-white');
                } else {
                    chart.classList.add('liquidity-active');
                    btn.textContent = "DESACTIVAR";
                    btn.classList.add('bg-kawn-light', 'text-kawn-deep');
                    btn.classList.remove('bg-kawn-base', 'text-white');
                }
            }

            // Kill Zones
            const zoneData = {
                'asia': "<strong>Sesión Asiática:</strong> Acumulación / Initial Balance.",
                'london': "<strong>Sesión de Londres:</strong> Manipulación / Judas Swing.",
                'ny': "<strong>Sesión de Nueva York:</strong> Distribución / Continuación."
            };
            window.highlightZone = function (zone) {
                document.querySelectorAll('.killzone-box').forEach(el => el.classList.remove('killzone-active'));
                document.getElementById(`zone-${zone}`).classList.add('killzone-active');
                document.getElementById('zone-desc').innerHTML = zoneData[zone];
            }

            // Scenarios
            const scenarios = {
                1: { html: `<rect x="180" y="80" width="240" height="140" fill="#ccfbf1" stroke="#14b8a6" stroke-width="2" rx="4" opacity="0.5" /><path d="M180,150 L200,100 L240,180 L280,120 L320,160 L360,110 L400,150 L420,130" fill="none" stroke="#0f766e" stroke-width="3" class="path-draw" /><text x="300" y="150" text-anchor="middle" class="text-sm font-bold fill-kawn-deep opacity-80" dy="50">RANGO INTERNO</text>`, desc: "<strong>1. Consolidación:</strong> Inside Day." },
                2: { html: `<path d="M150,150 L250,100 L300,180 L350,75 L400,50 L450,20" fill="none" stroke="#22c55e" stroke-width="3" class="path-draw" /><circle cx="350" cy="75" r="5" fill="#22c55e" /><text x="380" y="40" class="text-xs font-bold fill-green-700">ROTURA ALCISTA</text>`, desc: "<strong>2. Rotura Alcista:</strong> Rompe PDH con fuerza." },
                3: { html: `<path d="M150,100 L250,180 L300,120 L350,225 L400,250 L450,280" fill="none" stroke="#ef4444" stroke-width="3" class="path-draw" /><circle cx="350" cy="225" r="5" fill="#ef4444" /><text x="380" y="270" class="text-xs font-bold fill-red-700">ROTURA BAJISTA</text>`, desc: "<strong>3. Rotura Bajista:</strong> Rompe PDL con fuerza." },
                4: { html: `<path d="M100,150 L150,230 L200,210 L250,250 L300,150 L350,70 L400,30" fill="none" stroke="#0f766e" stroke-width="3" class="path-draw" /><circle cx="250" cy="250" r="6" fill="#ef4444" stroke="white" stroke-width="2" /><text x="250" y="270" text-anchor="middle" class="text-[10px] font-bold fill-red-600">1. Trampa</text><circle cx="350" cy="70" r="6" fill="#22c55e" stroke="white" stroke-width="2" /><text x="350" y="50" text-anchor="middle" class="text-[10px] font-bold fill-green-700">2. Real</text>`, desc: "<strong>4. Expansión:</strong> Outside Day." }
            };
            window.setScenario = function (id) {
                const content = document.getElementById('scenario-content');
                content.style.opacity = 0;
                setTimeout(() => {
                    content.innerHTML = scenarios[id].html;
                    document.getElementById('scenario-desc').innerHTML = scenarios[id].desc;
                    content.style.opacity = 1;
                    const paths = content.querySelectorAll('.path-draw');
                    paths.forEach(p => { p.style.animation = 'none'; p.offsetHeight; p.style.animation = null; });
                }, 200);
                for (let i = 1; i <= 4; i++) {
                    const btn = document.getElementById(`btn-sc${i}`);
                    if (i === id) btn.classList.add('active'); else btn.classList.remove('active');
                }
            }
            window.setScenario(1);

            // Projections
            window.projectSD = function (val) {
                const line = document.getElementById('line-sd');
                const target = document.getElementById('target-sd');
                const text = document.getElementById('text-sd');
                if (val === 2.5) {
                    line.setAttribute('x2', '350'); line.setAttribute('y2', '100');
                    target.setAttribute('cx', '350'); target.setAttribute('cy', '100');
                    text.setAttribute('x', '350'); text.setAttribute('y', '80');
                    text.textContent = "Objetivo 2.5 SD";
                } else {
                    line.setAttribute('x2', '380'); line.setAttribute('y2', '40');
                    target.setAttribute('cx', '380'); target.setAttribute('cy', '40');
                    text.setAttribute('x', '350'); text.setAttribute('y', '30');
                    text.textContent = "Objetivo 4.0 SD";
                }
            }

        }); // End DOMContentLoaded
    </script>
</body>

</html>