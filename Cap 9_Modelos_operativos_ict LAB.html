<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Guía interactiva sobre Modelos Operativos ICT: Estrategias para la transformación digital y gestión tecnológica empresarial.">
    <title>KawnBit | Modelos Operativos ICT</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@400;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Librerías Externas (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Configuración Tailwind KawnBit -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kawn: {
                            light: '#ccfbf1', // Teal 100
                            base: '#14b8a6',  // Teal 500
                            dark: '#0f766e',  // Teal 700
                            deep: '#134e4a',  // Teal 900
                        },
                        slate: {
                            50: '#f8fafc',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(20, 184, 166, 0.25)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos base */
        body {
            background-color: #f8fafc;
            color: #334155;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Montserrat', sans-serif;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #14b8a6;
        }

        /* KawnBit Logo */
        .kawn-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #14b8a6 0%, #0f766e 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(20, 184, 166, 0.3);
            position: relative;
            overflow: hidden;
        }

        .kawn-logo-icon::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            top: -25%;
            left: -25%;
        }

        .kawn-logo-icon::after {
            content: 'K';
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 24px;
            z-index: 2;
        }

        /* TOC Activo */
        .toc-link {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            opacity: 0.7;
        }

        .toc-link:hover {
            opacity: 1;
            color: #14b8a6;
        }

        .toc-link.active {
            color: #0f766e;
            border-left: 3px solid #14b8a6;
            background: linear-gradient(90deg, #ccfbf1 0%, transparent 100%);
            padding-left: 1rem;
            opacity: 1;
            font-weight: 600;
        }

        /* Animaciones */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chat Styles */
        .chat-message {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Interactive Card */
        .interactive-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .interactive-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(20, 184, 166, 0.15);
            border-color: #14b8a6;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            cursor: pointer;
        }

        .quiz-option:disabled {
            cursor: default;
            opacity: 0.7;
        }

        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
            font-weight: 600;
        }

        .quiz-option.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #b91c1c;
            opacity: 0.6;
        }

        .node-transition {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Markdown Styles */
        .prose strong {
            color: #0f766e;
            font-weight: 700;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin: 0.5rem 0;
        }

        .prose li {
            margin-bottom: 0.25rem;
        }

        .prose p {
            margin-bottom: 0.75rem;
        }

        /* Sliders Personalizados */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #14b8a6;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 0 2px white;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        input[type=range]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 4px rgba(20, 184, 166, 0.3);
        }
    </style>
</head>

<body class="antialiased text-slate-600 bg-slate-50">

    <!-- Navbar Sticky -->
    <nav
        class="sticky top-0 z-50 w-full bg-white/95 backdrop-blur-md border-b border-slate-200 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center gap-3 select-none">
                    <div class="kawn-logo-icon"></div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-black text-slate-900 tracking-tight leading-none">KAWNBIT</span>
                        <span
                            class="text-[0.6rem] font-bold text-kawn-base uppercase tracking-[0.25em] leading-none mt-1">Quantitative
                            Trading Community</span>
                    </div>
                </div>

                <div class="hidden md:flex space-x-6">
                    <a href="#intro"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wide">Teoría</a>
                    <a href="#bimodal"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wide">Bimodal</a>
                    <a href="#vsm"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wide">VSM</a>
                    <a href="#finops"
                        class="text-slate-600 hover:text-kawn-base font-medium transition-colors text-xs uppercase tracking-wide">FinOps</a>
                    <a href="#consultor-ia"
                        class="text-kawn-base font-bold transition-colors text-xs uppercase tracking-wide border-b-2 border-kawn-base flex items-center gap-1"><i
                            data-lucide="sparkles" class="w-3 h-3"></i> Consultor IA</a>
                    <a href="#quiz"
                        class="px-4 py-2 bg-kawn-base text-white rounded-lg text-xs font-bold shadow-glow hover:bg-kawn-dark transition-all transform hover:-translate-y-0.5">Test
                        final</a>
                </div>

                <button class="md:hidden p-2 text-slate-600 hover:text-kawn-base transition-colors"
                    onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" aria-label="Abrir menú">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
        <div id="mobile-menu"
            class="hidden md:hidden bg-white border-b border-slate-200 p-4 absolute w-full shadow-xl z-40">
            <div class="flex flex-col space-y-4">
                <a href="#intro" class="text-slate-600 font-medium p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">Introducción</a>
                <a href="#bimodal" class="text-slate-600 font-medium p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">IT Bimodal</a>
                <a href="#vsm" class="text-slate-600 font-medium p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">VSM</a>
                <a href="#finops" class="text-slate-600 font-medium p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">FinOps</a>
                <a href="#consultor-ia" class="text-kawn-base font-bold p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">Consultor IA</a>
                <a href="#quiz" class="text-kawn-base font-bold p-2"
                    onclick="document.getElementById('mobile-menu').classList.add('hidden')">Validación</a>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="flex flex-col md:flex-row gap-12">

            <!-- Sidebar TOC -->
            <aside class="hidden md:block w-64 flex-shrink-0">
                <div class="sticky top-28">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6">Contenido</h3>
                    <nav id="toc-container" class="flex flex-col space-y-1 text-sm border-l border-slate-200">
                        <!-- Generado por JS -->
                    </nav>
                    <div class="mt-8 p-4 bg-kawn-light/30 rounded-xl border border-kawn-light">
                        <p class="text-xs text-kawn-deep font-semibold mb-2 flex items-center gap-2">
                            <i data-lucide="zap" class="w-3 h-3"></i> Progreso
                        </p>
                        <div class="w-full bg-slate-200 rounded-full h-1.5 overflow-hidden">
                            <div id="reading-progress"
                                class="bg-kawn-base h-1.5 rounded-full transition-all duration-300" style="width: 0%">
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 min-w-0">

                <!-- Hero -->
                <section class="mb-16 fade-in-up">
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-kawn-light/50 border border-kawn-base/20 text-kawn-dark text-xs font-bold uppercase tracking-wider mb-6">
                        <span class="w-2 h-2 rounded-full bg-kawn-base"></span> Capítulo 9
                    </div>
                    <h1 class="text-4xl md:text-6xl font-black text-slate-900 mb-6 leading-tight tracking-tight">
                        Modelos Operativos <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-kawn-base to-kawn-dark">ICT</span>
                    </h1>
                    <p class="text-xl md:text-2xl text-slate-500 leading-relaxed font-light">
                        Estructura, procesos y tecnología para generar valor en la era digital. Descubre cómo
                        transformar la función de TI en un motor estratégico.
                    </p>
                </section>

                <!-- Introducción -->
                <section id="intro" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6 border-b-2 border-kawn-light pb-2 inline-block">
                        Introducción al modelo operativo</h2>

                    <div class="bg-white p-8 rounded-xl shadow-lg border-l-4 border-kawn-base mb-8 interactive-card">
                        <h3 class="text-lg font-bold text-kawn-deep mb-2 flex items-center gap-2">
                            <i data-lucide="book-open" class="w-5 h-5"></i> Definición clave
                        </h3>
                        <p class="text-slate-700 leading-relaxed">
                            El <strong>modelo operativo ICT</strong> define cómo una organización estructura sus
                            procesos, recursos humanos y tecnologías para generar valor. Es el "pegamento" entre la
                            estrategia visionaria y la operación diaria, alineando los objetivos de negocio con la
                            ejecución tecnológica práctica.
                        </p>
                    </div>

                    <p class="mb-6 leading-7 text-lg">
                        La velocidad del cambio tecnológico actual fuerza a replantear los modelos tradicionales. Ya no
                        basta con un departamento centralizado; evolucionamos hacia modelos
                        <strong>distribuidos</strong> donde las unidades de negocio adquieren autonomía y TI asume un
                        rol de gobernanza y arquitectura.
                    </p>
                </section>

                <!-- Estructuras -->
                <section id="estructuras" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Estructuras organizativas</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        El modelo operativo define el esqueleto de la organización. Históricamente hemos evolucionado
                        desde estructuras jerárquicas rígidas hacia redes flexibles de equipos autónomos.
                    </p>

                    <div class="bg-white p-6 rounded-2xl shadow-xl border border-slate-200 mb-8 overflow-hidden">
                        <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                            <h3 class="font-bold text-slate-800 flex items-center gap-2">
                                <i data-lucide="git-merge" class="text-kawn-base"></i> Evolución estructural
                            </h3>
                            <div class="bg-slate-100 p-1 rounded-lg flex text-xs font-bold">
                                <button onclick="setStructure('traditional')" id="btn-trad"
                                    class="px-4 py-2 rounded-md bg-white text-kawn-deep shadow-sm transition-all focus:outline-none">Jerárquica</button>
                                <button onclick="setStructure('agile')" id="btn-agile"
                                    class="px-4 py-2 rounded-md text-slate-500 hover:text-slate-800 transition-all focus:outline-none">Redárquica
                                    (Agile)</button>
                            </div>
                        </div>

                        <div class="relative h-64 bg-slate-50 rounded-xl border border-slate-200 p-8 flex justify-center items-center overflow-hidden transition-all"
                            id="structure-canvas"></div>

                        <div id="structure-info"
                            class="mt-6 p-4 bg-kawn-light/30 border-l-4 border-kawn-base text-sm text-slate-700 animate-fade-in-up">
                            <strong>Modelo Jerárquico Tradicional:</strong> Basado en silos funcionales.
                        </div>
                    </div>
                </section>

                <!-- IT BIMODAL -->
                <section id="bimodal" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">IT Bimodal (Gartner)</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        La práctica de gestionar dos estilos de trabajo coherentes: uno centrado en la previsibilidad y
                        otro en la exploración. Las organizaciones modernas necesitan ambas capacidades para innovar sin
                        romper el núcleo operativo.
                    </p>

                    <div class="bg-slate-900 rounded-2xl shadow-xl p-8 text-white relative overflow-hidden">
                        <div class="absolute -right-10 -top-10 w-64 h-64 bg-kawn-base opacity-10 rounded-full blur-3xl">
                        </div>

                        <div class="flex justify-between items-center mb-8 relative z-10">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i data-lucide="toggle-right" class="text-kawn-base"></i> Interruptor bimodal
                            </h3>
                            <div class="flex items-center gap-3">
                                <span id="label-mode1" class="text-sm font-bold text-kawn-light">Modo 1 (Estable)</span>
                                <button onclick="toggleBimodal()" id="bimodal-switch"
                                    class="w-14 h-8 bg-kawn-base rounded-full p-1 transition-all duration-500 relative focus:outline-none shadow-glow">
                                    <div id="bimodal-knob"
                                        class="w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-500">
                                    </div>
                                </button>
                                <span id="label-mode2" class="text-sm font-bold text-slate-500">Modo 2 (Ágil)</span>
                            </div>
                        </div>

                        <div id="bimodal-content"
                            class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10 transition-all duration-500">
                            <!-- Contenido dinámico via JS -->
                        </div>
                    </div>
                </section>

                <!-- Métricas DORA -->
                <section id="metricas" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Métricas de alto rendimiento (DORA)</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        El estándar de oro para medir el rendimiento de equipos de desarrollo de software. Evalúa la
                        velocidad y la estabilidad.
                    </p>

                    <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2">
                            <i data-lucide="bar-chart-2" class="text-kawn-base"></i> Calculadora de nivel DORA
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="space-y-6">
                                <div>
                                    <label
                                        class="text-xs font-bold text-slate-500 uppercase flex justify-between">Frecuencia
                                        de Despliegue <span id="val-deploy"
                                            class="text-kawn-base">Semanal</span></label>
                                    <input type="range" id="slider-deploy" min="1" max="4" value="2" step="1"
                                        oninput="updateDora()">
                                    <p class="text-[10px] text-slate-400 mt-1">1: >6 meses | 4: A demanda (múltiples al
                                        día)</p>
                                </div>
                                <div>
                                    <label
                                        class="text-xs font-bold text-slate-500 uppercase flex justify-between">Tiempo
                                        de Entrega (Lead Time) <span id="val-lead" class="text-kawn-base">1
                                            semana</span></label>
                                    <input type="range" id="slider-lead" min="1" max="4" value="2" step="1"
                                        oninput="updateDora()">
                                    <p class="text-[10px] text-slate-400 mt-1">1: >6 meses | 4: <1 hora</p>
                                </div>
                                <div>
                                    <label
                                        class="text-xs font-bold text-slate-500 uppercase flex justify-between">Tiempo
                                        de Restauración <span id="val-restore" class="text-kawn-base">1
                                            día</span></label>
                                    <input type="range" id="slider-restore" min="1" max="4" value="2" step="1"
                                        oninput="updateDora()">
                                    <p class="text-[10px] text-slate-400 mt-1">1: >6 meses | 4: <1 hora</p>
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-slate-500 uppercase flex justify-between">Tasa
                                        de Fallos <span id="val-fail" class="text-kawn-base">16-30%</span></label>
                                    <input type="range" id="slider-fail" min="1" max="4" value="2" step="1"
                                        oninput="updateDora()">
                                    <p class="text-[10px] text-slate-400 mt-1">1: >60% | 4: 0-15%</p>
                                </div>
                            </div>

                            <div class="flex flex-col justify-center items-center bg-slate-50 rounded-xl border border-slate-200 p-6 text-center transition-all"
                                id="dora-result-box">
                                <div class="w-20 h-20 rounded-full bg-slate-200 flex items-center justify-center mb-4 transition-colors duration-500"
                                    id="dora-icon-bg">
                                    <i data-lucide="medal"
                                        class="w-10 h-10 text-slate-400 transition-colors duration-500"
                                        id="dora-icon"></i>
                                </div>
                                <h4 class="text-2xl font-black text-slate-800 mb-1" id="dora-title">Medium Performer
                                </h4>
                                <p class="text-sm text-slate-500" id="dora-desc">Rendimiento estándar. Hay margen de
                                    mejora en automatización.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NUEVO: Value Stream Management (VSM) -->
                <section id="vsm" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Value Stream Management (VSM)</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        Visualizar y gestionar el flujo de valor empresarial desde la idea hasta el cliente. El objetivo
                        es acelerar la entrega eliminando "desperdicios" (esperas, retrabajos).
                    </p>

                    <div class="bg-white p-8 rounded-2xl shadow-xl border-l-4 border-kawn-base">
                        <div class="flex justify-between items-end mb-6">
                            <div>
                                <h3 class="font-bold text-slate-800 flex items-center gap-2">
                                    <i data-lucide="activity" class="text-kawn-base"></i> Optimizador de pipeline
                                </h3>
                                <p class="text-sm text-slate-500 mt-1">Activa mejoras para reducir el <strong>Lead
                                        Time</strong> (Tiempo de Entrega).</p>
                            </div>
                            <div class="text-right">
                                <span class="block text-xs font-bold text-slate-400 uppercase">Tiempo Actual</span>
                                <span id="vsm-time" class="text-3xl font-black text-slate-800">4 Semanas</span>
                            </div>
                        </div>

                        <!-- VSM Visualizer -->
                        <div class="relative h-16 bg-slate-100 rounded-full mb-8 overflow-hidden flex">
                            <div id="vsm-bar-dev"
                                class="h-full bg-slate-300 flex items-center justify-center text-xs font-bold text-slate-600 transition-all duration-500"
                                style="width: 40%">Coding</div>
                            <div id="vsm-bar-test"
                                class="h-full bg-slate-400 flex items-center justify-center text-xs font-bold text-white transition-all duration-500"
                                style="width: 30%">Testing</div>
                            <div id="vsm-bar-deploy"
                                class="h-full bg-slate-500 flex items-center justify-center text-xs font-bold text-white transition-all duration-500"
                                style="width: 30%">Deploy</div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <label
                                class="flex items-center gap-3 p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                                <input type="checkbox" id="chk-ci"
                                    class="w-5 h-5 text-kawn-base rounded focus:ring-kawn-base border-gray-300"
                                    onchange="updateVSM()">
                                <div>
                                    <span class="block font-bold text-slate-700 text-sm">Integración Continua</span>
                                    <span class="block text-xs text-slate-400">Reduce 'Coding' y 'Build'</span>
                                </div>
                            </label>
                            <label
                                class="flex items-center gap-3 p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                                <input type="checkbox" id="chk-auto"
                                    class="w-5 h-5 text-kawn-base rounded focus:ring-kawn-base border-gray-300"
                                    onchange="updateVSM()">
                                <div>
                                    <span class="block font-bold text-slate-700 text-sm">Tests Automáticos</span>
                                    <span class="block text-xs text-slate-400">Elimina 'Manual QA'</span>
                                </div>
                            </label>
                            <label
                                class="flex items-center gap-3 p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                                <input type="checkbox" id="chk-cd"
                                    class="w-5 h-5 text-kawn-base rounded focus:ring-kawn-base border-gray-300"
                                    onchange="updateVSM()">
                                <div>
                                    <span class="block font-bold text-slate-700 text-sm">Despliegue Continuo</span>
                                    <span class="block text-xs text-slate-400">Automatiza 'Deploy'</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- NUEVO: FinOps -->
                <section id="finops" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">FinOps (Cloud Financial Management)</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        FinOps es la práctica cultural y operativa de gestionar los costes de la nube. No se trata solo
                        de gastar menos, sino de gastar mejor, asegurando que cada dólar invertido genere valor.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-slate-900 p-8 rounded-2xl shadow-xl text-white">
                            <h3 class="font-bold mb-6 flex items-center gap-2">
                                <i data-lucide="pie-chart" class="text-kawn-base"></i> Simulador de ahorro cloud
                            </h3>

                            <div class="space-y-6 mb-8">
                                <div>
                                    <label class="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                                        Instancias Reservadas (Coverage)
                                        <span id="val-ri">0%</span>
                                    </label>
                                    <input type="range" id="slider-ri" min="0" max="100" value="0"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-kawn-base"
                                        oninput="updateFinOps()">
                                </div>
                                <div>
                                    <label class="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                                        Rightsizing (Recursos inactivos)
                                        <span id="val-rs">Ninguno</span>
                                    </label>
                                    <input type="range" id="slider-rs" min="0" max="100" value="0"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-kawn-base"
                                        oninput="updateFinOps()">
                                </div>
                            </div>

                            <div class="flex items-center justify-between border-t border-slate-700 pt-6">
                                <div>
                                    <span class="block text-xs text-slate-400">Gasto Mensual Original</span>
                                    <span
                                        class="block text-xl font-bold text-slate-300 line-through decoration-red-500">$10,000</span>
                                </div>
                                <div class="text-right">
                                    <span class="block text-xs text-kawn-base font-bold uppercase">Nuevo Gasto</span>
                                    <span id="finops-total" class="block text-3xl font-black text-white">$10,000</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl border border-slate-200 flex flex-col justify-center">
                            <div class="space-y-4">
                                <div class="flex gap-4">
                                    <div
                                        class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center text-green-600 flex-shrink-0">
                                        <i data-lucide="trending-down" class="w-6 h-6"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-800">Ahorro Mensual</h4>
                                        <p id="finops-savings" class="text-2xl font-black text-green-600">$0</p>
                                    </div>
                                </div>
                                <hr class="border-slate-100">
                                <p class="text-sm text-slate-500">
                                    <strong>Insight:</strong> Al aumentar la cobertura de instancias reservadas y
                                    eliminar recursos zombies (rightsizing), transformas el gasto variable en valor
                                    predecible.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sourcing -->
                <section id="sourcing" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Estrategia de sourcing: Core vs. Context</h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        El modelo de Geoffrey Moore distingue entre <strong>Core</strong> (lo que te diferencia) y
                        <strong>Context</strong> (lo necesario para operar).
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-slate-900 p-6 rounded-2xl shadow-lg text-white">
                            <h3 class="font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="grid" class="text-kawn-base"></i> Matriz de decisión
                            </h3>
                            <div class="grid grid-cols-2 gap-2 h-64">
                                <button onclick="showSourcing('q1')"
                                    class="bg-kawn-deep hover:bg-kawn-base p-2 rounded-lg border border-slate-700 transition-colors flex flex-col justify-center items-center text-center group focus:ring-2 focus:ring-kawn-light">
                                    <span class="text-xs font-bold uppercase text-kawn-light mb-1">Alta
                                        Criticidad</span>
                                    <span class="text-xs font-bold uppercase text-kawn-light mb-1">Alta
                                        Diferenciación</span>
                                    <i data-lucide="star"
                                        class="w-6 h-6 mt-2 group-hover:scale-110 transition-transform"></i>
                                </button>
                                <button onclick="showSourcing('q2')"
                                    class="bg-slate-800 hover:bg-slate-700 p-2 rounded-lg border border-slate-700 transition-colors flex flex-col justify-center items-center text-center group focus:ring-2 focus:ring-slate-500">
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Alta Criticidad</span>
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Baja
                                        Diferenciación</span>
                                    <i data-lucide="shield"
                                        class="w-6 h-6 mt-2 group-hover:scale-110 transition-transform"></i>
                                </button>
                                <button onclick="showSourcing('q3')"
                                    class="bg-slate-800 hover:bg-slate-700 p-2 rounded-lg border border-slate-700 transition-colors flex flex-col justify-center items-center text-center group focus:ring-2 focus:ring-slate-500">
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Baja Criticidad</span>
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Alta
                                        Diferenciación</span>
                                    <i data-lucide="flask-conical"
                                        class="w-6 h-6 mt-2 group-hover:scale-110 transition-transform"></i>
                                </button>
                                <button onclick="showSourcing('q4')"
                                    class="bg-slate-800 hover:bg-slate-700 p-2 rounded-lg border border-slate-700 transition-colors flex flex-col justify-center items-center text-center group focus:ring-2 focus:ring-slate-500">
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Baja Criticidad</span>
                                    <span class="text-xs font-bold uppercase text-slate-400 mb-1">Baja
                                        Diferenciación</span>
                                    <i data-lucide="trash-2"
                                        class="w-6 h-6 mt-2 group-hover:scale-110 transition-transform"></i>
                                </button>
                            </div>
                        </div>

                        <div
                            class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 flex flex-col justify-center">
                            <div id="sourcing-detail" class="animate-fade-in-up">
                                <div class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mb-4">
                                    <i data-lucide="mouse-pointer-click" class="text-slate-400"></i>
                                </div>
                                <h4 class="text-xl font-bold text-slate-900 mb-2">Selecciona un cuadrante</h4>
                                <p class="text-slate-500 text-sm">Decide si construir internamente (In-house) o buscar
                                    un socio externo.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Consultor IA -->
                <section id="consultor-ia" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6 flex items-center gap-2">
                        <i data-lucide="brain-circuit" class="text-kawn-base"></i> Laboratorio de casos <span
                            class="text-xs bg-gradient-to-r from-kawn-base to-blue-500 text-white px-2 py-1 rounded-full align-middle ml-2 shadow-sm">Powered
                            by Gemini ✨</span>
                    </h2>
                    <p class="mb-6 text-slate-600 text-lg">
                        Describe brevemente tu empresa o un escenario hipotético, y la IA analizará tu situación para
                        recomendarte el modelo operativo más adecuado.
                    </p>

                    <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-200">
                        <div class="mb-6">
                            <label for="case-input" class="block text-sm font-bold text-slate-700 mb-2">Descripción del
                                caso:</label>
                            <textarea id="case-input" rows="4"
                                class="w-full p-4 rounded-xl border border-slate-300 focus:border-kawn-base focus:ring-2 focus:ring-kawn-light outline-none transition-all text-slate-700"
                                placeholder="Ej: Somos una empresa de logística tradicional con 500 empleados buscando modernizar nuestra flota con IoT..."></textarea>
                        </div>
                        <button onclick="analyzeCase()" id="analyze-btn"
                            class="w-full sm:w-auto bg-gradient-to-r from-kawn-deep to-kawn-base text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-glow transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="sparkles" class="w-5 h-5"></i> Analizar con IA
                        </button>

                        <div id="case-result" class="mt-8 hidden animate-fade-in-up">
                            <div class="border-t border-slate-100 pt-6">
                                <h4 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                                    <i data-lucide="file-text" class="w-5 h-5 text-kawn-base"></i> Diagnóstico del
                                    consultor virtual
                                </h4>
                                <div id="case-content"
                                    class="bg-slate-50 p-6 rounded-xl border border-slate-200 prose prose-slate max-w-none text-sm text-slate-700">
                                </div>
                            </div>
                        </div>
                        <div id="case-loading" class="mt-8 hidden text-center p-6">
                            <i data-lucide="loader-2" class="w-8 h-8 text-kawn-base animate-spin mx-auto mb-2"></i>
                            <p class="text-slate-500 text-sm font-medium">Analizando variables operativas...</p>
                        </div>
                    </div>
                </section>

                <!-- Modelos Principales (Compacto) -->
                <section id="modelos" class="mb-20 scroll-mt-32 section-track">
                    <h2 class="text-3xl font-bold text-slate-900 mb-6">Arquetipos de modelos operativos</h2>
                    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden mb-10">
                        <div class="bg-slate-900 p-6 flex justify-between items-center">
                            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                                <i data-lucide="radar" class="text-kawn-base"></i> Radar de capacidades
                            </h3>
                            <span class="text-xs font-bold bg-kawn-base text-white px-2 py-1 rounded">INTERACTIVO</span>
                        </div>
                        <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                            <div class="relative h-80 w-full"><canvas id="modelsRadarChart"></canvas></div>
                            <div>
                                <h4 class="font-bold text-slate-800 mb-4 text-lg">Selecciona un modelo:</h4>
                                <div class="flex flex-wrap gap-2 mb-6" id="model-buttons">
                                    <button onclick="updateRadar('cliente')"
                                        class="px-3 py-2 text-xs font-bold rounded-lg bg-kawn-base text-white shadow-md transition-transform transform active:scale-95">Cliente</button>
                                    <button onclick="updateRadar('frugal')"
                                        class="px-3 py-2 text-xs font-bold rounded-lg bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 transition-colors">Extrafrugal</button>
                                    <button onclick="updateRadar('data')"
                                        class="px-3 py-2 text-xs font-bold rounded-lg bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 transition-colors">Data-driven</button>
                                    <button onclick="updateRadar('skynet')"
                                        class="px-3 py-2 text-xs font-bold rounded-lg bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 transition-colors">Skynet</button>
                                    <button onclick="updateRadar('abierto')"
                                        class="px-3 py-2 text-xs font-bold rounded-lg bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 transition-colors">Abierto</button>
                                </div>
                                <div id="model-description"
                                    class="bg-slate-50 p-5 rounded-xl border border-slate-200 text-sm text-slate-600 min-h-[120px] transition-opacity duration-300">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Quiz -->
                <section id="quiz" class="mb-20 scroll-mt-32 section-track">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-slate-900 flex items-center gap-3">
                            <i data-lucide="award" class="text-kawn-base"></i> Validación del conocimiento
                        </h2>
                    </div>

                    <div
                        class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200 relative overflow-hidden min-h-[400px]">
                        <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                            <h3 class="font-bold text-lg text-slate-800">Evaluación del capítulo</h3>
                            <div class="flex gap-2 items-center">
                                <button onclick="generateQuizQuestion()" id="new-quiz-btn"
                                    class="text-xs bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition-colors border border-slate-300 disabled:opacity-50">
                                    <i data-lucide="refresh-cw" class="w-3 h-3"></i> Nuevo desafío IA
                                </button>
                                <span id="quiz-score"
                                    class="bg-kawn-light text-kawn-dark px-3 py-1 rounded-full text-sm font-bold border border-kawn-base">0
                                    Correctas</span>
                            </div>
                        </div>

                        <div class="space-y-8" id="quiz-questions-container">
                            <!-- Preguntas estáticas -->
                            <div class="quiz-item" data-id="1">
                                <p class="font-bold text-slate-900 mb-3">1. ¿Cuál es el objetivo principal de un modelo
                                    operativo ICT?</p>
                                <div class="space-y-2 text-sm">
                                    <button onclick="checkAnswer(1, 'a', this)"
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-slate-50">A.
                                        Comprar hardware más barato.</button>
                                    <button onclick="checkAnswer(1, 'b', this)"
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-slate-50"
                                        data-correct="true">B. Estructurar procesos, personas y tecnología para generar
                                        valor.</button>
                                    <button onclick="checkAnswer(1, 'c', this)"
                                        class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 hover:bg-slate-50">C.
                                        Eliminar el departamento de TI.</button>
                                </div>
                                <div class="hidden"></div>
                            </div>
                        </div>

                        <div id="quiz-loading"
                            class="absolute inset-0 bg-white/90 backdrop-blur-sm z-10 hidden flex-col items-center justify-center">
                            <i data-lucide="loader-2" class="w-10 h-10 text-kawn-base animate-spin mb-4"></i>
                            <p class="text-slate-600 font-bold">Generando desafío único con IA...</p>
                        </div>
                    </div>
                </section>

                <!-- Footer -->
                <footer class="mt-20 border-t border-slate-200 pt-10 pb-6 text-center md:text-left">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                        <div
                            class="flex items-center gap-3 grayscale opacity-70 hover:grayscale-0 hover:opacity-100 transition-all">
                            <div class="kawn-logo-icon scale-75"></div>
                            <span class="font-black text-slate-900 tracking-tight">KAWNBIT</span>
                        </div>
                        <p class="text-xs text-slate-400">
                            &copy; <span id="year"></span> KawnBit Quantitative Trading Community.<br>
                            Material educativo sobre Gestión ICT. Todos los derechos reservados.
                        </p>
                    </div>
                </footer>

            </main>
        </div>
    </div>

    <!-- AI Mentor -->
    <div class="fixed bottom-6 right-6 z-40">
        <button id="ai-toggle"
            class="bg-slate-900 hover:bg-kawn-base text-white p-4 rounded-full shadow-2xl transition-all transform hover:scale-110 flex items-center gap-2 group focus:outline-none focus:ring-4 focus:ring-kawn-light"
            aria-label="Abrir mentor IA">
            <i data-lucide="bot" class="w-6 h-6 group-hover:animate-bounce"></i>
            <span
                class="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 font-bold whitespace-nowrap">Mentor
                IA</span>
        </button>
    </div>

    <div id="ai-modal"
        class="hidden fixed bottom-24 right-6 w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 z-50 flex flex-col h-[500px] overflow-hidden transition-all transform origin-bottom-right">
        <div class="bg-slate-900 p-4 text-white flex justify-between items-center">
            <h3 class="font-bold flex items-center gap-2"><i data-lucide="sparkles" class="text-kawn-base w-4 h-4"></i>
                Mentor virtual</h3>
            <button id="close-ai" class="hover:text-kawn-base focus:outline-none"><i data-lucide="x"
                    class="w-5 h-5"></i></button>
        </div>
        <div id="chat-box" class="flex-1 p-4 overflow-y-auto bg-slate-50 space-y-3">
            <div
                class="bg-white border border-slate-200 p-3 rounded-lg rounded-tl-none text-sm shadow-sm text-slate-700">
                Hola. Soy tu especialista en Modelos Operativos ICT. ¿Tienes dudas sobre la implementación de equipos
                ágiles o la automatización?
            </div>
        </div>
        <div class="p-3 bg-white border-t border-slate-200">
            <form id="ai-form" class="flex gap-2">
                <input type="text" id="ai-input"
                    class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-kawn-base"
                    placeholder="Pregunta algo..." required>
                <button type="submit"
                    class="bg-kawn-base text-white p-2 rounded-lg hover:bg-kawn-dark transition-colors disabled:opacity-50"><i
                        data-lucide="send" class="w-4 h-4"></i></button>
            </form>
        </div>
    </div>

    <script>
        lucide.createIcons();
        document.getElementById('year').textContent = new Date().getFullYear();

        // Configuración de Endpoint
        const gasEndpoint = "/.netlify/functions/gemini-proxy";

        async function callAI(prompt, systemInstruction = "Eres un consultor experto en ICT.") {
            try {
                const response = await fetch(gasEndpoint, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });

                if (!response.ok) throw new Error(`Proxy Error: ${response.status}`);

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || data.result || "Lo siento, no pude procesar la solicitud.";
            } catch (error) {
                console.error("AI Error:", error);
                return null;
            }
        }

        // TOC
        const tocContainer = document.getElementById('toc-container');
        const sections = document.querySelectorAll('.section-track');
        const readingProgress = document.getElementById('reading-progress');

        sections.forEach(section => {
            const title = section.querySelector('h2').innerText;
            const id = section.id;
            const link = document.createElement('a');
            link.href = `#${id}`;
            link.innerText = title;
            link.className = 'toc-link block py-2 pl-4 text-slate-500 hover:text-kawn-base text-xs font-medium truncate';
            tocContainer.appendChild(link);
        });

        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            readingProgress.style.width = `${progress}%`;

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 150) current = section.getAttribute('id');
            });

            document.querySelectorAll('.toc-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').includes(current)) link.classList.add('active');
            });
        });

        // BIMODAL IT Logic
        let bimodalState = 'mode1';
        function toggleBimodal() {
            const knob = document.getElementById('bimodal-knob');
            const switchBtn = document.getElementById('bimodal-switch');
            const content = document.getElementById('bimodal-content');
            const label1 = document.getElementById('label-mode1');
            const label2 = document.getElementById('label-mode2');

            if (bimodalState === 'mode1') {
                bimodalState = 'mode2';
                knob.style.transform = 'translateX(24px)';
                switchBtn.classList.remove('bg-kawn-base');
                switchBtn.classList.add('bg-blue-500');
                label1.classList.replace('text-kawn-light', 'text-slate-500');
                label2.classList.replace('text-slate-500', 'text-blue-400');
                content.style.opacity = 0;
                setTimeout(() => {
                    content.innerHTML = `<div class="bg-blue-900/50 p-6 rounded-xl border border-blue-500/30"><h4 class="text-blue-300 font-bold mb-2 flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5"></i> El "Sprinter" (Ágil)</h4><p class="text-sm text-slate-300">Exploratorio, no lineal. Enfocado en la agilidad y velocidad.</p></div><div class="space-y-2 text-sm text-slate-300"><p><strong>Meta:</strong> Disrupción.</p><p><strong>Valor:</strong> Time-to-market.</p></div>`;
                    content.style.opacity = 1;
                    lucide.createIcons();
                }, 300);
            } else {
                bimodalState = 'mode1';
                knob.style.transform = 'translateX(0px)';
                switchBtn.classList.remove('bg-blue-500');
                switchBtn.classList.add('bg-kawn-base');
                label2.classList.replace('text-blue-400', 'text-slate-500');
                label1.classList.replace('text-slate-500', 'text-kawn-light');
                content.style.opacity = 0;
                setTimeout(() => {
                    content.innerHTML = `<div class="bg-kawn-deep/50 p-6 rounded-xl border border-kawn-base/30"><h4 class="text-kawn-light font-bold mb-2 flex items-center gap-2"><i data-lucide="shield-check" class="w-5 h-5"></i> El "Maratonista" (Estable)</h4><p class="text-sm text-slate-300">Tradicional y secuencial. Enfocado en la seguridad y precisión.</p></div><div class="space-y-2 text-sm text-slate-300"><p><strong>Meta:</strong> Fiabilidad.</p><p><strong>Valor:</strong> Precio/Rendimiento.</p></div>`;
                    content.style.opacity = 1;
                    lucide.createIcons();
                }, 300);
            }
        }
        toggleBimodal(); bimodalState = 'mode1';

        // DORA Metrics Logic
        function updateDora() {
            const deploy = parseInt(document.getElementById('slider-deploy').value);
            const lead = parseInt(document.getElementById('slider-lead').value);
            const restore = parseInt(document.getElementById('slider-restore').value);
            const fail = parseInt(document.getElementById('slider-fail').value);
            const score = (deploy + lead + restore + fail) / 4;

            const titleEl = document.getElementById('dora-title');
            const descEl = document.getElementById('dora-desc');
            const iconBg = document.getElementById('dora-icon-bg');
            const icon = document.getElementById('dora-icon');

            if (score >= 3.5) {
                titleEl.innerText = "Elite Performer";
                titleEl.className = "text-2xl font-black text-purple-600 mb-1";
                descEl.innerText = "Excelencia operativa absoluta.";
                iconBg.className = "w-20 h-20 rounded-full bg-purple-100 flex items-center justify-center mb-4 transition-colors duration-500";
                icon.className = "w-10 h-10 text-purple-600 transition-colors duration-500";
            } else if (score >= 2.5) {
                titleEl.innerText = "High Performer";
                titleEl.className = "text-2xl font-black text-green-600 mb-1";
                descEl.innerText = "Muy buen nivel. Ágil y fiable.";
                iconBg.className = "w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-4 transition-colors duration-500";
                icon.className = "w-10 h-10 text-green-600 transition-colors duration-500";
            } else if (score >= 1.5) {
                titleEl.innerText = "Medium Performer";
                titleEl.className = "text-2xl font-black text-yellow-600 mb-1";
                descEl.innerText = "Estándar. Falta automatización.";
                iconBg.className = "w-20 h-20 rounded-full bg-yellow-100 flex items-center justify-center mb-4 transition-colors duration-500";
                icon.className = "w-10 h-10 text-yellow-600 transition-colors duration-500";
            } else {
                titleEl.innerText = "Low Performer";
                titleEl.className = "text-2xl font-black text-red-600 mb-1";
                descEl.innerText = "Riesgo operativo. Procesos manuales.";
                iconBg.className = "w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mb-4 transition-colors duration-500";
                icon.className = "w-10 h-10 text-red-600 transition-colors duration-500";
            }
        }
        updateDora();

        // VSM Logic
        function updateVSM() {
            const ci = document.getElementById('chk-ci').checked;
            const auto = document.getElementById('chk-auto').checked;
            const cd = document.getElementById('chk-cd').checked;
            const barDev = document.getElementById('vsm-bar-dev');
            const barTest = document.getElementById('vsm-bar-test');
            const barDeploy = document.getElementById('vsm-bar-deploy');
            const timeDisplay = document.getElementById('vsm-time');

            let totalWeeks = 4;
            if (ci) { totalWeeks -= 1; barDev.style.width = '30%'; barDev.style.backgroundColor = '#14b8a6'; barDev.innerText = "CI"; }
            else { barDev.style.width = '40%'; barDev.style.backgroundColor = '#cbd5e1'; barDev.innerText = "Coding"; }

            if (auto) { totalWeeks -= 1; barTest.style.width = '20%'; barTest.style.backgroundColor = '#14b8a6'; barTest.innerText = "Auto Test"; }
            else { barTest.style.width = '30%'; barTest.style.backgroundColor = '#94a3b8'; barTest.innerText = "Testing"; }

            if (cd) { totalWeeks -= 1.5; barDeploy.style.width = '10%'; barDeploy.style.backgroundColor = '#14b8a6'; barDeploy.innerText = "CD"; }
            else { barDeploy.style.width = '30%'; barDeploy.style.backgroundColor = '#64748b'; barDeploy.innerText = "Deploy"; }

            if (totalWeeks < 1) totalWeeks = 0.5; // Min cap
            timeDisplay.innerText = totalWeeks === 0.5 ? "Horas" : totalWeeks + " Semanas";

            if (ci && auto && cd) timeDisplay.className = "text-3xl font-black text-kawn-base";
            else timeDisplay.className = "text-3xl font-black text-slate-800";
        }

        // FinOps Logic
        function updateFinOps() {
            const ri = parseInt(document.getElementById('slider-ri').value);
            const rs = parseInt(document.getElementById('slider-rs').value);

            document.getElementById('val-ri').innerText = ri + "%";
            const rsLevels = ["Ninguno", "Bajo", "Medio", "Agresivo"];
            const rsLevel = Math.floor(rs / 33);
            document.getElementById('val-rs').innerText = rsLevels[Math.min(rsLevel, 3)];

            const originalCost = 10000;
            const savingsPercent = (ri * 0.4) + (rs * 0.3);
            const newCost = originalCost * (1 - (savingsPercent / 100));
            const savings = originalCost - newCost;

            document.getElementById('finops-total').innerText = "$" + Math.round(newCost).toLocaleString();
            document.getElementById('finops-savings').innerText = "+$" + Math.round(savings).toLocaleString();
        }

        const ctxRadar = document.getElementById('modelsRadarChart').getContext('2d');
        const modelData = {
            cliente: { label: 'Centrado en cliente', data: [5, 2, 3, 5, 3], desc: "<strong>Foco:</strong> Eliminar fricciones." },
            frugal: { label: 'Extrafrugal', data: [2, 5, 2, 3, 4], desc: "<strong>Foco:</strong> Costos mínimos." },
            data: { label: 'Data-driven', data: [4, 3, 5, 4, 3], desc: "<strong>Foco:</strong> Decisiones por datos." },
            skynet: { label: 'Skynet', data: [3, 4, 4, 2, 5], desc: "<strong>Foco:</strong> Automatización total." },
            abierto: { label: 'Abierto', data: [5, 3, 2, 5, 2], desc: "<strong>Foco:</strong> Ecosistema externo." }
        };
        let radarChart = new Chart(ctxRadar, {
            type: 'radar',
            data: { labels: ['Agilidad', 'Eficiencia Costos', 'Uso de Datos', 'Innovación', 'Escalabilidad'], datasets: [{ label: 'Modelo seleccionado', data: modelData.cliente.data, fill: true, backgroundColor: 'rgba(20, 184, 166, 0.2)', borderColor: '#14b8a6', pointBackgroundColor: '#0f766e', pointBorderColor: '#fff', pointHoverBackgroundColor: '#fff', pointHoverBorderColor: '#14b8a6' }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { r: { angleLines: { color: '#e2e8f0' }, grid: { color: '#e2e8f0' }, pointLabels: { font: { family: 'Inter', size: 12 }, color: '#64748b' }, suggestedMin: 0, suggestedMax: 5 } }, plugins: { legend: { display: false } } }
        });
        window.updateRadar = function (modelKey) {
            const selected = modelData[modelKey];
            radarChart.data.datasets[0].data = selected.data; radarChart.data.datasets[0].label = selected.label; radarChart.update();
            const descBox = document.getElementById('model-description'); descBox.innerHTML = selected.desc;
        };

        const structureCanvas = document.getElementById('structure-canvas');
        const structureInfo = document.getElementById('structure-info');
        const btnTrad = document.getElementById('btn-trad');
        const btnAgile = document.getElementById('btn-agile');
        window.setStructure = function (type) {
            if (type === 'traditional') {
                btnTrad.className = "px-4 py-2 rounded-md bg-white text-kawn-deep shadow-sm transition-all font-bold ring-2 ring-kawn-base ring-offset-1";
                btnAgile.className = "px-4 py-2 rounded-md text-slate-500 hover:text-slate-800 transition-all";
                structureCanvas.innerHTML = `<div class="flex flex-col items-center gap-4 w-full h-full justify-center"><div class="w-16 h-16 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold z-10 shadow-lg">CIO</div><div class="flex gap-8 w-full justify-center"><div class="flex flex-col items-center"><div class="w-12 h-12 rounded-full bg-slate-300 flex items-center justify-center mb-2 text-xs font-bold text-slate-600">Dev</div><div class="w-1 h-8 bg-slate-300"></div></div><div class="flex flex-col items-center"><div class="w-12 h-12 rounded-full bg-slate-300 flex items-center justify-center mb-2 text-xs font-bold text-slate-600">Ops</div><div class="w-1 h-8 bg-slate-300"></div></div><div class="flex flex-col items-center"><div class="w-12 h-12 rounded-full bg-slate-300 flex items-center justify-center mb-2 text-xs font-bold text-slate-600">Sec</div><div class="w-1 h-8 bg-slate-300"></div></div></div></div>`;
                structureInfo.innerHTML = "<strong>Modelo Jerárquico Tradicional:</strong> Basado en silos funcionales.";
            } else {
                btnAgile.className = "px-4 py-2 rounded-md bg-white text-kawn-deep shadow-sm transition-all font-bold ring-2 ring-kawn-base ring-offset-1";
                btnTrad.className = "px-4 py-2 rounded-md text-slate-500 hover:text-slate-800 transition-all";
                structureCanvas.innerHTML = `<div class="flex flex-wrap items-center justify-center gap-6 w-full h-full"><div class="relative w-24 h-24 rounded-full border-2 border-kawn-base flex items-center justify-center bg-kawn-light/20 shadow-md"><span class="absolute -top-3 bg-white px-2 text-xs font-bold text-kawn-dark border border-kawn-light rounded-full">Squad A</span><div class="w-3 h-3 rounded-full bg-slate-800 absolute top-5 left-7"></div><div class="w-3 h-3 rounded-full bg-slate-500 absolute bottom-5 right-7"></div><div class="w-3 h-3 rounded-full bg-kawn-base absolute top-10 right-5"></div></div><div class="relative w-24 h-24 rounded-full border-2 border-kawn-base flex items-center justify-center bg-kawn-light/20 shadow-md"><span class="absolute -top-3 bg-white px-2 text-xs font-bold text-kawn-dark border border-kawn-light rounded-full">Squad B</span><div class="w-3 h-3 rounded-full bg-slate-800 absolute bottom-5 left-7"></div><div class="w-3 h-3 rounded-full bg-slate-500 absolute top-5 right-7"></div><div class="w-3 h-3 rounded-full bg-kawn-base absolute top-10 left-5"></div></div></div>`;
                structureInfo.innerHTML = "<strong>Modelo Redárquico (Agile):</strong> Equipos autónomos.";
            }
        }
        setStructure('traditional');

        window.showSourcing = function (quadrant) {
            const detailBox = document.getElementById('sourcing-detail');
            let t, d, i, c;
            switch (quadrant) {
                case 'q1': t = "KEEP IN-HOUSE"; d = "Crítico y diferenciador."; i = "star"; c = "text-kawn-deep"; break;
                case 'q2': t = "PARTNER / VENTURE"; d = "Crítico, sin capacidad."; i = "shield"; c = "text-blue-600"; break;
                case 'q3': t = "INNOVATE OR EXIT"; d = "Diferenciador no crítico."; i = "flask-conical"; c = "text-purple-600"; break;
                case 'q4': t = "OUTSOURCE"; d = "Commodity necesario."; i = "trash-2"; c = "text-slate-600"; break;
            }
            detailBox.innerHTML = `<div class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mb-4 transition-all animate-bounce"><i data-lucide="${i}" class="${c} w-6 h-6"></i></div><h4 class="text-xl font-bold ${c} mb-2">${t}</h4><p class="text-slate-600 text-sm leading-relaxed">${d}</p>`;
            lucide.createIcons();
        }

        let quizScore = 0; let answered = new Set();
        const quizExplanations = { 1: "El modelo operativo no es solo tecnología; es el puente entre estrategia y ejecución.", 2: "Skynet lleva la automatización al extremo para eficiencia.", 3: "Fusion Teams integran TI en negocio.", 4: "El CIO es arquitecto, no proveedor." };
        window.checkAnswer = function (qId, selected, btn) {
            if (answered.has(qId)) return;
            answered.add(qId);
            const parent = btn.parentElement;
            let isCorrect = false;
            if (btn.dataset.correct === 'true' || btn.dataset.isCorrect === 'true') isCorrect = true;
            else if (parent.querySelector('[data-correct="true"]') && selected === 'true') isCorrect = true;
            let exp = quizExplanations[qId] || "Respuesta basada en conceptos clave.";
            const qItem = btn.closest('.quiz-item'); if (qItem && qItem.dataset.explanation) exp = qItem.dataset.explanation;
            const feedbackEl = parent.nextElementSibling;
            if (isCorrect) { quizScore++; btn.classList.add('correct'); feedbackEl.innerHTML = `<div class="mt-3 p-3 bg-green-50 border-l-4 border-green-500 rounded text-sm text-slate-700 fade-in-up"><strong class="text-green-700 block mb-1">¡Correcto!</strong>${exp}</div>`; }
            else { btn.classList.add('wrong'); parent.querySelectorAll('button').forEach(b => { if (b.dataset.correct === 'true' || b.dataset.isCorrect === 'true') b.classList.add('correct'); }); feedbackEl.innerHTML = `<div class="mt-3 p-3 bg-red-50 border-l-4 border-red-500 rounded text-sm text-slate-700 fade-in-up"><strong class="text-red-700 block mb-1">Incorrecto.</strong>${exp}</div>`; }
            feedbackEl.classList.remove('hidden'); document.getElementById('quiz-score').innerText = `${quizScore} Correctas`;
            parent.querySelectorAll('button').forEach(b => b.disabled = true);
        };

        window.analyzeCase = async function () {
            const input = document.getElementById('case-input').value.trim();
            if (!input) return alert("Describe un caso.");
            const resultSection = document.getElementById('case-result');
            const contentDiv = document.getElementById('case-content');
            const loadingDiv = document.getElementById('case-loading');
            const btn = document.getElementById('analyze-btn');
            resultSection.classList.add('hidden'); loadingDiv.classList.remove('hidden'); btn.disabled = true;
            try {
                const text = await callAI(`Actúa como consultor experto. Analiza: "${input}". \n1. Desafío principal.\n2. MEJOR modelo operativo ICT.\n3. Justificación.\nUsa Markdown.`, "Eres un consultor experto en ICT.");
                if (!text) throw new Error("Error API");
                contentDiv.innerHTML = typeof marked !== 'undefined' ? marked.parse(text) : text;
                resultSection.classList.remove('hidden');
            } catch (err) {
                resultSection.classList.remove('hidden');
                contentDiv.innerHTML = `<div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 text-sm"><p class="font-bold">Modo Demo</p><p>Sugiero evaluar un <strong>Modelo Híbrido</strong>.</p></div>`;
            } finally {
                loadingDiv.classList.add('hidden');
                btn.disabled = false;
            }
        };

        window.generateQuizQuestion = async function () {
            const loading = document.getElementById('quiz-loading');
            const container = document.getElementById('quiz-questions-container');
            const btn = document.getElementById('new-quiz-btn');
            loading.classList.remove('hidden'); loading.style.display = 'flex'; btn.disabled = true;
            try {
                const topics = ["Métricas DORA", "FinOps", "Value Stream Management", "IT Bimodal", "Skynet", "Fusion Teams"];
                const randomTopic = topics[Math.floor(Math.random() * topics.length)];

                const reply = await callAI(`Genera una pregunta de opción múltiple única sobre "${randomTopic}" en Modelos Operativos ICT.
                        Estructura JSON: { "pregunta": "txt", "explicacion_detallada": "txt", "opciones": [{"texto": "A", "correcta": false}, {"texto": "B", "correcta": true}, {"texto": "C", "correcta": false}] }.
                        JSON puro sin markdown.`, "Eres un analista de certificación ICT.");

                if (!reply) throw new Error("Error API");
                let jsonStr = reply.replace(/```json/g, '').replace(/```/g, '').trim();
                const qData = JSON.parse(jsonStr);

                const newId = Date.now();
                const newQHTML = `
                    <div class="quiz-item border-l-4 border-kawn-base pl-4 mb-8 bg-slate-50 p-4 rounded-r-lg fade-in-up" data-id="${newId}" data-explanation="${qData.explicacion_detallada.replace(/"/g, '&quot;')}">
                        <p class="font-bold text-slate-900 mb-3 flex items-center gap-2"><i data-lucide="sparkles" class="w-4 h-4 text-kawn-base"></i> ${qData.pregunta}</p>
                        <div class="space-y-2 text-sm">
                            ${qData.opciones.map(opt => `
                                <button onclick="checkAnswer(${newId}, null, this)" class="quiz-option w-full text-left p-3 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 transition-colors" data-is-correct="${opt.correcta}">${opt.texto}</button>
                            `).join('')}
                        </div>
                        <div class="hidden"></div>
                    </div>
                `;

                container.insertAdjacentHTML('afterbegin', newQHTML);
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                lucide.createIcons();
            } catch (err) { alert("Modo Demo: No se pudo conectar."); } finally { loading.classList.add('hidden'); loading.style.display = 'none'; btn.disabled = false; }
        };

        const aiToggle = document.getElementById('ai-toggle');
        const aiModal = document.getElementById('ai-modal');
        const closeAi = document.getElementById('close-ai');
        const aiForm = document.getElementById('ai-form');
        const aiInput = document.getElementById('ai-input');
        const chatBox = document.getElementById('chat-box');
        aiToggle.addEventListener('click', () => { aiModal.classList.remove('hidden'); setTimeout(() => aiInput.focus(), 100); });
        closeAi.addEventListener('click', () => aiModal.classList.add('hidden'));
        aiForm.addEventListener('submit', async (e) => {
            e.preventDefault(); const text = aiInput.value.trim(); if (!text) return;
            chatBox.innerHTML += `<div class="bg-kawn-base text-white p-3 rounded-lg rounded-tr-none text-sm self-end ml-auto max-w-[85%] chat-message shadow-sm">${text}</div>`;
            aiInput.value = ''; chatBox.scrollTop = chatBox.scrollHeight;
            const loadingId = 'loading-' + Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="bg-slate-100 text-slate-500 p-3 rounded-lg text-xs italic self-start animate-pulse">Escribiendo...</div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
            try {
                const reply = await callAI(text, "Eres un mentor experto en ICT.");
                if (!reply) throw new Error("Error API");
                document.getElementById(loadingId).remove();
                chatBox.innerHTML += `<div class="bg-white border border-slate-200 p-3 rounded-lg rounded-tl-none text-sm shadow-sm text-slate-700 chat-message self-start max-w-[90%]">${reply}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (err) {
                document.getElementById(loadingId).remove();
                chatBox.innerHTML += `<div class="bg-white border border-slate-200 p-3 rounded-lg rounded-tl-none text-sm shadow-sm text-slate-700 chat-message border-l-4 border-yellow-400"><strong>Modo Demo:</strong> Gracias por tu pregunta.</div>`;
            }
        });
    </script>
</body>

</html>